<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBA í”„ë¡œíŒŒì¼ ë§ˆë²•ì‚¬</title>
    <!-- API ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
    <script src="js/api.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #e2e8f0;
            min-height: 100vh;
            font-size: 0.9rem; /* ê¸°ë³¸ í°íŠ¸ í¬ê¸° ì¶•ì†Œ */
        }

        .wizard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem; /* íŒ¨ë”© ì¶•ì†Œ */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 1.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .header h1 {
            font-size: 2rem; /* ì œëª© í¬ê¸° ì¶•ì†Œ */
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.3rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .header p {
            color: #94a3b8;
            font-size: 0.95rem; /* í¬ê¸° ì¶•ì†Œ */
        }

        .progress-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 1.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
            gap: 0.5rem; /* ê°„ê²© ì¶•ì†Œ */
        }

        .progress-step {
            display: flex;
            align-items: center;
        }

        .step-circle {
            width: 32px; /* í¬ê¸° ì¶•ì†Œ */
            height: 32px; /* í¬ê¸° ì¶•ì†Œ */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .step-circle.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
        }

        .step-circle.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .step-circle.inactive {
            background: #374151;
            color: #9ca3af;
        }

        .step-label {
            margin-left: 0.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
            font-size: 0.8rem; /* í¬ê¸° ì¶•ì†Œ */
            color: #94a3b8;
        }

        .wizard-content {
            flex: 1;
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem; /* íŒ¨ë”© ì¶•ì†Œ */
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .step-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 1rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem; /* ë§ˆì§„ ì¶•ì†Œ */
            font-weight: 600;
            color: #f1f5f9;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.5rem 0.75rem; /* íŒ¨ë”© ì¶•ì†Œ */
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.5rem;
            color: #e2e8f0;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .radio-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* ì—´ ë„ˆë¹„ ì¶•ì†Œ */
            gap: 0.75rem; /* ê°„ê²© ì¶•ì†Œ */
            margin-top: 0.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .radio-item {
            display: flex;
            align-items: flex-start;
            padding: 0.75rem; /* íŒ¨ë”© ì¶•ì†Œ */
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-item:hover {
            background: rgba(15, 23, 42, 0.8);
            border-color: #6366f1;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.15); /* ê·¸ë¦¼ì ì¶•ì†Œ */
        }

        .radio-item.selected {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            border-color: #6366f1;
            box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.3);
        }

        .radio-item input[type="radio"] {
            width: 16px; /* í¬ê¸° ì¶•ì†Œ */
            height: 16px; /* í¬ê¸° ì¶•ì†Œ */
            margin-right: 0.75rem; /* ë§ˆì§„ ì¶•ì†Œ */
            margin-top: 0.25rem;
            accent-color: #6366f1;
            cursor: pointer;
        }

        .radio-item label {
            cursor: pointer;
            line-height: 1.3;
            flex: 1;
        }

        .radio-item label strong {
            display: block;
            color: #f1f5f9;
            font-size: 0.95rem; /* í¬ê¸° ì¶•ì†Œ */
            margin-bottom: 0.25rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .radio-description {
            display: block;
            color: #94a3b8;
            font-size: 0.8rem; /* í¬ê¸° ì¶•ì†Œ */
            font-weight: normal;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* ì—´ ë„ˆë¹„ ì¶•ì†Œ */
            gap: 0.75rem; /* ê°„ê²© ì¶•ì†Œ */
            margin-top: 0.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 0.6rem; /* íŒ¨ë”© ì¶•ì†Œ */
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.4rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(15, 23, 42, 0.8);
            border-color: #6366f1;
            transform: translateY(-1px); /* ë³€í™”ëŸ‰ ì¶•ì†Œ */
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 0.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
            accent-color: #6366f1;
        }

        .metric-card {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 0.6rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            padding: 1rem; /* íŒ¨ë”© ì¶•ì†Œ */
            margin-bottom: 0.75rem; /* ë§ˆì§„ ì¶•ì†Œ */
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.1); /* ê·¸ë¦¼ì ì¶•ì†Œ */
        }

        .metric-card h4 {
            color: #6366f1;
            margin-bottom: 0.3rem; /* ë§ˆì§„ ì¶•ì†Œ */
            font-size: 1rem; /* í¬ê¸° ì¶•ì†Œ */
        }

        .metric-card p {
            color: #94a3b8;
            font-size: 0.85rem; /* í¬ê¸° ì¶•ì†Œ */
            line-height: 1.4;
        }

        .metric-card.disabled {
            opacity: 0.4;
            pointer-events: none;
            background: rgba(15, 23, 42, 0.3);
            border-color: rgba(51, 65, 85, 0.2);
        }

        .metric-card.disabled h4 {
            color: #64748b;
        }

        .metric-unavailable {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 0.4rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 0.4rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            font-size: 0.8rem; /* í¬ê¸° ì¶•ì†Œ */
            margin-top: 0.3rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem; /* ë§ˆì§„ ì¶•ì†Œ */
            padding-top: 1rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-top: 1px solid rgba(51, 65, 85, 0.3);
        }

        .btn {
            padding: 0.5rem 1.5rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border: none;
            border-radius: 0.4rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            font-size: 0.9rem; /* í¬ê¸° ì¶•ì†Œ */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #5856eb, #7c3aed);
            transform: translateY(-1px); /* ë³€í™”ëŸ‰ ì¶•ì†Œ */
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3); /* ê·¸ë¦¼ì ì¶•ì†Œ */
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.7);
            color: #e2e8f0;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(51, 65, 85, 0.9);
            transform: translateY(-1px); /* ë³€í™”ëŸ‰ ì¶•ì†Œ */
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .alert {
            padding: 0.75rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 0.4rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            margin-bottom: 1rem; /* ë§ˆì§„ ì¶•ì†Œ */
            border: 1px solid;
            font-size: 0.85rem; /* í¬ê¸° ì¶•ì†Œ */
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #93c5fd;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* ì—´ ë„ˆë¹„ ì¶•ì†Œ */
            gap: 1rem; /* ê°„ê²© ì¶•ì†Œ */
            margin-top: 1rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .summary-card {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.6rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            padding: 1rem; /* íŒ¨ë”© ì¶•ì†Œ */
        }

        .summary-card h4 {
            color: #f1f5f9;
            margin-bottom: 0.75rem; /* ë§ˆì§„ ì¶•ì†Œ */
            font-size: 0.95rem; /* í¬ê¸° ì¶•ì†Œ */
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem; /* ë§ˆì§„ ì¶•ì†Œ */
            padding-bottom: 0.3rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-bottom: 1px solid rgba(51, 65, 85, 0.2);
            font-size: 0.85rem; /* í¬ê¸° ì¶•ì†Œ */
        }

        .summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .tag {
            display: inline-block;
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            padding: 0.2rem 0.5rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 9999px;
            font-size: 0.7rem; /* í¬ê¸° ì¶•ì†Œ */
            font-weight: 500;
            margin: 0.1rem; /* ë§ˆì§„ ì¶•ì†Œ */
        }

        .select-all-btn {
            display: flex;
            align-items: center;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: #a5b4fc;
            padding: 0.3rem 0.75rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 0.4rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
            font-size: 0.8rem; /* í¬ê¸° ì¶•ì†Œ */
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .select-all-btn:hover {
            background: rgba(99, 102, 241, 0.25);
            transform: translateY(-1px);
        }

        .select-all-btn input[type="checkbox"] {
            accent-color: #6366f1;
        }

        .selected-count {
            font-size: 0.75rem; /* í¬ê¸° ì¶•ì†Œ */
            color: #94a3b8;
            background: rgba(15, 23, 42, 0.6);
            padding: 0.2rem 0.6rem; /* íŒ¨ë”© ì¶•ì†Œ */
            border-radius: 0.3rem; /* ë‘¥ê¸€ê¸° ì¶•ì†Œ */
        }

        /* Step ë‚´ ì œëª© í¬ê¸° ì¶•ì†Œ */
        .step-content h3 {
            margin-bottom: 1rem !important; /* ë§ˆì§„ ì¶•ì†Œ */
            color: #f1f5f9;
            font-size: 1.2rem !important; /* í¬ê¸° ì¶•ì†Œ */
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .wizard-container { padding: 0.75rem; }
            .progress-bar { flex-direction: column; align-items: center; gap: 0.5rem; }
            .button-group { flex-direction: column; gap: 0.75rem; }
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <div class="header">
            <h1>UBA í”„ë¡œíŒŒì¼ ë§ˆë²•ì‚¬</h1>
            <p>ì‚¬ìš©ì ë° ì—”í„°í‹° í–‰ë™ ë¶„ì„ í”„ë¡œíŒŒì¼ì„ ì‰½ê²Œ ì„¤ì •í•˜ì„¸ìš”</p>
        </div>

        <div class="progress-bar">
            <div class="progress-step">
                <div class="step-circle active" id="step1">1</div>
                <div class="step-label">ê¸°ë³¸ ì •ë³´</div>
            </div>
            <div class="progress-step">
                <div class="step-circle inactive" id="step2">2</div>
                <div class="step-label">ë°ì´í„° ì†ŒìŠ¤</div>
            </div>
            <div class="progress-step">
                <div class="step-circle inactive" id="step3">3</div>
                <div class="step-label">ë¶„ì„ ë©”íŠ¸ë¦­</div>
            </div>
            <div class="progress-step">
                <div class="step-circle inactive" id="step4">4</div>
                <div class="step-label">ì„ê³„ê°’ ì„¤ì •</div>
            </div>
            <div class="progress-step">
                <div class="step-circle inactive" id="step5">5</div>
                <div class="step-label">ê²€í†  ë° ì™„ë£Œ</div>
            </div>
        </div>

        <div class="wizard-content">
            <!-- Step 1: ê¸°ë³¸ ì •ë³´ -->
            <div class="step-content active" id="content1">
                <h3 style="margin-bottom: 2rem; color: #f1f5f9; font-size: 1.5rem;">UBA í”„ë¡œíŒŒì¼ ê¸°ë³¸ ì •ë³´</h3>

                <div class="form-group">
                    <label for="profileName">í”„ë¡œíŒŒì¼ ì´ë¦„ *</label>
                    <input type="text" id="profileName" placeholder="ì˜ˆ: ì¼ë°˜ ì‚¬ìš©ì í–‰ë™ í”„ë¡œíŒŒì¼">
                </div>

                <div class="form-group">
                    <label for="profileDescription">ì„¤ëª…</label>
                    <textarea id="profileDescription" rows="3" placeholder="ì´ í”„ë¡œíŒŒì¼ì´ ë¶„ì„í•˜ëŠ” í–‰ë™ íŒ¨í„´ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label for="profileType">í”„ë¡œíŒŒì¼ ìœ í˜•</label>
                        <select id="profileType">
                            <option value="user">ì‚¬ìš©ì í”„ë¡œíŒŒì¼</option>
                            <option value="entity">ì—”í„°í‹° í”„ë¡œíŒŒì¼</option>
                            <option value="hybrid">í•˜ì´ë¸Œë¦¬ë“œ í”„ë¡œíŒŒì¼</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="analysisScope">ë¶„ì„ ë²”ìœ„</label>
                        <select id="analysisScope">
                            <option value="department">ë¶€ì„œë³„</option>
                            <option value="role">ì—­í• ë³„</option>
                            <option value="global">ì „ì²´ ì¡°ì§</option>
                        </select>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>ì •ë³´:</strong> UBA í”„ë¡œíŒŒì¼ì€ ì •ìƒì ì¸ ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ì„ í•™ìŠµí•˜ì—¬ ì´ìƒ ì§•í›„ë¥¼ íƒì§€í•©ë‹ˆë‹¤.
                </div>
            </div>

            <!-- Step 2: ë°ì´í„° ì†ŒìŠ¤ -->
            <div class="step-content" id="content2">
                <h3 style="margin-bottom: 2rem; color: #f1f5f9; font-size: 1.5rem;">ë°ì´í„° ì†ŒìŠ¤ ì„ íƒ</h3>

                <div class="form-group">
                    <label>ë¡œê·¸ ì†ŒìŠ¤ ì„ íƒ * (í•˜ë‚˜ë§Œ ì„ íƒ)</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="windowsLogs" name="logSource" value="windows">
                            <label for="windowsLogs">
                                <strong>Windows ì´ë²¤íŠ¸ ë¡œê·¸</strong>
                                <span class="radio-description">ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, ì‹œìŠ¤í…œ ì´ë²¤íŠ¸</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="adLogs" name="logSource" value="ad">
                            <label for="adLogs">
                                <strong>Active Directory</strong>
                                <span class="radio-description">ì‚¬ìš©ì ì¸ì¦, ê¶Œí•œ ë³€ê²½, ê·¸ë£¹ ê´€ë¦¬</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="firewallLogs" name="logSource" value="firewall">
                            <label for="firewallLogs">
                                <strong>ë°©í™”ë²½ ë¡œê·¸</strong>
                                <span class="radio-description">ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½, IP ì ‘ê·¼ íŒ¨í„´</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="proxyLogs" name="logSource" value="proxy">
                            <label for="proxyLogs">
                                <strong>í”„ë¡ì‹œ/ì›¹ ë¡œê·¸</strong>
                                <span class="radio-description">ì›¹ ì‚¬ì´íŠ¸ ì ‘ê·¼, URL íŒ¨í„´</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="vpnLogs" name="logSource" value="vpn">
                            <label for="vpnLogs">
                                <strong>VPN ë¡œê·¸</strong>
                                <span class="radio-description">ì›ê²© ì ‘ì†, ì§€ì—­ë³„ ì—°ê²° íŒ¨í„´</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="dnsLogs" name="logSource" value="dns">
                            <label for="dnsLogs">
                                <strong>DNS ë¡œê·¸</strong>
                                <span class="radio-description">ë„ë©”ì¸ ìš”ì²­, DNS ì¿¼ë¦¬ íŒ¨í„´</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="emailLogs" name="logSource" value="email">
                            <label for="emailLogs">
                                <strong>ì´ë©”ì¼ ë¡œê·¸</strong>
                                <span class="radio-description">ì´ë©”ì¼ ì†¡ìˆ˜ì‹ , ì²¨ë¶€íŒŒì¼ íŒ¨í„´</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="linuxLogs" name="logSource" value="linux">
                            <label for="linuxLogs">
                                <strong>ë¦¬ëˆ…ìŠ¤/ìœ ë‹‰ìŠ¤ ë¡œê·¸</strong>
                                <span class="radio-description">syslog, auth.log, secure, ì‹œìŠ¤í…œ ì´ë²¤íŠ¸</span>
                            </label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="dbLogs" name="logSource" value="database">
                            <label for="dbLogs">
                                <strong>ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸</strong>
                                <span class="radio-description">ë°ì´í„° ì ‘ê·¼, ì¿¼ë¦¬ ì‹¤í–‰ íŒ¨í„´</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="learningPeriod">í•™ìŠµ ê¸°ê°„</label>
                    <select id="learningPeriod">
                        <option value="7">7ì¼</option>
                        <option value="14">14ì¼</option>
                        <option value="30" selected>30ì¼</option>
                        <option value="60">60ì¼</option>
                        <option value="90">90ì¼</option>
                    </select>
                </div>

                <div class="alert alert-info">
                    <strong>ê¶Œì¥ì‚¬í•­:</strong> ì •í™•í•œ ë² ì´ìŠ¤ë¼ì¸ ì„¤ì •ì„ ìœ„í•´ ìµœì†Œ 30ì¼ê°„ì˜ í•™ìŠµ ê¸°ê°„ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                </div>
            </div>

            <!-- Step 3: ë¶„ì„ ë©”íŠ¸ë¦­ -->
            <div class="step-content" id="content3">
                <h3 style="margin-bottom: 2rem; color: #f1f5f9; font-size: 1.5rem;">ë¶„ì„ ë©”íŠ¸ë¦­ ì„¤ì •</h3>

                <div id="selectedLogInfo" class="alert alert-info" style="display: none;">
                    <strong>ì„ íƒëœ ë¡œê·¸ ì†ŒìŠ¤:</strong> <span id="logSourceName">-</span><br>
                    <strong>ë¶„ì„ ê°€ëŠ¥í•œ ë©”íŠ¸ë¦­:</strong> <span id="availableMetrics">-</span>
                </div>

                <div class="metric-card" id="timeMetricCard">
                    <h4>ğŸ“… ì‹œê°„ ê¸°ë°˜ ë¶„ì„</h4>
                    <p>ì‚¬ìš©ìì˜ ì‹œê°„ì  í–‰ë™ íŒ¨í„´ì„ ë¶„ì„í•˜ì—¬ ì´ìƒ ì§•í›„ë¥¼ íƒì§€í•©ë‹ˆë‹¤.</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                        <button type="button" id="selectAllTimeBtn" class="select-all-btn">
                            <span>ì „ì²´ ì„ íƒ</span>
                            <input type="checkbox" id="selectAllTime" style="margin-left: 8px;">
                        </button>
                        <span id="timeSelectedCount" class="selected-count">0ê°œ ì„ íƒë¨</span>
                    </div>
                    <div class="checkbox-group" style="margin-top: 1rem;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="loginTime" value="login_time">
                            <label for="loginTime">ë¡œê·¸ì¸ ì‹œê°„ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sessionDuration" value="session_duration">
                            <label for="sessionDuration">ì„¸ì…˜ ì§€ì† ì‹œê°„</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="afterHours" value="after_hours">
                            <label for="afterHours">ì—…ë¬´ì‹œê°„ ì™¸ í™œë™</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="weekendActivity" value="weekend_activity">
                            <label for="weekendActivity">ì£¼ë§/íœ´ì¼ ì ‘ê·¼</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="loginFrequency" value="login_frequency">
                            <label for="loginFrequency">ë¡œê·¸ì¸ ë¹ˆë„ ë³€í™”</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sessionOverlap" value="session_overlap">
                            <label for="sessionOverlap">ë™ì‹œ ì„¸ì…˜ íƒì§€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="idleTime" value="idle_time">
                            <label for="idleTime">ë¹„í™œì„± ì‹œê°„ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="timeZoneAnomaly" value="timezone_anomaly">
                            <label for="timeZoneAnomaly">ì‹œê°„ëŒ€ ì´ìƒ ì ‘ê·¼</label>
                        </div>
                    </div>
                    <div id="timeMetricUnavailable" class="metric-unavailable" style="display: none;">
                        ì´ ë¡œê·¸ ì†ŒìŠ¤ì—ì„œëŠ” ì‹œê°„ ê¸°ë°˜ ë¶„ì„ì´ ì œí•œì ì´ê±°ë‚˜ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="metric-card" id="networkMetricCard">
                    <h4>ğŸŒ ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„</h4>
                    <p>ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ íŒ¨í„´ê³¼ ì§€ë¦¬ì  ìœ„ì¹˜ë¥¼ ë¶„ì„í•˜ì—¬ ì´ìƒ ì§•í›„ë¥¼ íƒì§€í•©ë‹ˆë‹¤.</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                        <button type="button" id="selectAllNetworkBtn" class="select-all-btn">
                            <span>ì „ì²´ ì„ íƒ</span>
                            <input type="checkbox" id="selectAllNetwork" style="margin-left: 8px;">
                        </button>
                        <span id="networkSelectedCount" class="selected-count">0ê°œ ì„ íƒë¨</span>
                    </div>
                    <div class="checkbox-group" style="margin-top: 1rem;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="ipAddress" value="ip_address">
                            <label for="ipAddress">IP ì£¼ì†Œ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="geoLocation" value="geo_location">
                            <label for="geoLocation">ì§€ë¦¬ì  ìœ„ì¹˜ ë¶„ì„</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="dataVolume" value="data_volume">
                            <label for="dataVolume">ë°ì´í„° ì „ì†¡ëŸ‰</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="impossibleTravel" value="impossible_travel">
                            <label for="impossibleTravel">ë¶ˆê°€ëŠ¥í•œ ì´ë™ íƒì§€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="vpnUsage" value="vpn_usage">
                            <label for="vpnUsage">VPN ì‚¬ìš© íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="networkDevice" value="network_device">
                            <label for="networkDevice">ë””ë°”ì´ìŠ¤ ë³€ê²½ íƒì§€</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="bandwidthUsage" value="bandwidth_usage">
                            <label for="bandwidthUsage">ëŒ€ì—­í­ ì‚¬ìš©ëŸ‰ ì´ìƒ</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="connectionPattern" value="connection_pattern">
                            <label for="connectionPattern">ì—°ê²° íŒ¨í„´ ë¶„ì„</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="proxyBypass" value="proxy_bypass">
                            <label for="proxyBypass">í”„ë¡ì‹œ ìš°íšŒ ì‹œë„</label>
                        </div>
                    </div>
                    <div id="networkMetricUnavailable" class="metric-unavailable" style="display: none;">
                        ì´ ë¡œê·¸ ì†ŒìŠ¤ì—ì„œëŠ” ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„ì´ ì œí•œì ì´ê±°ë‚˜ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="metric-card" id="accessMetricCard">
                    <h4>ğŸ” ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„</h4>
                    <p>ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ íŒ¨í„´ê³¼ ê¶Œí•œ ì‚¬ìš©ì„ ë¶„ì„í•˜ì—¬ ì´ìƒ ì§•í›„ë¥¼ íƒì§€í•©ë‹ˆë‹¤.</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin: 0.75rem 0;">
                        <button type="button" id="selectAllAccessBtn" class="select-all-btn">
                            <span>ì „ì²´ ì„ íƒ</span>
                            <input type="checkbox" id="selectAllAccess" style="margin-left: 8px;">
                        </button>
                        <span id="accessSelectedCount" class="selected-count">0ê°œ ì„ íƒë¨</span>
                    </div>
                    <div class="checkbox-group" style="margin-top: 1rem;">
                        <div class="checkbox-item">
                            <input type="checkbox" id="resourceAccess" value="resource_access">
                            <label for="resourceAccess">ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="authFailures" value="auth_failures">
                            <label for="authFailures">ì¸ì¦ ì‹¤íŒ¨ íšŸìˆ˜</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="privilegeEscalation" value="privilege_escalation">
                            <label for="privilegeEscalation">ê¶Œí•œ ìƒìŠ¹ ì‹œë„</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="sensitiveDataAccess" value="sensitive_data">
                            <label for="sensitiveDataAccess">ë¯¼ê° ë°ì´í„° ì ‘ê·¼</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fileDownload" value="file_download">
                            <label for="fileDownload">íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adminAccess" value="admin_access">
                            <label for="adminAccess">ê´€ë¦¬ì ê¶Œí•œ ì‚¬ìš©</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="applicationUsage" value="app_usage">
                            <label for="applicationUsage">ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš© íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="databaseQuery" value="db_query">
                            <label for="databaseQuery">ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="emailBehavior" value="email_behavior">
                            <label for="emailBehavior">ì´ë©”ì¼ í–‰ë™ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="systemCommand" value="system_command">
                            <label for="systemCommand">ì‹œìŠ¤í…œ ëª…ë ¹ì–´ ì‹¤í–‰</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="remoteAccess" value="remote_access">
                            <label for="remoteAccess">ì›ê²© ì ‘ê·¼ íŒ¨í„´</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="shareAccess" value="share_access">
                            <label for="shareAccess">ê³µìœ  í´ë” ì ‘ê·¼</label>
                        </div>
                    </div>
                    <div id="accessMetricUnavailable" class="metric-unavailable" style="display: none;">
                        ì´ ë¡œê·¸ ì†ŒìŠ¤ì—ì„œëŠ” ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„ì´ ì œí•œì ì´ê±°ë‚˜ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <!-- Step 4: ì„ê³„ê°’ ì„¤ì • -->
            <div class="step-content" id="content4">
                <h3 style="margin-bottom: 2rem; color: #f1f5f9; font-size: 1.5rem;">ì´ìƒ ì§•í›„ ì„ê³„ê°’ ì„¤ì •</h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div class="form-group">
                        <label for="anomalyThreshold">ì´ìƒ ì§•í›„ ë¯¼ê°ë„</label>
                        <select id="anomalyThreshold">
                            <option value="low">ë‚®ìŒ (ë³´ìˆ˜ì )</option>
                            <option value="medium" selected>ë³´í†µ (ê¶Œì¥)</option>
                            <option value="high">ë†’ìŒ (ë¯¼ê°í•¨)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="alertSeverity">ê²½ê³  ì‹¬ê°ë„</label>
                        <select id="alertSeverity">
                            <option value="info">ì •ë³´</option>
                            <option value="low">ë‚®ìŒ</option>
                            <option value="medium" selected>ë³´í†µ</option>
                            <option value="high">ë†’ìŒ</option>
                            <option value="critical">ë§¤ìš° ë†’ìŒ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="riskScore">ìœ„í—˜ ì ìˆ˜ ì„ê³„ê°’ (1-100)</label>
                    <input type="range" id="riskScore" min="1" max="100" value="70" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.9rem; color: #94a3b8;">
                        <span>1 (ë‚®ìŒ)</span>
                        <span id="riskScoreValue">70</span>
                        <span>100 (ë†’ìŒ)</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>ì•Œë¦¼ ì„¤ì •</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="emailAlert" value="email" checked>
                            <label for="emailAlert">ì´ë©”ì¼ ì•Œë¦¼</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="slackAlert" value="slack">
                            <label for="slackAlert">Slack ì•Œë¦¼</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="smsAlert" value="sms">
                            <label for="smsAlert">SMS ì•Œë¦¼</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="dashboardAlert" value="dashboard" checked>
                            <label for="dashboardAlert">ëŒ€ì‹œë³´ë“œ í‘œì‹œ</label>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>ì°¸ê³ :</strong> ì„ê³„ê°’ì´ ë‚®ì„ìˆ˜ë¡ ë” ë§ì€ ì´ìƒ ì§•í›„ë¥¼ íƒì§€í•˜ì§€ë§Œ, ì˜¤íƒë¥ ë„ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>

            <!-- Step 5: ê²€í†  ë° ì™„ë£Œ -->
            <div class="step-content" id="content5">
                <h3 style="margin-bottom: 2rem; color: #f1f5f9; font-size: 1.5rem;">ì„¤ì • ê²€í†  ë° ì™„ë£Œ</h3>

                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>ğŸ“‹ ê¸°ë³¸ ì •ë³´</h4>
                        <div class="summary-item">
                            <span>í”„ë¡œíŒŒì¼ ì´ë¦„:</span>
                            <span id="summaryName">-</span>
                        </div>
                        <div class="summary-item">
                            <span>í”„ë¡œíŒŒì¼ ìœ í˜•:</span>
                            <span id="summaryType">-</span>
                        </div>
                        <div class="summary-item">
                            <span>ë¶„ì„ ë²”ìœ„:</span>
                            <span id="summaryScope">-</span>
                        </div>
                    </div>

                    <div class="summary-card">
                        <h4>ğŸ“Š ë°ì´í„° ì†ŒìŠ¤</h4>
                        <div class="summary-item">
                            <span>í•™ìŠµ ê¸°ê°„:</span>
                            <span id="summaryLearning">-</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <div id="summaryDataSources">ì„ íƒëœ ì†ŒìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>

                    <div class="summary-card">
                        <h4>ğŸ“ˆ ë¶„ì„ ë©”íŠ¸ë¦­</h4>
                        <div id="summaryMetrics">ì„ íƒëœ ë©”íŠ¸ë¦­ì´ ì—†ìŠµë‹ˆë‹¤</div>
                    </div>

                    <div class="summary-card">
                        <h4>âš ï¸ ì•Œë¦¼ ì„¤ì •</h4>
                        <div class="summary-item">
                            <span>ë¯¼ê°ë„:</span>
                            <span id="summarySensitivity">-</span>
                        </div>
                        <div class="summary-item">
                            <span>ìœ„í—˜ ì ìˆ˜ ì„ê³„ê°’:</span>
                            <span id="summaryRiskScore">-</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <div id="summaryAlerts">ì•Œë¦¼ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        </div>
                    </div>
                </div>

                <div class="alert alert-info">
                    <strong>ë‹¤ìŒ ë‹¨ê³„:</strong> í”„ë¡œíŒŒì¼ ìƒì„± í›„ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ í•™ìŠµì„ ì‹œì‘í•©ë‹ˆë‹¤. ì´ˆê¸° ë² ì´ìŠ¤ë¼ì¸ ì„¤ì •ê¹Œì§€ ì•½ 24-48ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-secondary" id="prevBtn" onclick="prevStep()" disabled>
                â† ì´ì „
            </button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                ë‹¤ìŒ â†’
            </button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        // ì „ì²´ ì„ íƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        document.getElementById('selectAllTimeBtn').addEventListener('click', function() {
            const checkbox = document.getElementById('selectAllTime');
            checkbox.checked = !checkbox.checked;

            // ëª¨ë“  í™œì„±í™”ëœ ì‹œê°„ ê¸°ë°˜ ì²´í¬ë°•ìŠ¤ì— ì ìš©
            const timeCheckboxes = document.querySelectorAll('#timeMetricCard input[type="checkbox"]:not(#selectAllTime):not(:disabled)');
            timeCheckboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });

            updateSelectedCount('time');
        });

        document.getElementById('selectAllNetworkBtn').addEventListener('click', function() {
            const checkbox = document.getElementById('selectAllNetwork');
            checkbox.checked = !checkbox.checked;

            // ëª¨ë“  í™œì„±í™”ëœ ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ì²´í¬ë°•ìŠ¤ì— ì ìš©
            const networkCheckboxes = document.querySelectorAll('#networkMetricCard input[type="checkbox"]:not(#selectAllNetwork):not(:disabled)');
            networkCheckboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });

            updateSelectedCount('network');
        });

        document.getElementById('selectAllAccessBtn').addEventListener('click', function() {
            const checkbox = document.getElementById('selectAllAccess');
            checkbox.checked = !checkbox.checked;

            // ëª¨ë“  í™œì„±í™”ëœ ì ‘ê·¼ ê¸°ë°˜ ì²´í¬ë°•ìŠ¤ì— ì ìš©
            const accessCheckboxes = document.querySelectorAll('#accessMetricCard input[type="checkbox"]:not(#selectAllAccess):not(:disabled)');
            accessCheckboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });

            updateSelectedCount('access');
        });

        // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ì—ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.getElementById('selectAllTime').addEventListener('change', function() {
            const timeCheckboxes = document.querySelectorAll('#timeMetricCard input[type="checkbox"]:not(#selectAllTime):not(:disabled)');
            timeCheckboxes.forEach(cb => {
                cb.checked = this.checked;
            });

            updateSelectedCount('time');
        });

        document.getElementById('selectAllNetwork').addEventListener('change', function() {
            const networkCheckboxes = document.querySelectorAll('#networkMetricCard input[type="checkbox"]:not(#selectAllNetwork):not(:disabled)');
            networkCheckboxes.forEach(cb => {
                cb.checked = this.checked;
            });

            updateSelectedCount('network');
        });

        document.getElementById('selectAllAccess').addEventListener('change', function() {
            const accessCheckboxes = document.querySelectorAll('#accessMetricCard input[type="checkbox"]:not(#selectAllAccess):not(:disabled)');
            accessCheckboxes.forEach(cb => {
                cb.checked = this.checked;
            });

            updateSelectedCount('access');
        });

        // ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¼ ì„ íƒëœ í•­ëª© ìˆ˜ ì—…ë°ì´íŠ¸
        function updateSelectedCount(type) {
            const cardId = type + 'MetricCard';
            const counterId = type + 'SelectedCount';
            const checkboxes = document.querySelectorAll(`#${cardId} input[type="checkbox"]:not(#selectAll${type.charAt(0).toUpperCase() + type.slice(1)}):not(:disabled):checked`);
            document.getElementById(counterId).textContent = `${checkboxes.length}ê°œ ì„ íƒë¨`;
        }

        // ê²½ê³  ì‹¬ê°ë„ì™€ ìœ„í—˜ ì ìˆ˜ ì„ê³„ê°’ ë§¤í•‘ ì •ì˜
        const severityRiskScoreMapping = {
            // ì‹¬ê°ë„ â†’ ìœ„í—˜ ì ìˆ˜ ë²”ìœ„ (ì¤‘ê°„ê°’)
            'info': 10,      // ì •ë³´: 0-20 (ì¤‘ê°„ê°’ 10)
            'low': 25,       // ë‚®ìŒ: 21-40 (ì¤‘ê°„ê°’ 25)
            'medium': 55,    // ë³´í†µ: 41-70 (ì¤‘ê°„ê°’ 55)
            'high': 80,      // ë†’ìŒ: 71-90 (ì¤‘ê°„ê°’ 80)
            'critical': 95   // ë§¤ìš° ë†’ìŒ: 91-100 (ì¤‘ê°„ê°’ 95)
        };

        // ìœ„í—˜ ì ìˆ˜ â†’ ê²½ê³  ì‹¬ê°ë„ ë§¤í•‘
        function getRiskScoreToSeverity(riskScore) {
            if (riskScore <= 20) return 'info';      // ì •ë³´
            else if (riskScore <= 40) return 'low';       // ë‚®ìŒ
            else if (riskScore <= 70) return 'medium';    // ë³´í†µ
            else if (riskScore <= 90) return 'high';      // ë†’ìŒ
            else return 'critical';                       // ë§¤ìš° ë†’ìŒ
        }

        // ê²½ê³  ì‹¬ê°ë„ ë³€ê²½ ì‹œ ìœ„í—˜ ì ìˆ˜ ìë™ ì¡°ì • (ì—°ë™ í”Œë˜ê·¸ë¡œ ë¬´í•œë£¨í”„ ë°©ì§€)
        let isSeverityUpdating = false;
        function onAlertSeverityChange() {
            if (isSeverityUpdating) return;

            const alertSeverity = document.getElementById('alertSeverity').value;
            const targetRiskScore = severityRiskScoreMapping[alertSeverity];

            if (targetRiskScore !== undefined) {
                isSeverityUpdating = true;
                document.getElementById('riskScore').value = targetRiskScore;
                document.getElementById('riskScoreValue').textContent = targetRiskScore;
                console.log(`ê²½ê³  ì‹¬ê°ë„ "${alertSeverity}" â†’ ìœ„í—˜ ì ìˆ˜ ${targetRiskScore}ë¡œ ìë™ ì¡°ì •`);
                isSeverityUpdating = false;
            }
        }

        // ìœ„í—˜ ì ìˆ˜ ë³€ê²½ ì‹œ ê²½ê³  ì‹¬ê°ë„ ìë™ ì¡°ì • (ì—°ë™ í”Œë˜ê·¸ë¡œ ë¬´í•œë£¨í”„ ë°©ì§€)
        let isRiskScoreUpdating = false;
        function onRiskScoreChange() {
            if (isRiskScoreUpdating) return;

            const riskScore = parseInt(document.getElementById('riskScore').value);
            const targetSeverity = getRiskScoreToSeverity(riskScore);

            isRiskScoreUpdating = true;
            document.getElementById('alertSeverity').value = targetSeverity;
            document.getElementById('riskScoreValue').textContent = riskScore;
            console.log(`ìœ„í—˜ ì ìˆ˜ ${riskScore} â†’ ê²½ê³  ì‹¬ê°ë„ "${targetSeverity}"ë¡œ ìë™ ì¡°ì •`);
            isRiskScoreUpdating = false;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        document.getElementById('alertSeverity').addEventListener('change', onAlertSeverityChange);
        document.getElementById('riskScore').addEventListener('input', onRiskScoreChange);

        // ê°œë³„ ì²´í¬ë°•ìŠ¤ ìƒíƒœì— ë”°ë¼ ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSelectAllCheckbox(categoryId, selectAllId) {
            const checkboxes = document.querySelectorAll(`#${categoryId} input[type="checkbox"]:not(#${selectAllId}):not(:disabled)`);
            const selectAllCheckbox = document.getElementById(selectAllId);

            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            const someChecked = Array.from(checkboxes).some(checkbox => checkbox.checked);

            selectAllCheckbox.checked = allChecked;
            selectAllCheckbox.indeterminate = someChecked && !allChecked;

            // ì„ íƒëœ í•­ëª© ìˆ˜ ì—…ë°ì´íŠ¸
            const type = categoryId.replace('MetricCard', '');
            updateSelectedCount(type);
        }

        // ê°œë³„ ì²´í¬ë°•ìŠ¤ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        document.querySelectorAll('#timeMetricCard input[type="checkbox"]:not(#selectAllTime)').forEach(checkbox => {
            checkbox.addEventListener('change', () => updateSelectAllCheckbox('timeMetricCard', 'selectAllTime'));
        });

        document.querySelectorAll('#networkMetricCard input[type="checkbox"]:not(#selectAllNetwork)').forEach(checkbox => {
            checkbox.addEventListener('change', () => updateSelectAllCheckbox('networkMetricCard', 'selectAllNetwork'));
        });

        document.querySelectorAll('#accessMetricCard input[type="checkbox"]:not(#selectAllAccess)').forEach(checkbox => {
            checkbox.addEventListener('change', () => updateSelectAllCheckbox('accessMetricCard', 'selectAllAccess'));
        });

        // ë¡œê·¸ ì†ŒìŠ¤ë³„ ë©”íŠ¸ë¦­ ê°€ìš©ì„± ë§¤íŠ¸ë¦­ìŠ¤ (í™•ì¥ëœ ë©”íŠ¸ë¦­)
        const logSourceMetrics = {
            'windows': {
                'name': 'Windows ì´ë²¤íŠ¸ ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'session_duration', 'after_hours', 'weekend_activity', 'login_frequency', 'session_overlap', 'idle_time']
                },
                'network_based': {
                    'available': false,
                    'metrics': [],
                    'reason': 'Windows ì´ë²¤íŠ¸ ë¡œê·¸ëŠ” ë„¤íŠ¸ì›Œí¬ ì •ë³´ë¥¼ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                },
                'access_based': {
                    'available': true,
                    'metrics': ['resource_access', 'auth_failures', 'privilege_escalation', 'admin_access', 'app_usage', 'system_command', 'remote_access']
                }
            },
            'ad': {
                'name': 'Active Directory',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'session_duration', 'after_hours', 'weekend_activity', 'login_frequency', 'session_overlap']
                },
                'network_based': {
                    'available': false,
                    'metrics': [],
                    'reason': 'Active DirectoryëŠ” ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                },
                'access_based': {
                    'available': true,
                    'metrics': ['resource_access', 'auth_failures', 'privilege_escalation', 'admin_access', 'app_usage', 'system_command', 'remote_access']
                }
            },
            'firewall': {
                'name': 'ë°©í™”ë²½ ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'after_hours', 'weekend_activity', 'timezone_anomaly']
                },
                'network_based': {
                    'available': true,
                    'metrics': ['ip_address', 'geo_location', 'data_volume', 'impossible_travel', 'network_device', 'bandwidth_usage', 'connection_pattern']
                },
                'access_based': {
                    'available': false,
                    'metrics': [],
                    'reason': 'ë°©í™”ë²½ ë¡œê·¸ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì¤€ì˜ ì ‘ê·¼ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                }
            },
            'proxy': {
                'name': 'í”„ë¡ì‹œ/ì›¹ ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'session_duration', 'after_hours', 'weekend_activity', 'login_frequency', 'timezone_anomaly']
                },
                'network_based': {
                    'available': true,
                    'metrics': ['ip_address', 'geo_location', 'data_volume', 'impossible_travel', 'network_device', 'bandwidth_usage', 'connection_pattern', 'proxy_bypass']
                },
                'access_based': {
                    'available': true,
                    'metrics': ['resource_access', 'auth_failures', 'file_download', 'app_usage', 'share_access']
                }
            },
            'vpn': {
                'name': 'VPN ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'session_duration', 'after_hours', 'weekend_activity', 'login_frequency', 'session_overlap', 'timezone_anomaly']
                },
                'network_based': {
                    'available': true,
                    'metrics': ['ip_address', 'geo_location', 'data_volume', 'impossible_travel', 'vpn_usage', 'network_device', 'bandwidth_usage', 'connection_pattern']
                },
                'access_based': {
                    'available': false,
                    'metrics': ['auth_failures'],
                    'reason': 'VPN ë¡œê·¸ëŠ” VPN ì—°ê²° ì •ë³´ë§Œ ì œê³µí•˜ë©°, ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ì€ ì¶”ì í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
                }
            },
            'dns': {
                'name': 'DNS ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'after_hours', 'weekend_activity', 'timezone_anomaly']
                },
                'network_based': {
                    'available': true,
                    'metrics': ['ip_address', 'geo_location', 'impossible_travel', 'connection_pattern']
                },
                'access_based': {
                    'available': false,
                    'metrics': [],
                    'reason': 'DNS ë¡œê·¸ëŠ” ë„ë©”ì¸ ìš”ì²­ ì •ë³´ë§Œ ì œê³µí•˜ë©°, ì¸ì¦ì´ë‚˜ ê¶Œí•œ ì •ë³´ëŠ” í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                }
            },
            'email': {
                'name': 'ì´ë©”ì¼ ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'after_hours', 'weekend_activity', 'login_frequency', 'timezone_anomaly']
                },
                'network_based': {
                    'available': true,
                    'metrics': ['ip_address', 'data_volume', 'impossible_travel', 'network_device']
                },
                'access_based': {
                    'available': true,
                    'metrics': ['resource_access', 'auth_failures', 'sensitive_data', 'file_download', 'email_behavior']
                }
            },
            'linux': {
                'name': 'ë¦¬ëˆ…ìŠ¤/ìœ ë‹‰ìŠ¤ ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'session_duration', 'after_hours', 'weekend_activity', 'login_frequency', 'session_overlap', 'idle_time', 'timezone_anomaly']
                },
                'network_based': {
                    'available': true,
                    'metrics': ['ip_address', 'geo_location', 'impossible_travel', 'connection_pattern']
                },
                'access_based': {
                    'available': true,
                    'metrics': ['resource_access', 'auth_failures', 'privilege_escalation', 'admin_access', 'app_usage', 'system_command', 'remote_access']
                }
            },
            'database': {
                'name': 'ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸',
                'time_based': {
                    'available': true,
                    'metrics': ['login_time', 'session_duration', 'after_hours', 'weekend_activity', 'login_frequency', 'idle_time']
                },
                'network_based': {
                    'available': false,
                    'metrics': [],
                    'reason': 'ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸ëŠ” ë„¤íŠ¸ì›Œí¬ ìˆ˜ì¤€ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'
                },
                'access_based': {
                    'available': true,
                    'metrics': ['resource_access', 'auth_failures', 'privilege_escalation', 'sensitive_data', 'admin_access', 'db_query', 'system_command']
                }
            }
        };

        function updateProgressBar() {
            for (let i = 1; i <= totalSteps; i++) {
                const stepCircle = document.getElementById(`step${i}`);

                if (i < currentStep) {
                    stepCircle.className = 'step-circle completed';
                    stepCircle.innerHTML = 'âœ“';
                } else if (i === currentStep) {
                    stepCircle.className = 'step-circle active';
                    stepCircle.innerHTML = i;
                } else {
                    stepCircle.className = 'step-circle inactive';
                    stepCircle.innerHTML = i;
                }
            }
        }

        function showStep(step) {
            for (let i = 1; i <= totalSteps; i++) {
                document.getElementById(`content${i}`).classList.remove('active');
            }

            document.getElementById(`content${step}`).classList.add('active');

            document.getElementById('prevBtn').disabled = step === 1;

            const nextBtn = document.getElementById('nextBtn');
            if (step === totalSteps) {
                nextBtn.innerHTML = 'í”„ë¡œíŒŒì¼ ìƒì„± ğŸš€';
                nextBtn.onclick = submitProfileForm;
            } else {
                nextBtn.innerHTML = 'ë‹¤ìŒ â†’';
                nextBtn.onclick = nextStep;
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                if (validateStep(currentStep)) {
                    currentStep++;
                    showStep(currentStep);
                    updateProgressBar();

                    if (currentStep === totalSteps) {
                        updateSummary();
                    }
                }
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                updateProgressBar();
            }
        }

        function validateStep(step) {
            switch(step) {
                case 1:
                    const profileName = document.getElementById('profileName').value.trim();
                    if (!profileName) {
                        alert('í”„ë¡œíŒŒì¼ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                case 2:
                    const selectedLogSource = document.querySelector('input[name="logSource"]:checked');
                    if (!selectedLogSource) {
                        alert('ë¡œê·¸ ì†ŒìŠ¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                case 3:
                    const metrics = document.querySelectorAll('#content3 input[type="checkbox"]:checked:not(:disabled):not(#selectAllTime):not(#selectAllNetwork):not(#selectAllAccess)');
                    if (metrics.length === 0) {
                        alert('ìµœì†Œ í•˜ë‚˜ì˜ ë¶„ì„ ë©”íŠ¸ë¦­ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return false;
                    }
                    return true;
                default:
                    return true;
            }
        }

        function updateMetricsBasedOnLogSource() {
            const selectedLogSource = document.querySelector('input[name="logSource"]:checked');
            if (!selectedLogSource) {
                disableAllMetrics();
                return;
            }

            const logType = selectedLogSource.value;
            const logConfig = logSourceMetrics[logType];

            const logInfo = document.getElementById('selectedLogInfo');
            const logSourceName = document.getElementById('logSourceName');
            const availableMetrics = document.getElementById('availableMetrics');

            logInfo.style.display = 'block';
            logSourceName.textContent = logConfig.name;

            const allAvailableMetrics = [];

            updateMetricCard('time', logConfig.time_based, allAvailableMetrics);
            updateMetricCard('network', logConfig.network_based, allAvailableMetrics);
            updateMetricCard('access', logConfig.access_based, allAvailableMetrics);

            availableMetrics.textContent = allAvailableMetrics.length > 0 ?
                allAvailableMetrics.join(', ') : 'ì‚¬ìš© ê°€ëŠ¥í•œ ë©”íŠ¸ë¦­ì´ ì—†ìŠµë‹ˆë‹¤';
        }

        // ë©”íŠ¸ë¦­ ì¹´ë“œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateMetricCard(type, config, allAvailableMetrics) {
            const cardId = type + 'MetricCard';
            const unavailableId = type + 'MetricUnavailable';
            const card = document.getElementById(cardId);
            const unavailableDiv = document.getElementById(unavailableId);
            const selectAllId = 'selectAll' + type.charAt(0).toUpperCase() + type.slice(1);
            const selectAllCheckbox = document.getElementById(selectAllId);
            const selectAllBtn = document.getElementById(selectAllId + 'Btn');

            if (config.available) {
                card.classList.remove('disabled');
                unavailableDiv.style.display = 'none';

                // ì „ì²´ ì„ íƒ ë²„íŠ¼ í™œì„±í™”
                selectAllBtn.disabled = false;
                selectAllBtn.style.opacity = '1';
                selectAllCheckbox.disabled = false;

                const checkboxes = card.querySelectorAll('input[type="checkbox"]:not(#' + selectAllId + ')');
                let enabledCount = 0;
                let checkedCount = 0;

                checkboxes.forEach(checkbox => {
                    const metricValue = checkbox.value;
                    if (config.metrics.includes(metricValue)) {
                        checkbox.disabled = false;
                        checkbox.parentElement.style.opacity = '1';
                        allAvailableMetrics.push(checkbox.nextElementSibling.textContent);
                        enabledCount++;
                        if (checkbox.checked) {
                            checkedCount++;
                        }
                    } else {
                        checkbox.disabled = true;
                        checkbox.checked = false;
                        checkbox.parentElement.style.opacity = '0.5';
                    }
                });

                // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                if (enabledCount > 0) {
                    selectAllCheckbox.checked = (checkedCount === enabledCount);
                    selectAllCheckbox.indeterminate = (checkedCount > 0 && checkedCount < enabledCount);
                } else {
                    selectAllCheckbox.checked = false;
                    selectAllCheckbox.indeterminate = false;
                }

                // ì„ íƒëœ í•­ëª© ìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById(type + 'SelectedCount').textContent = `${checkedCount}ê°œ ì„ íƒë¨`;
            } else {
                card.classList.add('disabled');
                unavailableDiv.style.display = 'block';

                // ì‚¬ìœ ê°€ ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€
                if (config.reason) {
                    unavailableDiv.textContent = config.reason;
                } else {
                    unavailableDiv.textContent = `ì´ ë¡œê·¸ ì†ŒìŠ¤ì—ì„œëŠ” ${type} ê¸°ë°˜ ë¶„ì„ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.`;
                }

                // ì „ì²´ ì„ íƒ ë²„íŠ¼ ë¹„í™œì„±í™”
                selectAllBtn.disabled = true;
                selectAllBtn.style.opacity = '0.5';
                selectAllCheckbox.disabled = true;
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;

                // ì„ íƒëœ í•­ëª© ìˆ˜ ì´ˆê¸°í™”
                document.getElementById(type + 'SelectedCount').textContent = '0ê°œ ì„ íƒë¨';

                const checkboxes = card.querySelectorAll('input[type="checkbox"]:not(#' + selectAllId + ')');
                checkboxes.forEach(checkbox => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
            }
        }

        function disableAllMetrics() {
            const logInfo = document.getElementById('selectedLogInfo');
            const availableMetrics = document.getElementById('availableMetrics');

            logInfo.style.display = 'none';
            availableMetrics.textContent = '-';

            // ëª¨ë“  ì¹´ë“œì™€ ì²´í¬ë°•ìŠ¤ ë¹„í™œì„±í™”
            const metricTypes = ['time', 'network', 'access'];

            metricTypes.forEach(type => {
                const cardId = type + 'MetricCard';
                const unavailableId = type + 'MetricUnavailable';
                const card = document.getElementById(cardId);
                const unavailableDiv = document.getElementById(unavailableId);
                const selectAllId = 'selectAll' + type.charAt(0).toUpperCase() + type.slice(1);
                const selectAllCheckbox = document.getElementById(selectAllId);
                const selectAllBtn = document.getElementById(selectAllId + 'Btn');

                card.classList.add('disabled');
                unavailableDiv.style.display = 'block';
                unavailableDiv.textContent = 'ë¡œê·¸ ì†ŒìŠ¤ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.';

                // ì „ì²´ ì„ íƒ ë²„íŠ¼ ë¹„í™œì„±í™”
                selectAllBtn.disabled = true;
                selectAllBtn.style.opacity = '0.5';
                selectAllCheckbox.disabled = true;
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;

                // ì„ íƒëœ í•­ëª© ìˆ˜ ì´ˆê¸°í™”
                document.getElementById(type + 'SelectedCount').textContent = '0ê°œ ì„ íƒë¨';

                const checkboxes = card.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.disabled = true;
                    checkbox.checked = false;
                });
            });
        }

        function setupLogSourceListeners() {
            const radioButtons = document.querySelectorAll('input[name="logSource"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    document.querySelectorAll('.radio-item').forEach(item => {
                        item.classList.remove('selected');
                    });

                    if (this.checked) {
                        this.closest('.radio-item').classList.add('selected');
                        updateMetricsBasedOnLogSource();
                    }
                });
            });

            // ë¼ë””ì˜¤ ì•„ì´í…œ í´ë¦­ ì‹œ ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒ
            document.querySelectorAll('.radio-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    // ì´ë¯¸ ë¼ë””ì˜¤ ë²„íŠ¼ ìì²´ë¥¼ í´ë¦­í•œ ê²½ìš° ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
                    if (e.target.type === 'radio') return;

                    const radio = this.querySelector('input[type="radio"]');
                    if (radio && !radio.disabled) {
                        radio.checked = true;

                        // ì„ íƒ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                        document.querySelectorAll('.radio-item').forEach(item => {
                            item.classList.remove('selected');
                        });
                        this.classList.add('selected');

                        // ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸
                        updateMetricsBasedOnLogSource();
                    }
                });
            });
        }

        function updateSummary() {
            document.getElementById('summaryName').textContent = document.getElementById('profileName').value || '-';
            document.getElementById('summaryType').textContent = document.getElementById('profileType').selectedOptions[0].textContent;
            document.getElementById('summaryScope').textContent = document.getElementById('analysisScope').selectedOptions[0].textContent;

            document.getElementById('summaryLearning').textContent = document.getElementById('learningPeriod').value + 'ì¼';

            const selectedLogSource = document.querySelector('input[name="logSource"]:checked');
            const sourcesContainer = document.getElementById('summaryDataSources');
            if (selectedLogSource) {
                const logConfig = logSourceMetrics[selectedLogSource.value];
                sourcesContainer.innerHTML = `<span class="tag">${logConfig.name}</span>`;
            } else {
                sourcesContainer.textContent = 'ì„ íƒëœ ì†ŒìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤';
            }

            // "ì „ì²´ ì„ íƒ" ì²´í¬ë°•ìŠ¤ëŠ” ì œì™¸í•˜ê³  ì„ íƒëœ ë©”íŠ¸ë¦­ë§Œ ê°€ì ¸ì˜¤ê¸°
            const selectedMetrics = Array.from(document.querySelectorAll('#content3 input[type="checkbox"]:checked:not(:disabled):not(#selectAllTime):not(#selectAllNetwork):not(#selectAllAccess)'))
                .map(cb => cb.nextElementSibling.textContent);

            console.log('ì„ íƒëœ ë©”íŠ¸ë¦­:', selectedMetrics); // ë””ë²„ê¹…ìš©

            const metricsContainer = document.getElementById('summaryMetrics');
            if (selectedMetrics.length > 0) {
                metricsContainer.innerHTML = selectedMetrics.map(metric => `<span class="tag">${metric}</span>`).join('');
            } else {
                metricsContainer.textContent = 'ì„ íƒëœ ë©”íŠ¸ë¦­ì´ ì—†ìŠµë‹ˆë‹¤';
            }

            document.getElementById('summarySensitivity').textContent = document.getElementById('anomalyThreshold').selectedOptions[0].textContent;
            document.getElementById('summaryRiskScore').textContent = document.getElementById('riskScore').value + 'ì ';

            // ì•Œë¦¼ ì„¤ì • ì²´í¬ë°•ìŠ¤ ëª…í™•í•˜ê²Œ ì‹ë³„
            const selectedAlerts = Array.from(document.querySelectorAll('#content4 input[type="checkbox"]:checked'))
                .map(cb => cb.nextElementSibling.textContent);

            console.log('ì„ íƒëœ ì•Œë¦¼:', selectedAlerts); // ë””ë²„ê¹…ìš©

            const alertsContainer = document.getElementById('summaryAlerts');
            if (selectedAlerts.length > 0) {
                alertsContainer.innerHTML = selectedAlerts.map(alert => `<span class="tag">${alert}</span>`).join('');
            } else {
                alertsContainer.textContent = 'ì•Œë¦¼ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤';
            }
        }

        // í”„ë¡œí•„ ìƒì„± í•¨ìˆ˜
        async function submitProfileForm() {
            const btn = document.getElementById('nextBtn');
            btn.disabled = true;
            btn.innerHTML = 'ìƒì„± ì¤‘... â³';

            try {
                // í”„ë¡œí•„ ë°ì´í„° ìˆ˜ì§‘
                const formData = {
                    name: document.getElementById('profileName').value,
                    description: document.getElementById('profileDescription').value,
                    profileType: document.getElementById('profileType').value,
                    analysisScope: document.getElementById('analysisScope').value,

                    // ë¡œê·¸ ì†ŒìŠ¤ ì •ë³´
                    logSource: document.querySelector('input[name="logSource"]:checked')?.value,
                    logSourceName: document.querySelector('input[name="logSource"]:checked') ?
                        logSourceMetrics[document.querySelector('input[name="logSource"]:checked').value].name : null,
                    logSourceType: document.querySelector('input[name="logSource"]:checked')?.value,
                    learningPeriod: document.getElementById('learningPeriod').value,
                };

                // ì¶”ê°€ ë°ì´í„°ëŠ” data í•„ë“œì— ì €ì¥
                const additionalData = {
                    // ë¶„ì„ ë©”íŠ¸ë¦­ - ì²´í¬ëœ í•­ëª©ë“¤ì˜ ë¼ë²¨ í…ìŠ¤íŠ¸ ìˆ˜ì§‘ (ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì œì™¸)
                    selectedMetrics: Array.from(document.querySelectorAll('#content3 input[type="checkbox"]:checked:not(:disabled):not(#selectAllTime):not(#selectAllNetwork):not(#selectAllAccess)'))
                        .map(cb => cb.nextElementSibling.textContent),

                    // ì„ê³„ê°’ ì„¤ì •
                    anomalyThreshold: document.getElementById('anomalyThreshold').selectedOptions[0].textContent,
                    alertSeverity: document.getElementById('alertSeverity').value,
                    riskScore: Math.max(1, parseInt(document.getElementById('riskScore').value)), // ìµœì†Œê°’ 1 ë³´ì¥

                    // ì•Œë¦¼ ì„¤ì •
                    alerts: Array.from(document.querySelectorAll('#content4 input[type="checkbox"]:checked'))
                        .map(cb => cb.nextElementSibling.textContent),
                };

                // í•œê¸€ ë©”íŠ¸ë¦­ì„ ì˜ì–´ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
                function translateMetricsToEnglish(koreanMetrics) {
                    const metricMap = {
                        // ì‹œê°„ ê¸°ë°˜ ë©”íŠ¸ë¦­ (8ê°œ)
                        'ë¡œê·¸ì¸ ì‹œê°„ íŒ¨í„´': 'login_time_pattern',
                        'ì„¸ì…˜ ì§€ì† ì‹œê°„': 'session_duration',
                        'ìœ íœ´ ì‹œê°„ íŒ¨í„´': 'idle_time_pattern',
                        'ë¹„í™œì„± ì‹œê°„ íŒ¨í„´': 'idle_time_pattern',
                        'ì—…ë¬´ì‹œê°„ ì™¸ í™œë™': 'after_hours_activity',
                        'ì£¼ë§/íœ´ì¼ ì ‘ê·¼': 'weekend_holiday_access',
                        'ë¡œê·¸ì¸ ë¹ˆë„ ë³€í™”': 'login_frequency_change',
                        'ë™ì‹œ ì„¸ì…˜ íƒì§€': 'concurrent_session_detection',
                        'ì‹œê°„ëŒ€ ì´ìƒ ì ‘ê·¼': 'timezone_anomaly_access',

                        // ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë©”íŠ¸ë¦­ (9ê°œ)
                        'IP ì£¼ì†Œ íŒ¨í„´': 'ip_address_pattern',
                        'ì§€ë¦¬ì  ìœ„ì¹˜ ë¶„ì„': 'geo_location_analysis',
                        'ë°ì´í„° ì „ì†¡ëŸ‰': 'data_volume_transfer',
                        'ë¶ˆê°€ëŠ¥í•œ ì´ë™ íƒì§€': 'impossible_travel_detection',
                        'VPN ì‚¬ìš© íŒ¨í„´': 'vpn_usage_pattern',
                        'ë””ë°”ì´ìŠ¤ ë³€ê²½ íƒì§€': 'network_device_change',
                        'ëŒ€ì—­í­ ì‚¬ìš©ëŸ‰ ì´ìƒ': 'bandwidth_usage_anomaly',
                        'ì—°ê²° íŒ¨í„´ ë¶„ì„': 'connection_pattern_analysis',
                        'í”„ë¡ì‹œ ìš°íšŒ ì‹œë„': 'proxy_bypass_attempt',

                        // ì ‘ê·¼ ê¸°ë°˜ ë©”íŠ¸ë¦­ (12ê°œ)
                        'ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ íŒ¨í„´': 'resource_access_pattern',
                        'ì¸ì¦ ì‹¤íŒ¨ íšŸìˆ˜': 'authentication_failure_count',
                        'ê¶Œí•œ ìƒìŠ¹ ì‹œë„': 'privilege_escalation_attempt',
                        'ë¯¼ê°í•œ ë°ì´í„° ì ‘ê·¼': 'sensitive_data_access',
                        'ë¯¼ê° ë°ì´í„° ì ‘ê·¼': 'sensitive_data_access',
                        'íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŒ¨í„´': 'file_download_pattern',
                        'ê´€ë¦¬ì ê¶Œí•œ ì‚¬ìš©': 'admin_privilege_usage',
                        'ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš© íŒ¨í„´': 'application_usage_pattern',
                        'ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ íŒ¨í„´': 'database_query_pattern',
                        'ì´ë©”ì¼ í–‰ë™ íŒ¨í„´': 'email_behavior_pattern',
                        'ì‹œìŠ¤í…œ ëª…ë ¹ì–´ ì‹¤í–‰': 'system_command_execution',
                        'ì›ê²© ì ‘ê·¼ íŒ¨í„´': 'remote_access_pattern',
                        'ê³µìœ  í´ë” ì ‘ê·¼': 'shared_folder_access'
                    };

                    console.log('=== ë©”íŠ¸ë¦­ ë²ˆì—­ ë””ë²„ê¹… ===');
                    console.log('ì…ë ¥ ë©”íŠ¸ë¦­ (í•œê¸€):', koreanMetrics);

                    const translatedMetrics = koreanMetrics.map(koreanMetric => {
                        const englishMetric = metricMap[koreanMetric] || koreanMetric;
                        console.log(`ë²ˆì—­: "${koreanMetric}" â†’ "${englishMetric}"`);
                        return englishMetric;
                    });

                    console.log('ë²ˆì—­ëœ ë©”íŠ¸ë¦­ (ì˜ë¬¸):', translatedMetrics);
                    console.log('=====================');

                    return translatedMetrics;
                }

                // ë¶„ì„ ë²”ìœ„ ë§¤í•‘ í•¨ìˆ˜ - ê³ ì •ê°’
                function mapAnalysisScope(scope) {
                    const scopeMap = {
                        'department': 'department',
                        'role': 'user_activity',
                        'global': 'organizational'
                    };
                    return scopeMap[scope] || 'department';
                }

                // anomalyThreshold í…ìŠ¤íŠ¸ë¥¼ alert_threshold ìˆ«ìë¡œ ë³€í™˜ (ì„œë²„ì™€ ì¼ê´€ëœ ê¸°ì¤€ê°’)
                function convertAnomalyThresholdToAlertThreshold(anomalyThreshold) {
                    const thresholdMap = {
                        'ë‚®ìŒ (ê´€ëŒ€í•¨)': 0.9,     // í™•ì‹¤í•œ ì´ìƒ ì§•í›„ë§Œ ì•Œë¦¼
                        'ë‚®ìŒ (ë³´ìˆ˜ì )': 0.9,     // í˜¸í™˜ì„± ìœ ì§€
                        'ë³´í†µ (ê¶Œì¥)': 0.8,       // ê· í˜• ì¡íŒ íƒì§€ (ê¸°ë³¸ê°’)
                        'ë†’ìŒ (ë¯¼ê°í•¨)': 0.6      // ì‘ì€ ë³€í™”ë„ ë¯¼ê°í•˜ê²Œ íƒì§€
                    };
                    return thresholdMap[anomalyThreshold] || 0.8;
                }

                // ì•Œë¦¼ ì„¤ì •ì„ notification_settings í˜•íƒœë¡œ ë³€í™˜
                function convertAlertsToNotificationSettings(alerts) {
                    return {
                        email_enabled: alerts.includes('ì´ë©”ì¼ ì•Œë¦¼'),
                        slack_enabled: alerts.includes('Slack ì•Œë¦¼'),
                        sms_enabled: alerts.includes('SMS ì•Œë¦¼'),
                        dashboard_enabled: alerts.includes('ëŒ€ì‹œë³´ë“œ í‘œì‹œ')
                    };
                }

                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ìš© ë°ì´í„° êµ¬ì¡°ë¡œ ë³€í™˜
                const translatedMetrics = translateMetricsToEnglish(additionalData.selectedMetrics);
                const mappedAnalysisScope = mapAnalysisScope(formData.analysisScope);
                const alertThreshold = convertAnomalyThresholdToAlertThreshold(additionalData.anomalyThreshold);
                const notificationSettings = convertAlertsToNotificationSettings(additionalData.alerts);

                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ìš© ì™„ì „í•œ í”„ë¡œíŒŒì¼ ë°ì´í„° êµ¬ì¡°
                const profileData = {
                    // ê¸°ë³¸ ì •ë³´
                    name: formData.name,
                    description: formData.description,
                    profile_type: formData.profileType,
                    analysis_scope: mappedAnalysisScope,
                    log_source: formData.logSourceType,
                    learning_period: parseInt(formData.learningPeriod),

                    // ë©”íŠ¸ë¦­ ì„¤ì •
                    selected_metrics: translatedMetrics,

                    // ì„ê³„ê°’ ì„¤ì •
                    threshold_settings: {
                        alert_threshold: alertThreshold,
                        warning_threshold: alertThreshold - 0.2,
                        minimum_deviation_score: 0.3,
                        risk_score_threshold: Math.max(1, parseInt(additionalData.riskScore)) // ìµœì†Œê°’ 1 ë³´ì¥
                    },

                    // ì•Œë¦¼ ì„¤ì •
                    notification_settings: notificationSettings,

                    // ë¡œì»¬ DBìš© ì¶”ê°€ ë°ì´í„° (í˜¸í™˜ì„± ìœ ì§€)
                    id: currentEditProfile || generateUniqueId(),
                    profileType: formData.profileType,
                    analysisScope: formData.analysisScope,
                    logSourceName: formData.logSourceName,
                    logSourceType: formData.logSourceType,
                    learningPeriod: formData.learningPeriod,
                    ...additionalData
                };

                console.log('===== ì™„ì „í•œ í”„ë¡œíŒŒì¼ ë°ì´í„° êµ¬ì¡° =====');
                console.log('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ìš© ë°ì´í„°:', {
                    name: profileData.name,
                    description: profileData.description,
                    profile_type: profileData.profile_type,
                    analysis_scope: profileData.analysis_scope,
                    log_source: profileData.log_source,
                    learning_period: profileData.learning_period,
                    selected_metrics: profileData.selected_metrics,
                    threshold_settings: profileData.threshold_settings,
                    notification_settings: profileData.notification_settings
                });
                console.log('ì „ì²´ í”„ë¡œíŒŒì¼ ë°ì´í„°:', profileData);
                console.log('=======================================');

                // ì„œë²„ì— ì €ì¥
                const saveResult = await saveProfile(profileData);
                console.log('í”„ë¡œí•„ ì €ì¥ ê²°ê³¼:', saveResult);

                if (saveResult) {
                    alert(`UBA í”„ë¡œíŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ${currentEditProfile ? 'ìˆ˜ì •' : 'ìƒì„±'}ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì‹œìŠ¤í…œì´ ê³§ í•™ìŠµì„ ì‹œì‘í•  ì˜ˆì •ì…ë‹ˆë‹¤.`);
                    btn.innerHTML = 'ì™„ë£Œ âœ…';

                    // ì¦‰ì‹œ í”„ë¡œí•„ ëª©ë¡ ê²€ì¦
                    const allProfiles = await fetchProfiles();
                    console.log('ì €ì¥ í›„ í˜„ì¬ í”„ë¡œí•„ ëª©ë¡:', allProfiles);
                    const savedProfile = allProfiles.find(p => p.id === profileData.id);
                    console.log('ì €ì¥ëœ í”„ë¡œí•„ í™•ì¸:', savedProfile);

                    // í˜ì´ì§€ ì´ë™ ë¡œì§ì„ ì¦‰ì‹œ ì‹¤í–‰
                    if (isModalMode()) {
                        // ë¶€ëª¨ ì°½ì— ë‹«ê¸° ì‹ í˜¸ ì „ë‹¬
                        window.parent.closeWizardModal();
                    } else {
                        // ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
                        window.location.href = 'index.html';
                    }
                } else {
                    alert('í”„ë¡œíŒŒì¼ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    btn.disabled = false;
                    btn.innerHTML = 'í”„ë¡œíŒŒì¼ ìƒì„± ğŸš€';
                }
            } catch (error) {
                console.error('í”„ë¡œíŒŒì¼ ìƒì„± ì˜¤ë¥˜:', error);
                alert('í”„ë¡œíŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                btn.disabled = false;
                btn.innerHTML = 'í”„ë¡œíŒŒì¼ ìƒì„± ğŸš€';
            }
        }

        // í”„ë¡œíŒŒì¼ ì €ì¥ í•¨ìˆ˜
        async function saveProfile(profileData) {
            try {
                // APIë¥¼ í†µí•´ ì„œë²„ì— ì €ì¥
                let result;
                if (currentEditProfile) {
                    // ê¸°ì¡´ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸
                    result = await updateProfile(currentEditProfile, profileData);
                } else {
                    // ìƒˆ í”„ë¡œíŒŒì¼ ìƒì„±
                    if (!profileData.id) {
                        profileData.id = generateUniqueId();
                    }
                    result = await createProfile(profileData);
                }

                return !!result; // ì €ì¥ ì„±ê³µ ì—¬ë¶€ ë°˜í™˜
            } catch (error) {
                console.error('í”„ë¡œíŒŒì¼ ì €ì¥ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ê³ ìœ  ID ìƒì„±
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // IDë¡œ í”„ë¡œíŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        async function getProfileById(id) {
            try {
                // APIë¥¼ í†µí•´ ì„œë²„ì—ì„œ í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸°
                return await fetchProfileById(id);
            } catch (error) {
                console.error('í”„ë¡œí•„ ì¡°íšŒ ì˜¤ë¥˜:', error);
                return null;
            }
        }

        // í¸ì§‘í•  í”„ë¡œíŒŒì¼ ID
        let currentEditProfile = null;

        // URLì—ì„œ í¸ì§‘ íŒŒë¼ë¯¸í„° í™•ì¸
        async function checkEditMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const editId = urlParams.get('edit');

            if (editId) {
                currentEditProfile = editId;
                await loadProfileData(editId);
            }

            // ëª¨ë‹¬ ëª¨ë“œì¸ ê²½ìš° ì·¨ì†Œ ë²„íŠ¼ ë™ì‘ ë³€ê²½
            if (isModalMode()) {
                const cancelBtn = document.querySelector('.btn-secondary[style*="margin-right: auto"]');
                if (cancelBtn) {
                    cancelBtn.onclick = function() {
                        if (confirm('ì‘ì—…ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                            window.parent.closeWizardModal();
                        }
                    };
                }
            }
        }

        // ëª¨ë‹¬ ëª¨ë“œì¸ì§€ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
        function isModalMode() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('modal') === 'true';
        }

        // í”„ë¡œíŒŒì¼ ë°ì´í„° ë¡œë“œ
        async function loadProfileData(profileId) {
            const profile = await getProfileById(profileId);
            if (!profile) {
                console.error('í”„ë¡œí•„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', profileId);
                return;
            }

            console.log('ë¶ˆëŸ¬ì˜¨ í”„ë¡œí•„ ë°ì´í„°:', profile);

            // í˜ì´ì§€ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
            document.querySelector('.header h1').textContent = 'UBA í”„ë¡œíŒŒì¼ í¸ì§‘';
            document.querySelector('.header p').textContent = profile.name + ' í”„ë¡œíŒŒì¼ì„ ìˆ˜ì •í•©ë‹ˆë‹¤';

            // ê¸°ë³¸ ì •ë³´ ì…ë ¥
            document.getElementById('profileName').value = profile.name;
            document.getElementById('profileDescription').value = profile.description || '';

            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì‘ë‹µì„ í”„ë¡ íŠ¸ì—”ë“œ í˜•ì‹ìœ¼ë¡œ ì—­ë³€í™˜ - ê³ ì •ê°’
            function reverseMapAnalysisScope(engineScope) {
                const reverseMap = {
                    'department': 'department',         // ë¶€ì„œë³„ â†’ ë¶€ì„œë³„
                    'user_activity': 'role',           // ì‚¬ìš©ì í™œë™ ë¶„ì„ â†’ ì—­í• ë³„
                    'organizational': 'global',        // ì¡°ì§ ë‹¨ìœ„ ë¶„ì„ â†’ ì „ì²´ ì¡°ì§
                    'network_access': 'role',          // ë„¤íŠ¸ì›Œí¬ ì ‘ê·¼ â†’ ì—­í• ë³„
                    'comprehensive': 'global'          // ì¢…í•© ë¶„ì„ â†’ ì „ì²´ ì¡°ì§
                };
                return reverseMap[engineScope] || 'department';
            }

            function reverseMapProfileType(engineType) {
                // í”„ë¡œíŒŒì¼ ìœ í˜•ì€ ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ê³¼ í”„ë¡ íŠ¸ì—”ë“œê°€ ë™ì¼í•˜ì§€ë§Œ,
                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ user â†’ user, entity â†’ entityë¡œ ê·¸ëŒ€ë¡œ ë§¤í•‘
                const reverseMap = {
                    'user': 'user',
                    'entity': 'entity',
                    'hybrid': 'hybrid'
                };
                return reverseMap[engineType] || 'user';
            }

            // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ê°’ ì„¤ì • (ì—­ë³€í™˜ ì ìš©)
            const frontendProfileType = reverseMapProfileType(profile.profile_type || profile.profileType);
            const frontendAnalysisScope = reverseMapAnalysisScope(profile.analysis_scope || profile.analysisScope);

            console.log('í”„ë¡œíŒŒì¼ ìœ í˜•/ë¶„ì„ ë²”ìœ„ ë³€í™˜:', {
                engine_profile_type: profile.profile_type,
                frontend_profile_type: frontendProfileType,
                engine_analysis_scope: profile.analysis_scope,
                frontend_analysis_scope: frontendAnalysisScope
            });

            setSelectValue('profileType', frontendProfileType);
            setSelectValue('analysisScope', frontendAnalysisScope);

            // í•™ìŠµ ê¸°ê°„ ì„¤ì • (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ë°ì´í„° ìš°ì„  ì ìš©)
            const learningPeriod = profile.learning_period || profile.learningPeriod;
            console.log('í•™ìŠµ ê¸°ê°„ ì„¤ì •:', {
                learning_period: profile.learning_period,
                learningPeriod: profile.learningPeriod,
                final: learningPeriod
            });
            setSelectValue('learningPeriod', learningPeriod);

            // ë¡œê·¸ ì†ŒìŠ¤ ì„ íƒ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì˜ log_sourceë„ í¬í•¨)
            const logSourceType = profile.log_source_type || profile.logSourceType || profile.log_source;
            console.log('ë¡œê·¸ ì†ŒìŠ¤ íƒ€ì…:', logSourceType);
            console.log('í”„ë¡œíŒŒì¼ ë¡œê·¸ ê´€ë ¨ í•„ë“œë“¤:', {
                log_source: profile.log_source,
                log_source_type: profile.log_source_type,
                logSourceType: profile.logSourceType
            });

            if (logSourceType) {
                const logSourceRadio = document.querySelector(`input[name="logSource"][value="${logSourceType}"]`);
                if (logSourceRadio) {
                    logSourceRadio.checked = true;
                    logSourceRadio.closest('.radio-item').classList.add('selected');
                    updateMetricsBasedOnLogSource();

                    // ë¡œê·¸ ì†ŒìŠ¤ ì„ íƒ í›„ ì¶©ë¶„í•œ ì‹œê°„ì´ ì§€ë‚˜ì•¼ ë©”íŠ¸ë¦­ ì—…ë°ì´íŠ¸ê°€ ì™„ë£Œë¨
                    await new Promise(resolve => setTimeout(resolve, 300));
                } else {
                    console.warn('ë¡œê·¸ ì†ŒìŠ¤ ë¼ë””ì˜¤ ë²„íŠ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', logSourceType);
                }
            }

            // ë°ì´í„° í•„ë“œì—ì„œ ì¶”ê°€ ì •ë³´ ì¶”ì¶œ
            const data = typeof profile.data === 'string' ? JSON.parse(profile.data || '{}') : (profile.data || {});
            console.log('ë°ì´í„° í•„ë“œ:', data);

            // 3ë‹¨ê³„: ë©”íŠ¸ë¦­ ì„¤ì •
            // ë©”íŠ¸ë¦­ ì²´í¬ë°•ìŠ¤ë¥¼ ì„¤ì •í•˜ê¸° ì „ì— ì¶©ë¶„í•œ ì§€ì—° ì‹œê°„ì„ ì¤Œ
            await new Promise(resolve => setTimeout(resolve, 800));

            // ì˜ì–´ ë©”íŠ¸ë¦­ì„ í•œê¸€ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
            function translateMetricsToKorean(englishMetrics) {
                const metricMap = {
                    // ì‹œê°„ ê¸°ë°˜ ë©”íŠ¸ë¦­
                    'login_time_pattern': 'ë¡œê·¸ì¸ ì‹œê°„ íŒ¨í„´',
                    'session_duration': 'ì„¸ì…˜ ì§€ì† ì‹œê°„',
                    'after_hours_activity': 'ì—…ë¬´ì‹œê°„ ì™¸ í™œë™',
                    'weekend_holiday_access': 'ì£¼ë§/íœ´ì¼ ì ‘ê·¼',
                    'login_frequency_change': 'ë¡œê·¸ì¸ ë¹ˆë„ ë³€í™”',
                    'concurrent_session_detection': 'ë™ì‹œ ì„¸ì…˜ íƒì§€',
                    'timezone_anomaly_access': 'ì‹œê°„ëŒ€ ì´ìƒ ì ‘ê·¼',
                    'idle_time_pattern': 'ìœ íœ´ ì‹œê°„ íŒ¨í„´',

                    // ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë©”íŠ¸ë¦­
                    'ip_address_pattern': 'IP ì£¼ì†Œ íŒ¨í„´',
                    'geo_location_analysis': 'ì§€ë¦¬ì  ìœ„ì¹˜ ë¶„ì„',
                    'data_volume_transfer': 'ë°ì´í„° ì „ì†¡ëŸ‰',
                    'impossible_travel_detection': 'ë¶ˆê°€ëŠ¥í•œ ì´ë™ íƒì§€',
                    'vpn_usage_pattern': 'VPN ì‚¬ìš© íŒ¨í„´',
                    'network_device_change': 'ë””ë°”ì´ìŠ¤ ë³€ê²½ íƒì§€',
                    'bandwidth_usage_anomaly': 'ëŒ€ì—­í­ ì‚¬ìš©ëŸ‰ ì´ìƒ',
                    'connection_pattern_analysis': 'ì—°ê²° íŒ¨í„´ ë¶„ì„',
                    'proxy_bypass_attempt': 'í”„ë¡ì‹œ ìš°íšŒ ì‹œë„',

                    // ì ‘ê·¼ ê¸°ë°˜ ë©”íŠ¸ë¦­
                    'authentication_failure_count': 'ì¸ì¦ ì‹¤íŒ¨ íšŸìˆ˜',
                    'privilege_escalation_attempt': 'ê¶Œí•œ ìƒìŠ¹ ì‹œë„',
                    'remote_access_pattern': 'ì›ê²© ì ‘ê·¼ íŒ¨í„´',
                    'resource_access_pattern': 'ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ íŒ¨í„´',
                    'sensitive_data_access': 'ë¯¼ê°í•œ ë°ì´í„° ì ‘ê·¼',
                    'file_download_pattern': 'íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŒ¨í„´',
                    'admin_privilege_usage': 'ê´€ë¦¬ì ê¶Œí•œ ì‚¬ìš©',
                    'application_usage_pattern': 'ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš© íŒ¨í„´',
                    'system_command_execution': 'ì‹œìŠ¤í…œ ëª…ë ¹ì–´ ì‹¤í–‰',
                    'database_query_pattern': 'ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ íŒ¨í„´',
                    'email_behavior_pattern': 'ì´ë©”ì¼ í–‰ë™ íŒ¨í„´',
                    'shared_folder_access': 'ê³µìœ  í´ë” ì ‘ê·¼'
                };

                return englishMetrics.map(englishMetric =>
                    metricMap[englishMetric] || englishMetric
                );
            }

            // ì„ íƒëœ ë©”íŠ¸ë¦­ ì •ë³´ë¥¼ ì—¬ëŸ¬ ê°€ëŠ¥í•œ ì†ŒìŠ¤ì—ì„œ ì°¾ìŒ
            let selectedMetrics = [];

            // data ê°ì²´ ì•ˆì— ìˆì„ ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ í˜•íƒœì˜ ë©”íŠ¸ë¦­ ë°ì´í„° í™•ì¸
            if (Array.isArray(data.selectedMetrics)) {
                selectedMetrics = data.selectedMetrics;
            } else if (Array.isArray(profile.selectedMetrics)) {
                selectedMetrics = profile.selectedMetrics;
            } else if (Array.isArray(profile.selected_metrics)) {
                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì‘ë‹µ (ì˜ì–´ ë©”íŠ¸ë¦­) - í•œê¸€ë¡œ ë³€í™˜
                selectedMetrics = translateMetricsToKorean(profile.selected_metrics);
                console.log('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ë©”íŠ¸ë¦­ ë³€í™˜:', {
                    original: profile.selected_metrics,
                    translated: selectedMetrics
                });
            } else if (data.metrics && Array.isArray(data.metrics)) {
                selectedMetrics = data.metrics;
            } else if (profile.metrics && Array.isArray(profile.metrics)) {
                selectedMetrics = profile.metrics;
            }

            console.log('ì ìš©í•  ì„ íƒëœ ë©”íŠ¸ë¦­:', selectedMetrics);

            // ë©”íŠ¸ë¦­ ì²´í¬ë°•ìŠ¤ ì„¤ì •
            if (selectedMetrics.length > 0) {
                const metricCheckboxes = document.querySelectorAll('#content3 input[type="checkbox"]:not(#selectAllTime):not(#selectAllNetwork):not(#selectAllAccess)');

                metricCheckboxes.forEach(checkbox => {
                    const metricLabel = checkbox.nextElementSibling.textContent.trim();
                    const isSelected = selectedMetrics.some(metric =>
                        metric === metricLabel ||
                        metric.includes(metricLabel) ||
                        metricLabel.includes(metric)
                    );

                    if (isSelected && !checkbox.disabled) {
                        checkbox.checked = true;
                        console.log('ë©”íŠ¸ë¦­ ì²´í¬ë¨:', metricLabel);
                    }
                });

                // ê° ì¹´í…Œê³ ë¦¬ë³„ ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateSelectAllCheckbox('timeMetricCard', 'selectAllTime');
                updateSelectAllCheckbox('networkMetricCard', 'selectAllNetwork');
                updateSelectAllCheckbox('accessMetricCard', 'selectAllAccess');

                // ì„ íƒëœ ë©”íŠ¸ë¦­ ìˆ˜ ì—…ë°ì´íŠ¸
                updateSelectedCount('time');
                updateSelectedCount('network');
                updateSelectedCount('access');
            }

            // 4ë‹¨ê³„: ì„ê³„ê°’ ì„¤ì •
            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì˜ threshold_settingsë¥¼ í”„ë¡ íŠ¸ì—”ë“œ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            function convertThresholdSettingsToFrontend(thresholdSettings) {
                if (!thresholdSettings) return {};

                // alert_threshold ê°’ì„ anomalyThreshold í…ìŠ¤íŠ¸ë¡œ ë³€í™˜ - ì„œë²„ì™€ ì¼ê´€ëœ ê¸°ì¤€ê°’
                let anomalyThreshold = 'medium';
                if (thresholdSettings.alert_threshold >= 0.9) {
                    anomalyThreshold = 'low';      // ë‚®ìŒ (ê´€ëŒ€í•¨) - alert_threshold 0.9
                } else if (thresholdSettings.alert_threshold >= 0.8) {
                    anomalyThreshold = 'medium';   // ë³´í†µ (ê¶Œì¥) - alert_threshold 0.8
                } else if (thresholdSettings.alert_threshold >= 0.6) {
                    anomalyThreshold = 'high';     // ë†’ìŒ (ë¯¼ê°í•¨) - alert_threshold 0.6
                } else {
                    anomalyThreshold = 'medium';   // ê¸°ë³¸ê°’
                }

                console.log('convertThresholdSettingsToFrontend - anomalyThreshold ë³€í™˜ (ê³ ì •ê°’):', {
                    alert_threshold: thresholdSettings.alert_threshold,
                    converted_anomalyThreshold: anomalyThreshold
                });

                // risk_score_thresholdë¥¼ alertSeverityë¡œ ë³€í™˜ (getRiskScoreToSeverityì™€ ì¼ì¹˜)
                let alertSeverity = 'medium';
                const riskScore = thresholdSettings.risk_score_threshold || 1;
                alertSeverity = getRiskScoreToSeverity(riskScore);

                const result = {
                    anomalyThreshold: anomalyThreshold,
                    alertSeverity: alertSeverity,
                    riskScore: thresholdSettings.risk_score_threshold || 70
                };

                console.log('convertThresholdSettingsToFrontend ìµœì¢… ê²°ê³¼:', result);
                return result;
            }

            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì˜ threshold_settings ì²˜ë¦¬
            let frontendThresholdData = {};
            if (profile.threshold_settings) {
                frontendThresholdData = convertThresholdSettingsToFrontend(profile.threshold_settings);
                console.log('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ threshold_settings ë³€í™˜:', {
                    original: profile.threshold_settings,
                    converted: frontendThresholdData
                });
            }

            // anomalyThreshold ì„¤ì • - ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ë°ì´í„° ìš°ì„  ì ìš©
            console.log('anomalyThreshold ì„¤ì • ë””ë²„ê¹…:', {
                frontendThresholdData_anomalyThreshold: frontendThresholdData.anomalyThreshold,
                data_anomalyThreshold: data.anomalyThreshold,
                profile_anomalyThreshold: profile.anomalyThreshold
            });

            const anomalyThreshold = frontendThresholdData.anomalyThreshold || data.anomalyThreshold || profile.anomalyThreshold;
            console.log('ìµœì¢… anomalyThreshold ê°’:', anomalyThreshold);

            if (anomalyThreshold) {
                if (['low', 'medium', 'high'].includes(anomalyThreshold)) {
                    setSelectValue('anomalyThreshold', anomalyThreshold);
                    console.log('anomalyThreshold ì„¤ì • ì™„ë£Œ:', anomalyThreshold);
                } else {
                    // í…ìŠ¤íŠ¸ ê°’ìœ¼ë¡œ ê²€ìƒ‰
                    const matchingOption = getKeyByText('anomalyThreshold', anomalyThreshold);
                    if (matchingOption) {
                        setSelectValue('anomalyThreshold', matchingOption);
                        console.log('í…ìŠ¤íŠ¸ ë§¤ì¹­ìœ¼ë¡œ anomalyThreshold ì„¤ì •:', matchingOption);
                    } else {
                        console.warn('ì ì ˆí•œ anomalyThreshold ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', anomalyThreshold);
                    }
                }
            } else {
                console.warn('anomalyThreshold ê°’ì´ ì—†ìŠµë‹ˆë‹¤');
            }

            // alertSeverity ì„¤ì • - ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ë°ì´í„° ìš°ì„  ì ìš©
            const alertSeverity = frontendThresholdData.alertSeverity || data.alertSeverity || profile.alertSeverity || 'medium';
            setSelectValue('alertSeverity', alertSeverity);

            // ìœ„í—˜ ì ìˆ˜ ì„¤ì • - ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ë°ì´í„° ìš°ì„  ì ìš© (0ì¼ ë•Œ 1ë¡œ ë³€í™˜)
            const hasRiskScore = frontendThresholdData.riskScore !== undefined && frontendThresholdData.riskScore !== null;

            if (hasRiskScore) {
                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì˜¨ ìœ„í—˜ ì ìˆ˜ ì‚¬ìš© (0ì´ë©´ 1ë¡œ ë³€í™˜)
                let riskScore = frontendThresholdData.riskScore;
                if (riskScore === 0) {
                    riskScore = 1;
                    console.log('ìœ„í—˜ ì ìˆ˜ 0ì„ 1ë¡œ ë³€í™˜');
                }
                document.getElementById('riskScore').value = riskScore;
                document.getElementById('riskScoreValue').textContent = riskScore;

                // ìœ„í—˜ ì ìˆ˜ì— ë§ëŠ” ì‹¬ê°ë„ë¡œ ë™ê¸°í™”
                const syncedSeverity = getRiskScoreToSeverity(riskScore);
                if (document.getElementById('alertSeverity').value !== syncedSeverity) {
                    console.log('ìœ„í—˜ ì ìˆ˜ ê¸°ì¤€ ì‹¬ê°ë„ ë™ê¸°í™”:', {
                        riskScore: riskScore,
                        syncedSeverity: syncedSeverity,
                        currentSeverity: document.getElementById('alertSeverity').value
                    });
                    setSelectValue('alertSeverity', syncedSeverity);
                }
            } else {
                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì‹¬ê°ë„ì— ë§ëŠ” ìœ„í—˜ ì ìˆ˜ë¡œ ë™ê¸°í™”
                if (alertSeverity && severityRiskScoreMapping[alertSeverity]) {
                    const syncedRiskScore = severityRiskScoreMapping[alertSeverity];
                    document.getElementById('riskScore').value = syncedRiskScore;
                    document.getElementById('riskScoreValue').textContent = syncedRiskScore;
                    console.log('ì‹¬ê°ë„ ê¸°ì¤€ ìœ„í—˜ ì ìˆ˜ ë™ê¸°í™”:', {
                        alertSeverity: alertSeverity,
                        syncedRiskScore: syncedRiskScore
                    });
                }
            }

            // ì•Œë¦¼ ì„¤ì • ì²´í¬ë°•ìŠ¤ ì„¤ì •
            let alerts = data.alerts || profile.alerts || [];

            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì˜ notification_settings ì²˜ë¦¬
            if (alerts.length === 0 && profile.notification_settings) {
                const notificationSettings = profile.notification_settings;
                console.log('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ notification_settings:', notificationSettings);

                alerts = [];
                if (notificationSettings.email_enabled) alerts.push('ì´ë©”ì¼ ì•Œë¦¼');
                if (notificationSettings.slack_enabled) alerts.push('Slack ì•Œë¦¼');
                if (notificationSettings.sms_enabled) alerts.push('SMS ì•Œë¦¼');
                if (notificationSettings.dashboard_enabled) alerts.push('ëŒ€ì‹œë³´ë“œ í‘œì‹œ');

                console.log('ë³€í™˜ëœ ì•Œë¦¼ ì„¤ì •:', alerts);
            }

            console.log('ìµœì¢… ì•Œë¦¼ ì„¤ì •:', alerts);

            // ì•Œë¦¼ ì²´í¬ë°•ìŠ¤ ì„¤ì • - êµ¬ì²´ì ì¸ IDë¡œ ì„¤ì •
            if (alerts.length > 0) {
                // ë¨¼ì € ëª¨ë“  ì²´í¬ë°•ìŠ¤ë¥¼ ì´ˆê¸°í™”
                document.getElementById('emailAlert').checked = false;
                document.getElementById('slackAlert').checked = false;
                document.getElementById('smsAlert').checked = false;
                document.getElementById('dashboardAlert').checked = false;

                // ì„¤ì •ëœ ì•Œë¦¼ë§Œ ì²´í¬
                alerts.forEach(alert => {
                    console.log('ì•Œë¦¼ ì„¤ì • ì²˜ë¦¬ ì¤‘:', alert);
                    if (alert === 'ì´ë©”ì¼ ì•Œë¦¼') {
                        document.getElementById('emailAlert').checked = true;
                        console.log('ì´ë©”ì¼ ì•Œë¦¼ ì²´í¬ë¨');
                    } else if (alert === 'Slack ì•Œë¦¼') {
                        document.getElementById('slackAlert').checked = true;
                        console.log('Slack ì•Œë¦¼ ì²´í¬ë¨');
                    } else if (alert === 'SMS ì•Œë¦¼') {
                        document.getElementById('smsAlert').checked = true;
                        console.log('SMS ì•Œë¦¼ ì²´í¬ë¨');
                    } else if (alert === 'ëŒ€ì‹œë³´ë“œ í‘œì‹œ') {
                        document.getElementById('dashboardAlert').checked = true;
                        console.log('ëŒ€ì‹œë³´ë“œ í‘œì‹œ ì²´í¬ë¨');
                    }
                });
            } else {
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ë©”ì¼ê³¼ ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ í™œì„±í™”
                document.getElementById('emailAlert').checked = true;
                document.getElementById('dashboardAlert').checked = true;
                console.log('ê¸°ë³¸ ì•Œë¦¼ ì„¤ì • ì ìš©ë¨');
            }

            // ì²´í¬ë°•ìŠ¤ ìƒíƒœ í™•ì¸
            console.log('ì•Œë¦¼ ì²´í¬ë°•ìŠ¤ ìµœì¢… ìƒíƒœ:', {
                email: document.getElementById('emailAlert').checked,
                slack: document.getElementById('slackAlert').checked,
                sms: document.getElementById('smsAlert').checked,
                dashboard: document.getElementById('dashboardAlert').checked
            });

            // 5ë‹¨ê³„: ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
            if (currentStep === totalSteps) {
                updateSummary();
            }
        }

        // ì…€ë ‰íŠ¸ ë°•ìŠ¤ ê°’ ì„¤ì • í—¬í¼ í•¨ìˆ˜
        function setSelectValue(selectId, value) {
            const select = document.getElementById(selectId);
            if (select && value !== null && value !== undefined) {
                const stringValue = String(value); // ìˆ«ìë“  ë¬¸ìì—´ì´ë“  ë¬¸ìì—´ë¡œ ë³€í™˜
                console.log(`setSelectValue: ${selectId} = ${value} (${typeof value}) -> "${stringValue}"`);

                for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === stringValue) {
                        select.selectedIndex = i;
                        console.log(`${selectId} ê°’ì´ ${stringValue}ë¡œ ì„¤ì •ë¨`);
                        break;
                    }
                }
            }
        }

        // í…ìŠ¤íŠ¸ë¡œ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ê°’ ì°¾ê¸°
        function getKeyByText(selectId, text) {
            const select = document.getElementById(selectId);
            if (select && text) {
                for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].textContent === text ||
                        select.options[i].textContent.includes(text) ||
                        text.includes(select.options[i].textContent)) {
                        return select.options[i].value;
                    }
                }
            }
            return null;
        }

        function resetWizard() {
            currentStep = 1;
            showStep(currentStep);
            updateProgressBar();

            document.getElementById('profileName').value = '';
            document.getElementById('profileDescription').value = '';
            document.getElementById('profileType').selectedIndex = 0;
            document.getElementById('analysisScope').selectedIndex = 0;
            document.getElementById('learningPeriod').selectedIndex = 2;
            document.getElementById('anomalyThreshold').selectedIndex = 1;
            document.getElementById('alertSeverity').selectedIndex = 2;
            document.getElementById('riskScore').value = 70;
            document.getElementById('riskScoreValue').textContent = '70';

            const radioButtons = document.querySelectorAll('input[name="logSource"]');
            radioButtons.forEach(radio => {
                radio.checked = false;
                radio.closest('.radio-item').classList.remove('selected');
            });

            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => {
                cb.checked = false;
                cb.disabled = false;
            });

            document.getElementById('emailAlert').checked = true;
            document.getElementById('dashboardAlert').checked = true;

            disableAllMetrics();

            // í¸ì§‘ ëª¨ë“œ ì´ˆê¸°í™”
            currentEditProfile = null;

            // í˜ì´ì§€ íƒ€ì´í‹€ ë³µì›
            document.querySelector('.header h1').textContent = 'UBA í”„ë¡œíŒŒì¼ ë§ˆë²•ì‚¬';
            document.querySelector('.header p').textContent = 'ì‚¬ìš©ì ë° ì—”í„°í‹° í–‰ë™ ë¶„ì„ í”„ë¡œíŒŒì¼ì„ ì‰½ê²Œ ì„¤ì •í•˜ì„¸ìš”';
        }

        // ìœ„í—˜ ì ìˆ˜ ìŠ¬ë¼ì´ë” ì—…ë°ì´íŠ¸
        document.getElementById('riskScore').addEventListener('input', function() {
            document.getElementById('riskScoreValue').textContent = this.value;
        });

        // ìŠ¤í… ì´ë™ ì‹œ ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
        function nextStep() {
            if (currentStep < totalSteps) {
                if (validateStep(currentStep)) {
                    currentStep++;
                    showStep(currentStep);
                    updateProgressBar();

                    if (currentStep === totalSteps) {
                        updateSummary();
                    }
                }
            }
        }

        // ì´ˆê¸°í™”
        updateProgressBar();
        showStep(currentStep);

        // ë¹„ë™ê¸° ì´ˆê¸°í™” í•¨ìˆ˜
        async function initializeWizard() {
            setupLogSourceListeners();
            disableAllMetrics();
            await checkEditMode(); // í¸ì§‘ ëª¨ë“œ í™•ì¸ (ë¹„ë™ê¸°)
        }

        // ì´ˆê¸°í™” ì‹¤í–‰
        setTimeout(() => {
            initializeWizard();
        }, 100);

        // ì·¨ì†Œ ë²„íŠ¼ ì¶”ê°€
        const buttonGroup = document.querySelector('.button-group');
        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'btn btn-secondary';
        cancelBtn.textContent = 'ì·¨ì†Œ';
        cancelBtn.style.marginRight = 'auto';
        cancelBtn.onclick = function() {
            if (confirm('ì‘ì—…ì„ ì·¨ì†Œí•˜ê³  ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ëª¨ë‹¬ ëª¨ë“œì¸ì§€ í™•ì¸
                if (isModalMode()) {
                    window.parent.closeWizardModal();
                } else {
                    window.location.href = 'index.html';
                }
            }
        };

        // prevBtn ì•ì— ì·¨ì†Œ ë²„íŠ¼ ì‚½ì…
        buttonGroup.insertBefore(cancelBtn, document.getElementById('prevBtn'));
    </script>
</body>
</html>
