<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë² ì´ìŠ¤ë¼ì¸ ê´€ë¦¬</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }

        .header-title h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .profile-header {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
        }

        .profile-meta {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .profile-meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .meta-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .meta-value {
            font-size: 1.1rem;
            color: #e2e8f0;
        }

        .profile-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            text-decoration: none;
        }

        .nav-item:hover {
            color: #e2e8f0;
        }

        .nav-item.active {
            color: #6366f1;
            border-bottom: 2px solid #6366f1;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5856eb, #7c3aed);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.7);
            color: #e2e8f0;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.9);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.7);
            color: white;
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.9);
            transform: translateY(-2px);
        }

        .dashboard-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        /* ë² ì´ìŠ¤ë¼ì¸ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .baseline-options {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .baseline-option {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .baseline-option label {
            width: 180px;
            color: #94a3b8;
        }

        .baseline-option select {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.5rem;
            color: #e2e8f0;
            padding: 0.5rem;
            font-size: 0.95rem;
            min-width: 200px;
        }

        .baseline-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .baseline-quality {
            margin-top: 2rem;
        }

        .quality-metric {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .quality-metric span:first-child {
            width: 150px;
            color: #94a3b8;
        }

        .progress-bar {
            height: 10px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 5px;
            flex: 1;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 5px;
        }

        .progress.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* í•™ìŠµ ë°ì´í„° ë¶„ì„ ì°¨íŠ¸ */
        .chart-container {
            background: rgba(15, 23, 42, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            color: #94a3b8;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-name {
            font-size: 1rem;
            color: #94a3b8;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* ì„ê³„ê°’ ì„¤ì • */
        .threshold-settings {
            margin-top: 2rem;
        }

        .threshold-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .threshold-option label {
            width: 180px;
            color: #94a3b8;
        }

        .threshold-slider {
            flex: 1;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slider-container input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 5px;
            border-radius: 5px;
            background: rgba(15, 23, 42, 0.5);
            outline: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }

        .slider-value {
            width: 50px;
            text-align: center;
            font-weight: 600;
            color: #f1f5f9;
        }

        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                gap: 1.5rem;
            }

            .profile-meta {
                flex-direction: column;
                gap: 0.75rem;
            }

            .baseline-option {
                flex-direction: column;
                align-items: flex-start;
            }

            .baseline-option label {
                margin-bottom: 0.5rem;
            }

            .baseline-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <div class="header-title">
                <h1>ë² ì´ìŠ¤ë¼ì¸ ê´€ë¦¬</h1>
                <p>í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ í•™ìŠµ ì„¤ì • ë° ê´€ë¦¬</p>
            </div>
            <button class="btn btn-secondary" onclick="goBackToList()">
                â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
        </div>

        <div class="profile-header">
            <div class="profile-info">
                <h2 class="profile-name" id="profileName">UBA í”„ë¡œíŒŒì¼ ì´ë¦„</h2>
                <div class="profile-meta">
                    <div class="profile-meta-item">
                        <div class="meta-label">í”„ë¡œíŒŒì¼ ìœ í˜•</div>
                        <div class="meta-value" id="profileType">ì‚¬ìš©ì í”„ë¡œíŒŒì¼</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">ë¡œê·¸ ì†ŒìŠ¤</div>
                        <div class="meta-value" id="logSource">Windows ì´ë²¤íŠ¸ ë¡œê·¸</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">ë§ˆì§€ë§‰ ë² ì´ìŠ¤ë¼ì¸ ì—…ë°ì´íŠ¸</div>
                        <div class="meta-value" id="lastBaselineUpdate">2025-05-15 08:30</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="profile-nav">
            <a href="uba_profile_results.html" class="nav-item">ë¶„ì„ ê²°ê³¼</a>
            <a href="uba_baseline_management.html" class="nav-item active">ë² ì´ìŠ¤ë¼ì¸ ê´€ë¦¬</a>
        </div>

        <!-- ë² ì´ìŠ¤ë¼ì¸ ì„¤ì • ì¹´ë“œ -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">ë² ì´ìŠ¤ë¼ì¸ í•™ìŠµ ì„¤ì •</h3>
            </div>
            <div style="padding: 1.5rem;">
                <div class="baseline-options">
                    <div class="baseline-option">
                        <label>ë² ì´ìŠ¤ë¼ì¸ ì¬í•™ìŠµ ì£¼ê¸°:</label>
                        <select id="retrainCycle">
                            <option>ìë™ (ë³€í™” ê°ì§€ì‹œ)</option>
                            <option>ì£¼ê°„</option>
                            <option selected>ì›”ê°„</option>
                            <option>ë¶„ê¸°</option>
                            <option>ìˆ˜ë™</option>
                        </select>
                    </div>
                    <div class="baseline-option">
                        <label>í•™ìŠµ ë°ì´í„° ê¸°ê°„:</label>
                        <select id="learningPeriod">
                            <option>ìµœê·¼ 7ì¼</option>
                            <option>ìµœê·¼ 14ì¼</option>
                            <option selected>ìµœê·¼ 30ì¼</option>
                            <option>ìµœê·¼ 60ì¼</option>
                            <option>ìµœê·¼ 90ì¼</option>
                            <option>ì „ì²´ ë°ì´í„°</option>
                        </select>
                    </div>
                    <div class="baseline-option">
                        <label>ì´ìƒ íƒì§€ ê°ë„:</label>
                        <div class="slider-container">
                            <input type="range" id="anomalySensitivity" min="1" max="10" value="5">
                            <span class="slider-value" id="anomalySensitivityValue">5</span>
                        </div>
                    </div>
                    <div class="baseline-buttons">
                        <button class="btn btn-primary" onclick="saveBaselineSettings()">ì„¤ì • ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="retrainBaseline()">ë² ì´ìŠ¤ë¼ì¸ ì§€ê¸ˆ ì¬í•™ìŠµ</button>
                        <button class="btn btn-danger" onclick="resetBaseline()">ë² ì´ìŠ¤ë¼ì¸ ë¦¬ì…‹</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë² ì´ìŠ¤ë¼ì¸ í’ˆì§ˆ ëª¨ë‹ˆí„°ë§ -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">ë² ì´ìŠ¤ë¼ì¸ í’ˆì§ˆ</h3>
            </div>
            <div style="padding: 1.5rem;">
                <div class="baseline-quality">
                    <div class="quality-metric">
                        <span>ë°ì´í„° ì¶©ë¶„ì„±:</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 85%" id="dataCompleteness"></div>
                        </div>
                        <span id="dataCompletenessValue">85%</span>
                    </div>
                    <div class="quality-metric">
                        <span>ëª¨ë¸ ì‹ ë¢°ë„:</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 92%" id="modelConfidence"></div>
                        </div>
                        <span id="modelConfidenceValue">92%</span>
                    </div>
                    <div class="quality-metric">
                        <span>ì´ìƒì¹˜ íƒì§€ìœ¨:</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 78%" id="anomalyDetection"></div>
                        </div>
                        <span id="anomalyDetectionValue">78%</span>
                    </div>
                    <div class="quality-metric">
                        <span>í•™ìŠµ ë°ì´í„° ê· í˜•:</span>
                        <div class="progress-bar">
                            <div class="progress warning" style="width: 65%" id="dataBalance"></div>
                        </div>
                        <span id="dataBalanceValue">65%</span>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: #f1f5f9; font-size: 1.1rem;">í•™ìŠµ ë°ì´í„° ê°œìš”</h4>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-name">ì´ í•™ìŠµ ì´ë²¤íŠ¸</div>
                            <div class="metric-value">14,589ê°œ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">ì¼í‰ê·  ì´ë²¤íŠ¸</div>
                            <div class="metric-value">486ê°œ</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">í•™ìŠµ ë°ì´í„° ê¸°ê°„</div>
                            <div class="metric-value">30ì¼</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                            <div class="metric-value">2025-05-15</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: #f1f5f9; font-size: 1.1rem;">ì‹œê°„ëŒ€ë³„ ë°ì´í„° ë¶„í¬</h4>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="timeDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„ê³„ê°’ ì„¤ì • ì¹´ë“œ -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">ì„ê³„ê°’ ì„¤ì •</h3>
            </div>
            <div style="padding: 1.5rem;">
                <div class="threshold-settings">
                    <div class="threshold-option">
                        <label>ìœ„í—˜ ì ìˆ˜ ì„ê³„ê°’:</label>
                        <div class="slider-container">
                            <input type="range" id="riskThreshold" min="1" max="100" value="70">
                            <span class="slider-value" id="riskThresholdValue">70</span>
                        </div>
                    </div>
                    <div class="threshold-option">
                        <label>í–‰ë™ í¸ì°¨ ê°ì§€ ë¯¼ê°ë„:</label>
                        <div class="slider-container">
                            <input type="range" id="behaviorSensitivity" min="1" max="10" value="7">
                            <span class="slider-value" id="behaviorSensitivityValue">7</span>
                        </div>
                    </div>
                    <div class="threshold-option">
                        <label>ì‹œê°„ íŒ¨í„´ ë¯¼ê°ë„:</label>
                        <div class="slider-container">
                            <input type="range" id="timeSensitivity" min="1" max="10" value="6">
                            <span class="slider-value" id="timeSensitivityValue">6</span>
                        </div>
                    </div>
                    <div class="threshold-option">
                        <label>ì•¡ì„¸ìŠ¤ íŒ¨í„´ ë¯¼ê°ë„:</label>
                        <div class="slider-container">
                            <input type="range" id="accessSensitivity" min="1" max="10" value="8">
                            <span class="slider-value" id="accessSensitivityValue">8</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="goBack()">ì´ì „ìœ¼ë¡œ</button>
            <button class="btn btn-primary" onclick="saveAllSettings()">ëª¨ë“  ì„¤ì • ì €ì¥</button>
        </div>
    </div>

    <script>
        let profileData = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            // URLì—ì„œ í”„ë¡œí•„ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('id');

            if (profileId) {
                loadProfileData(profileId);

                // ë„¤ë¹„ê²Œì´ì…˜ íƒ­ì˜ href ì†ì„± ì—…ë°ì´íŠ¸
                const navLinks = document.querySelectorAll('.profile-nav a');
                navLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href.indexOf('?') === -1) {
                        link.setAttribute('href', `${href}?id=${profileId}`);
                    }
                });

                // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ ì´ë²¤íŠ¸
                setupSliders();
            } else {
                alert('í”„ë¡œí•„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                goBackToList();
            }
        });

        // í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
        async function loadProfileData(profileId) {
            try {
                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ í”„ë¡œíŒŒì¼ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`/api/profiles/${profileId}`);
                if (!response.ok) {
                    throw new Error(`í”„ë¡œíŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨: ${response.status}`);
                }

                profileData = await response.json();
                console.log('í”„ë¡œíŒŒì¼ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', profileData);

                // í”„ë¡œí•„ ì •ë³´ í‘œì‹œ
                displayProfileInfo(profileData);

                // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì •ë³´ë„ ë¡œë“œ
                await loadBaselineStatus(profileId);

            } catch (error) {
                console.error('í”„ë¡œíŒŒì¼ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('í•´ë‹¹ í”„ë¡œíŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                goBackToList();
            }
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì •ë³´ ë¡œë“œ
        async function loadBaselineStatus(profileId) {
            try {
                const response = await fetch(`/api/profiles/${profileId}/baseline/status`);
                if (response.ok) {
                    const baselineStatus = await response.json();
                    console.log('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ:', baselineStatus);
                    displayBaselineStatus(baselineStatus);
                }

                // ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ë„ ë¡œë“œí•˜ì—¬ ì‹œê°„ëŒ€ë³„ ë°ì´í„° í‘œì‹œ
                await loadBaselineAnalysisResults(profileId);

            } catch (error) {
                console.warn('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:', error);
            }
        }

        // ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ ë¡œë“œ
        async function loadBaselineAnalysisResults(profileId) {
            try {
                const response = await fetch(`/api/profiles/${profileId}/baseline/results`);
                if (response.ok) {
                    const analysisResults = await response.json();
                    console.log('ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼:', analysisResults);

                    // ì‹œê°„ëŒ€ë³„ ë°ì´í„° ë¶„í¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    updateTimeDistributionChart(analysisResults);

                    // ë² ì´ìŠ¤ë¼ì¸ í’ˆì§ˆ ì •ë³´ ì—…ë°ì´íŠ¸
                    updateBaselineQualityInfo(analysisResults);
                } else {
                    console.warn('ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ ì¡°íšŒ ì‹¤íŒ¨:', response.status);
                    showNoDataMessage();
                }
            } catch (error) {
                console.warn('ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                showNoDataMessage();
            }
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì •ë³´ í‘œì‹œ
        function displayBaselineStatus(baselineStatus) {
            // ë² ì´ìŠ¤ë¼ì¸ ì¹´ë“œì— ì‹¤ì œ ìƒíƒœ ì •ë³´ í‘œì‹œ
            if (baselineStatus.baseline_count) {
                const baselineCard = document.querySelector('.dashboard-card .card-body p');
                if (baselineCard) {
                    baselineCard.innerHTML = `
                        í˜„ì¬ <strong>${baselineStatus.baseline_count}ê°œ</strong>ì˜ ë² ì´ìŠ¤ë¼ì¸ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.<br>
                        ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: <strong>${baselineStatus.latest_job ? new Date(baselineStatus.latest_job.completed_at || baselineStatus.latest_job.created_at).toLocaleDateString('ko-KR') : 'ì •ë³´ ì—†ìŒ'}</strong>
                    `;
                }
            }
        }

        // í”„ë¡œí•„ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        function displayProfileInfo(profile) {
            document.getElementById('profileName').textContent = profile.name;

            // í”„ë¡œíŒŒì¼ ìœ í˜• (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API êµ¬ì¡° ê¸°ì¤€)
            let profileTypeText;
            switch (profile.profile_type) {
                case 'user': profileTypeText = 'ì‚¬ìš©ì'; break;
                case 'entity': profileTypeText = 'ì—”í„°í‹°'; break;
                case 'hybrid': profileTypeText = 'í•˜ì´ë¸Œë¦¬ë“œ'; break;
                case 'group': profileTypeText = 'ê·¸ë£¹'; break;
                default: profileTypeText = 'ì‚¬ìš©ì ì •ì˜';
            }
            document.getElementById('profileType').textContent = profileTypeText + ' í”„ë¡œíŒŒì¼';

            // ë¡œê·¸ ì†ŒìŠ¤ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API êµ¬ì¡° ê¸°ì¤€)
            const logSourceMap = {
                'vpn': 'VPN',
                'proxy': 'í”„ë¡ì‹œ',
                'database': 'ë°ì´í„°ë² ì´ìŠ¤',
                'application': 'ì• í”Œë¦¬ì¼€ì´ì…˜',
                'system': 'ì‹œìŠ¤í…œ'
            };
            document.getElementById('logSource').textContent = logSourceMap[profile.log_source] || profile.log_source;
        }

        // ìŠ¬ë¼ì´ë” ì„¤ì •
        function setupSliders() {
            const sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                const valueDisplay = document.getElementById(`${slider.id}Value`);
                if (valueDisplay) {
                    // ì´ˆê¸°ê°’ ì„¤ì •
                    valueDisplay.textContent = slider.value;

                    // ê°’ ë³€ê²½ ì´ë²¤íŠ¸
                    slider.addEventListener('input', function() {
                        valueDisplay.textContent = this.value;
                    });
                }
            });
        }

        // ë² ì´ìŠ¤ë¼ì¸ ì¬í•™ìŠµ
        function retrainBaseline() {
            if (confirm('ë² ì´ìŠ¤ë¼ì¸ì„ ì§€ê¸ˆ ì¬í•™ìŠµí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.')) {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ì— API ìš”ì²­ì„ ë³´ëƒ„
                alert('ë² ì´ìŠ¤ë¼ì¸ ì¬í•™ìŠµì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì™„ë£Œë˜ë©´ ì•Œë¦¼ì„ ë°›ê²Œ ë©ë‹ˆë‹¤.');
            }
        }

        // ë² ì´ìŠ¤ë¼ì¸ ë¦¬ì…‹
        function resetBaseline() {
            if (confirm('ë² ì´ìŠ¤ë¼ì¸ì„ ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  í•™ìŠµëœ ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) {
                // ì‹¤ì œë¡œëŠ” ì„œë²„ì— API ìš”ì²­ì„ ë³´ëƒ„
                alert('ë² ì´ìŠ¤ë¼ì¸ì´ ë¦¬ì…‹ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê¸° ì‹œì‘í•©ë‹ˆë‹¤.');
            }
        }

        // ë² ì´ìŠ¤ë¼ì¸ ì„¤ì • ì €ì¥
        function saveBaselineSettings() {
            // ì„¤ì • ì €ì¥ ë¡œì§
            const settings = {
                retrainCycle: document.getElementById('retrainCycle').value,
                learningPeriod: document.getElementById('learningPeriod').value,
                anomalySensitivity: document.getElementById('anomalySensitivity').value
            };

            // ì‹¤ì œë¡œëŠ” ì„œë²„ì— API ìš”ì²­ì„ ë³´ëƒ„
            console.log('ì €ì¥ëœ ë² ì´ìŠ¤ë¼ì¸ ì„¤ì •:', settings);
            alert('ë² ì´ìŠ¤ë¼ì¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ëª¨ë“  ì„¤ì • ì €ì¥
        function saveAllSettings() {
            // ëª¨ë“  ì„¤ì • ì €ì¥ ë¡œì§
            const settings = {
                retrainCycle: document.getElementById('retrainCycle').value,
                learningPeriod: document.getElementById('learningPeriod').value,
                anomalySensitivity: document.getElementById('anomalySensitivity').value,
                riskThreshold: document.getElementById('riskThreshold').value,
                behaviorSensitivity: document.getElementById('behaviorSensitivity').value,
                timeSensitivity: document.getElementById('timeSensitivity').value,
                accessSensitivity: document.getElementById('accessSensitivity').value
            };

            // ì‹¤ì œë¡œëŠ” ì„œë²„ì— API ìš”ì²­ì„ ë³´ëƒ„
            console.log('ì €ì¥ëœ ëª¨ë“  ì„¤ì •:', settings);
            alert('ëª¨ë“  ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function goBackToList() {
            window.location.href = 'uba_integrated_management.html';
        }

        // ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°
        function goBack() {
            window.history.back();
        }

        // ì‹œê°„ëŒ€ë³„ ë°ì´í„° ë¶„í¬ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateTimeDistributionChart(analysisResults) {
            const ctx = document.getElementById('timeDistributionChart');
            if (!ctx || !analysisResults || !analysisResults.baselines) {
                return;
            }

            // ì‹œê°„ëŒ€ë³„ ë°ì´í„° ì¤€ë¹„ (0-23ì‹œê°„ëŒ€)
            const hourlyData = new Array(24).fill(0);
            const hourlyLabels = [];

            for (let i = 0; i < 24; i++) {
                hourlyLabels.push(`${i}ì‹œ`);
            }

            // ë² ì´ìŠ¤ë¼ì¸ ë°ì´í„°ì—ì„œ ì‹œê°„ëŒ€ë³„ ë¶„í¬ ê³„ì‚°
            analysisResults.baselines.forEach(baseline => {
                if (baseline.statistical_data) {
                    // login_time_pattern ë©”íŠ¸ë¦­ì—ì„œ ì‹œê°„ ì •ë³´ ì¶”ì¶œ
                    if (baseline.metric_name === 'login_time_pattern' && baseline.statistical_data.hourly_distribution) {
                        const distribution = baseline.statistical_data.hourly_distribution;
                        Object.keys(distribution).forEach(hour => {
                            const hourIndex = parseInt(hour);
                            if (hourIndex >= 0 && hourIndex < 24) {
                                hourlyData[hourIndex] += distribution[hour];
                            }
                        });
                    }
                }
            });

            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì°¨íŠ¸ë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (hourlyData.every(val => val === 0)) {
                showNoDataMessage();
                return;
            }

            // ê¸°ì¡´ ì°¨íŠ¸ ì œê±°
            if (window.timeChart) {
                window.timeChart.destroy();
            }

            // ìƒˆ ì°¨íŠ¸ ìƒì„±
            window.timeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hourlyLabels,
                    datasets: [{
                        label: 'í™œë™ ë¹ˆë„',
                        data: hourlyData,
                        backgroundColor: 'rgba(99, 102, 241, 0.6)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(51, 65, 85, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(51, 65, 85, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        // ë² ì´ìŠ¤ë¼ì¸ í’ˆì§ˆ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateBaselineQualityInfo(analysisResults) {
            if (!analysisResults || !analysisResults.baselines) {
                return;
            }

            // í’ˆì§ˆ ì ìˆ˜ ê³„ì‚°
            const qualityScores = analysisResults.baselines.map(b => b.quality_score || 0);
            const avgQuality = qualityScores.length > 0 ?
                (qualityScores.reduce((a, b) => a + b, 0) / qualityScores.length) : 0;

            // ë©”íŠ¸ë¦­ ì¹´ë“œ ì—…ë°ì´íŠ¸
            const metricCards = document.querySelectorAll('.metric-card');

            if (metricCards[0]) {
                metricCards[0].innerHTML = `
                    <div class="metric-name">í™œì„± ë² ì´ìŠ¤ë¼ì¸</div>
                    <div class="metric-value">${analysisResults.baselines.length}ê°œ</div>
                `;
            }

            if (metricCards[1]) {
                metricCards[1].innerHTML = `
                    <div class="metric-name">í‰ê·  í’ˆì§ˆ ì ìˆ˜</div>
                    <div class="metric-value">${(avgQuality * 100).toFixed(1)}%</div>
                `;
            }

            if (metricCards[2]) {
                const latestBaseline = analysisResults.baselines[0];
                const learningPeriod = profileData?.learning_period || 30;
                metricCards[2].innerHTML = `
                    <div class="metric-name">í•™ìŠµ ë°ì´í„° ê¸°ê°„</div>
                    <div class="metric-value">${learningPeriod}ì¼</div>
                `;
            }

            if (metricCards[3]) {
                const latestBaseline = analysisResults.baselines[0];
                const updateDate = latestBaseline?.created_at ?
                    new Date(latestBaseline.created_at).toLocaleDateString('ko-KR') :
                    new Date().toLocaleDateString('ko-KR');
                metricCards[3].innerHTML = `
                    <div class="metric-name">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                    <div class="metric-value">${updateDate}</div>
                `;
            }
        }

        // ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ í‘œì‹œ
        function showNoDataMessage() {
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: #94a3b8;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“Š</div>
                        <div>ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem;">ë² ì´ìŠ¤ë¼ì¸ ìƒì„± í›„ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
