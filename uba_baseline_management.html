<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>베이스라인 관리</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #e2e8f0;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }

        .header-title h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-title p {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .profile-header {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #f1f5f9;
        }

        .profile-meta {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
        }

        .profile-meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .meta-label {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .meta-value {
            font-size: 1.1rem;
            color: #e2e8f0;
        }

        .profile-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            text-decoration: none;
        }

        .nav-item:hover {
            color: #e2e8f0;
        }

        .nav-item.active {
            color: #6366f1;
            border-bottom: 2px solid #6366f1;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5856eb, #7c3aed);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.7);
            color: #e2e8f0;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.9);
            transform: translateY(-2px);
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.7);
            color: white;
        }

        .btn-danger:hover {
            background: rgba(239, 68, 68, 0.9);
            transform: translateY(-2px);
        }

        .dashboard-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        /* 베이스라인 관련 스타일 */
        .baseline-options {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .baseline-option {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .baseline-option label {
            width: 180px;
            color: #94a3b8;
        }

        .baseline-option select {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 0.5rem;
            color: #e2e8f0;
            padding: 0.5rem;
            font-size: 0.95rem;
            min-width: 200px;
        }

        .baseline-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .baseline-quality {
            margin-top: 2rem;
        }

        .quality-metric {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .quality-metric span:first-child {
            width: 150px;
            color: #94a3b8;
        }

        .progress-bar {
            height: 10px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 5px;
            flex: 1;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 5px;
        }

        .progress.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        /* 학습 데이터 분석 차트 */
        .chart-container {
            background: rgba(15, 23, 42, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            color: #94a3b8;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .metric-name {
            font-size: 1rem;
            color: #94a3b8;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* 임계값 설정 */
        .threshold-settings {
            margin-top: 2rem;
        }

        .threshold-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .threshold-option label {
            width: 180px;
            color: #94a3b8;
        }

        .threshold-slider {
            flex: 1;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slider-container input[type="range"] {
            flex: 1;
            -webkit-appearance: none;
            height: 5px;
            border-radius: 5px;
            background: rgba(15, 23, 42, 0.5);
            outline: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #6366f1;
            cursor: pointer;
        }

        .slider-value {
            width: 50px;
            text-align: center;
            font-weight: 600;
            color: #f1f5f9;
        }

        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                gap: 1.5rem;
            }

            .profile-meta {
                flex-direction: column;
                gap: 0.75rem;
            }

            .baseline-option {
                flex-direction: column;
                align-items: flex-start;
            }

            .baseline-option label {
                margin-bottom: 0.5rem;
            }

            .baseline-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <div class="header-title">
                <h1>베이스라인 관리</h1>
                <p>프로파일의 베이스라인 학습 설정 및 관리</p>
            </div>
            <button class="btn btn-secondary" onclick="goBackToList()">
                ← 목록으로 돌아가기
            </button>
        </div>

        <div class="profile-header">
            <div class="profile-info">
                <h2 class="profile-name" id="profileName">UBA 프로파일 이름</h2>
                <div class="profile-meta">
                    <div class="profile-meta-item">
                        <div class="meta-label">프로파일 유형</div>
                        <div class="meta-value" id="profileType">사용자 프로파일</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">로그 소스</div>
                        <div class="meta-value" id="logSource">Windows 이벤트 로그</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">마지막 베이스라인 업데이트</div>
                        <div class="meta-value" id="lastBaselineUpdate">2025-05-15 08:30</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="profile-nav">
            <a href="uba_profile_results.html" class="nav-item">분석 결과</a>
            <a href="uba_baseline_management.html" class="nav-item active">베이스라인 관리</a>
        </div>

        <!-- 베이스라인 설정 카드 -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">베이스라인 학습 설정</h3>
            </div>
            <div style="padding: 1.5rem;">
                <div class="baseline-options">
                    <div class="baseline-option">
                        <label>베이스라인 재학습 주기:</label>
                        <select id="retrainCycle">
                            <option>자동 (변화 감지시)</option>
                            <option>주간</option>
                            <option selected>월간</option>
                            <option>분기</option>
                            <option>수동</option>
                        </select>
                    </div>
                    <div class="baseline-option">
                        <label>학습 데이터 기간:</label>
                        <select id="learningPeriod">
                            <option>최근 7일</option>
                            <option>최근 14일</option>
                            <option selected>최근 30일</option>
                            <option>최근 60일</option>
                            <option>최근 90일</option>
                            <option>전체 데이터</option>
                        </select>
                    </div>
                    <div class="baseline-option">
                        <label>이상 탐지 감도:</label>
                        <div class="slider-container">
                            <input type="range" id="anomalySensitivity" min="1" max="10" value="5">
                            <span class="slider-value" id="anomalySensitivityValue">5</span>
                        </div>
                    </div>
                    <div class="baseline-buttons">
                        <button class="btn btn-primary" onclick="saveBaselineSettings()">설정 저장</button>
                        <button class="btn btn-secondary" onclick="retrainBaseline()">베이스라인 지금 재학습</button>
                        <button class="btn btn-danger" onclick="resetBaseline()">베이스라인 리셋</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 베이스라인 품질 모니터링 -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">베이스라인 품질</h3>
            </div>
            <div style="padding: 1.5rem;">
                <div class="baseline-quality">
                    <div class="quality-metric">
                        <span>데이터 충분성:</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 85%" id="dataCompleteness"></div>
                        </div>
                        <span id="dataCompletenessValue">85%</span>
                    </div>
                    <div class="quality-metric">
                        <span>모델 신뢰도:</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 92%" id="modelConfidence"></div>
                        </div>
                        <span id="modelConfidenceValue">92%</span>
                    </div>
                    <div class="quality-metric">
                        <span>이상치 탐지율:</span>
                        <div class="progress-bar">
                            <div class="progress" style="width: 78%" id="anomalyDetection"></div>
                        </div>
                        <span id="anomalyDetectionValue">78%</span>
                    </div>
                    <div class="quality-metric">
                        <span>학습 데이터 균형:</span>
                        <div class="progress-bar">
                            <div class="progress warning" style="width: 65%" id="dataBalance"></div>
                        </div>
                        <span id="dataBalanceValue">65%</span>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: #f1f5f9; font-size: 1.1rem;">학습 데이터 개요</h4>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-name">총 학습 이벤트</div>
                            <div class="metric-value">14,589개</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">일평균 이벤트</div>
                            <div class="metric-value">486개</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">학습 데이터 기간</div>
                            <div class="metric-value">30일</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-name">마지막 업데이트</div>
                            <div class="metric-value">2025-05-15</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: #f1f5f9; font-size: 1.1rem;">시간대별 데이터 분포</h4>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="timeDistributionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 임계값 설정 카드 -->
        <div class="dashboard-card">
            <div class="card-header">
                <h3 class="card-title">임계값 설정</h3>
            </div>
            <div style="padding: 1.5rem;">
                <div class="threshold-settings">
                    <div class="threshold-option">
                        <label>위험 점수 임계값:</label>
                        <div class="slider-container">
                            <input type="range" id="riskThreshold" min="1" max="100" value="70">
                            <span class="slider-value" id="riskThresholdValue">70</span>
                        </div>
                    </div>
                    <div class="threshold-option">
                        <label>행동 편차 감지 민감도:</label>
                        <div class="slider-container">
                            <input type="range" id="behaviorSensitivity" min="1" max="10" value="7">
                            <span class="slider-value" id="behaviorSensitivityValue">7</span>
                        </div>
                    </div>
                    <div class="threshold-option">
                        <label>시간 패턴 민감도:</label>
                        <div class="slider-container">
                            <input type="range" id="timeSensitivity" min="1" max="10" value="6">
                            <span class="slider-value" id="timeSensitivityValue">6</span>
                        </div>
                    </div>
                    <div class="threshold-option">
                        <label>액세스 패턴 민감도:</label>
                        <div class="slider-container">
                            <input type="range" id="accessSensitivity" min="1" max="10" value="8">
                            <span class="slider-value" id="accessSensitivityValue">8</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="goBack()">이전으로</button>
            <button class="btn btn-primary" onclick="saveAllSettings()">모든 설정 저장</button>
        </div>
    </div>

    <script>
        let profileData = null;

        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', () => {
            // URL에서 프로필 ID 가져오기
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('id');

            if (profileId) {
                loadProfileData(profileId);

                // 네비게이션 탭의 href 속성 업데이트
                const navLinks = document.querySelectorAll('.profile-nav a');
                navLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    if (href.indexOf('?') === -1) {
                        link.setAttribute('href', `${href}?id=${profileId}`);
                    }
                });

                // 슬라이더 값 표시 이벤트
                setupSliders();
            } else {
                alert('프로필 정보를 찾을 수 없습니다.');
                goBackToList();
            }
        });

        // 프로필 정보 로드
        async function loadProfileData(profileId) {
            try {
                // 베이스라인 엔진에서 프로파일 정보 가져오기
                const response = await fetch(`/api/profiles/${profileId}`);
                if (!response.ok) {
                    throw new Error(`프로파일 조회 실패: ${response.status}`);
                }

                profileData = await response.json();
                console.log('프로파일 데이터 로드 성공:', profileData);

                // 프로필 정보 표시
                displayProfileInfo(profileData);

                // 베이스라인 상태 정보도 로드
                await loadBaselineStatus(profileId);

            } catch (error) {
                console.error('프로파일 정보 로드 실패:', error);
                alert('해당 프로파일을 찾을 수 없습니다.');
                goBackToList();
            }
        }

        // 베이스라인 상태 정보 로드
        async function loadBaselineStatus(profileId) {
            try {
                const response = await fetch(`/api/profiles/${profileId}/baseline/status`);
                if (response.ok) {
                    const baselineStatus = await response.json();
                    console.log('베이스라인 상태:', baselineStatus);
                    displayBaselineStatus(baselineStatus);
                }

                // 베이스라인 분석 결과도 로드하여 시간대별 데이터 표시
                await loadBaselineAnalysisResults(profileId);

            } catch (error) {
                console.warn('베이스라인 상태 조회 실패:', error);
            }
        }

        // 베이스라인 분석 결과 로드
        async function loadBaselineAnalysisResults(profileId) {
            try {
                const response = await fetch(`/api/profiles/${profileId}/baseline/results`);
                if (response.ok) {
                    const analysisResults = await response.json();
                    console.log('베이스라인 분석 결과:', analysisResults);

                    // 시간대별 데이터 분포 차트 업데이트
                    updateTimeDistributionChart(analysisResults);

                    // 베이스라인 품질 정보 업데이트
                    updateBaselineQualityInfo(analysisResults);
                } else {
                    console.warn('베이스라인 분석 결과 조회 실패:', response.status);
                    showNoDataMessage();
                }
            } catch (error) {
                console.warn('베이스라인 분석 결과 로드 실패:', error);
                showNoDataMessage();
            }
        }

        // 베이스라인 상태 정보 표시
        function displayBaselineStatus(baselineStatus) {
            // 베이스라인 카드에 실제 상태 정보 표시
            if (baselineStatus.baseline_count) {
                const baselineCard = document.querySelector('.dashboard-card .card-body p');
                if (baselineCard) {
                    baselineCard.innerHTML = `
                        현재 <strong>${baselineStatus.baseline_count}개</strong>의 베이스라인이 활성화되어 있습니다.<br>
                        마지막 업데이트: <strong>${baselineStatus.latest_job ? new Date(baselineStatus.latest_job.completed_at || baselineStatus.latest_job.created_at).toLocaleDateString('ko-KR') : '정보 없음'}</strong>
                    `;
                }
            }
        }

        // 프로필 기본 정보 표시
        function displayProfileInfo(profile) {
            document.getElementById('profileName').textContent = profile.name;

            // 프로파일 유형 (베이스라인 엔진 API 구조 기준)
            let profileTypeText;
            switch (profile.profile_type) {
                case 'user': profileTypeText = '사용자'; break;
                case 'entity': profileTypeText = '엔터티'; break;
                case 'hybrid': profileTypeText = '하이브리드'; break;
                case 'group': profileTypeText = '그룹'; break;
                default: profileTypeText = '사용자 정의';
            }
            document.getElementById('profileType').textContent = profileTypeText + ' 프로파일';

            // 로그 소스 (베이스라인 엔진 API 구조 기준)
            const logSourceMap = {
                'vpn': 'VPN',
                'proxy': '프록시',
                'database': '데이터베이스',
                'application': '애플리케이션',
                'system': '시스템'
            };
            document.getElementById('logSource').textContent = logSourceMap[profile.log_source] || profile.log_source;
        }

        // 슬라이더 설정
        function setupSliders() {
            const sliders = document.querySelectorAll('input[type="range"]');
            sliders.forEach(slider => {
                const valueDisplay = document.getElementById(`${slider.id}Value`);
                if (valueDisplay) {
                    // 초기값 설정
                    valueDisplay.textContent = slider.value;

                    // 값 변경 이벤트
                    slider.addEventListener('input', function() {
                        valueDisplay.textContent = this.value;
                    });
                }
            });
        }

        // 베이스라인 재학습
        function retrainBaseline() {
            if (confirm('베이스라인을 지금 재학습하시겠습니까? 이 작업은 오래 걸릴 수 있습니다.')) {
                // 실제로는 서버에 API 요청을 보냄
                alert('베이스라인 재학습이 시작되었습니다. 완료되면 알림을 받게 됩니다.');
            }
        }

        // 베이스라인 리셋
        function resetBaseline() {
            if (confirm('베이스라인을 리셋하시겠습니까? 모든 학습된 데이터가 삭제됩니다.')) {
                // 실제로는 서버에 API 요청을 보냄
                alert('베이스라인이 리셋되었습니다. 새로운 데이터를 수집하기 시작합니다.');
            }
        }

        // 베이스라인 설정 저장
        function saveBaselineSettings() {
            // 설정 저장 로직
            const settings = {
                retrainCycle: document.getElementById('retrainCycle').value,
                learningPeriod: document.getElementById('learningPeriod').value,
                anomalySensitivity: document.getElementById('anomalySensitivity').value
            };

            // 실제로는 서버에 API 요청을 보냄
            console.log('저장된 베이스라인 설정:', settings);
            alert('베이스라인 설정이 저장되었습니다.');
        }

        // 모든 설정 저장
        function saveAllSettings() {
            // 모든 설정 저장 로직
            const settings = {
                retrainCycle: document.getElementById('retrainCycle').value,
                learningPeriod: document.getElementById('learningPeriod').value,
                anomalySensitivity: document.getElementById('anomalySensitivity').value,
                riskThreshold: document.getElementById('riskThreshold').value,
                behaviorSensitivity: document.getElementById('behaviorSensitivity').value,
                timeSensitivity: document.getElementById('timeSensitivity').value,
                accessSensitivity: document.getElementById('accessSensitivity').value
            };

            // 실제로는 서버에 API 요청을 보냄
            console.log('저장된 모든 설정:', settings);
            alert('모든 설정이 저장되었습니다.');
        }

        // 목록으로 돌아가기
        function goBackToList() {
            window.location.href = 'uba_integrated_management.html';
        }

        // 이전 페이지로 돌아가기
        function goBack() {
            window.history.back();
        }

        // 시간대별 데이터 분포 차트 업데이트
        function updateTimeDistributionChart(analysisResults) {
            const ctx = document.getElementById('timeDistributionChart');
            if (!ctx || !analysisResults || !analysisResults.baselines) {
                return;
            }

            // 시간대별 데이터 준비 (0-23시간대)
            const hourlyData = new Array(24).fill(0);
            const hourlyLabels = [];

            for (let i = 0; i < 24; i++) {
                hourlyLabels.push(`${i}시`);
            }

            // 베이스라인 데이터에서 시간대별 분포 계산
            analysisResults.baselines.forEach(baseline => {
                if (baseline.statistical_data) {
                    // login_time_pattern 메트릭에서 시간 정보 추출
                    if (baseline.metric_name === 'login_time_pattern' && baseline.statistical_data.hourly_distribution) {
                        const distribution = baseline.statistical_data.hourly_distribution;
                        Object.keys(distribution).forEach(hour => {
                            const hourIndex = parseInt(hour);
                            if (hourIndex >= 0 && hourIndex < 24) {
                                hourlyData[hourIndex] += distribution[hour];
                            }
                        });
                    }
                }
            });

            // 데이터가 없는 경우 차트를 표시하지 않음
            if (hourlyData.every(val => val === 0)) {
                showNoDataMessage();
                return;
            }

            // 기존 차트 제거
            if (window.timeChart) {
                window.timeChart.destroy();
            }

            // 새 차트 생성
            window.timeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: hourlyLabels,
                    datasets: [{
                        label: '활동 빈도',
                        data: hourlyData,
                        backgroundColor: 'rgba(99, 102, 241, 0.6)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e2e8f0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(51, 65, 85, 0.3)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(51, 65, 85, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        // 베이스라인 품질 정보 업데이트
        function updateBaselineQualityInfo(analysisResults) {
            if (!analysisResults || !analysisResults.baselines) {
                return;
            }

            // 품질 점수 계산
            const qualityScores = analysisResults.baselines.map(b => b.quality_score || 0);
            const avgQuality = qualityScores.length > 0 ?
                (qualityScores.reduce((a, b) => a + b, 0) / qualityScores.length) : 0;

            // 메트릭 카드 업데이트
            const metricCards = document.querySelectorAll('.metric-card');

            if (metricCards[0]) {
                metricCards[0].innerHTML = `
                    <div class="metric-name">활성 베이스라인</div>
                    <div class="metric-value">${analysisResults.baselines.length}개</div>
                `;
            }

            if (metricCards[1]) {
                metricCards[1].innerHTML = `
                    <div class="metric-name">평균 품질 점수</div>
                    <div class="metric-value">${(avgQuality * 100).toFixed(1)}%</div>
                `;
            }

            if (metricCards[2]) {
                const latestBaseline = analysisResults.baselines[0];
                const learningPeriod = profileData?.learning_period || 30;
                metricCards[2].innerHTML = `
                    <div class="metric-name">학습 데이터 기간</div>
                    <div class="metric-value">${learningPeriod}일</div>
                `;
            }

            if (metricCards[3]) {
                const latestBaseline = analysisResults.baselines[0];
                const updateDate = latestBaseline?.created_at ?
                    new Date(latestBaseline.created_at).toLocaleDateString('ko-KR') :
                    new Date().toLocaleDateString('ko-KR');
                metricCards[3].innerHTML = `
                    <div class="metric-name">마지막 업데이트</div>
                    <div class="metric-value">${updateDate}</div>
                `;
            }
        }

        // 데이터 없음 메시지 표시
        function showNoDataMessage() {
            const chartContainer = document.querySelector('.chart-container');
            if (chartContainer) {
                chartContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: #94a3b8;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">📊</div>
                        <div>베이스라인 분석 결과가 없습니다</div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem;">베이스라인 생성 후 데이터가 표시됩니다</div>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
