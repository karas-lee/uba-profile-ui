<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBA í”„ë¡œíŒŒì¼ ë¶„ì„ ê²°ê³¼</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            color: #e2e8f0;
            min-height: 100vh;
            font-size: 0.9rem;
            padding: 20px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(30, 41, 59, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 30px;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.3rem;
        }

        .header-title p {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .profile-header {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.6rem;
            padding: 1.25rem;
            margin: 0 30px 1.5rem 30px;
            display: flex;
            justify-content: space-between;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: #f1f5f9;
        }

        .profile-meta {
            display: flex;
            gap: 1.5rem;
            margin-top: 0.75rem;
        }

        .profile-meta-item {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .meta-label {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .meta-value {
            font-size: 1rem;
            color: #e2e8f0;
        }

        .profile-score {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-width: 135px;
        }

        .profile-nav {
            display: flex;
            gap: 0.75rem;
            margin: 0 30px 1.5rem 30px;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }

        .nav-item {
            padding: 0.6rem 1.25rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            text-decoration: none;
        }

        .nav-item:hover {
            color: #e2e8f0;
        }

        .nav-item.active {
            color: #6366f1;
            border-bottom: 2px solid #6366f1;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: conic-gradient(#6366f1 0%, #6366f1 70%, #1f2937 70%, #1f2937 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            margin-bottom: 0.4rem;
        }

        .score-circle::after {
            content: '';
            position: absolute;
            width: 85px;
            height: 85px;
            border-radius: 50%;
            background: #1a2332;
        }

        .score-value {
            position: relative;
            z-index: 1;
            font-size: 1.8rem;
            font-weight: 700;
            color: #f1f5f9;
        }

        .score-label {
            font-size: 0.85rem;
            color: #94a3b8;
            text-align: center;
        }

        .risk-level {
            font-size: 1rem;
            font-weight: 600;
            color: #a5b4fc;
            margin-top: 0.4rem;
        }

        .btn {
            padding: 0.6rem 1.25rem;
            border: none;
            border-radius: 0.4rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5856eb, #7c3aed);
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: rgba(51, 65, 85, 0.7);
            color: #e2e8f0;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .btn-secondary:hover {
            background: rgba(51, 65, 85, 0.9);
            transform: translateY(-2px);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 0 30px 2rem 30px;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .dashboard-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(51, 65, 85, 0.3);
            border-radius: 0.75rem;
            padding: 1.5rem;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #f1f5f9;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .card-action {
            background: rgba(51, 65, 85, 0.5);
            border: none;
            border-radius: 0.375rem;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #94a3b8;
        }

        .card-action:hover {
            background: rgba(51, 65, 85, 0.8);
            color: #e2e8f0;
        }

        .chart-container {
            flex: 1;
            position: relative;
            min-height: 250px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .metric-item {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .metric-name {
            font-size: 0.9rem;
            color: #94a3b8;
        }

        .metric-value {
            font-size: 1.25rem;
            color: #f1f5f9;
            font-weight: 600;
        }

        .metric-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .indicator-normal {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .indicator-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .indicator-critical {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .table-container {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid rgba(51, 65, 85, 0.3);
        }

        .data-table th {
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .data-table tbody tr {
            transition: background-color 0.2s;
        }

        .data-table tbody tr:hover {
            background: rgba(51, 65, 85, 0.2);
        }

        .severity-high {
            color: #ef4444;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .severity-medium {
            color: #f59e0b;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .severity-low {
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .severity-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .severity-high .severity-indicator {
            background-color: #ef4444;
        }

        .severity-medium .severity-indicator {
            background-color: #f59e0b;
        }

        .severity-low .severity-indicator {
            background-color: #10b981;
        }

        .recommendations {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .recommendation-item {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            padding: 1.25rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .recommendation-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(99, 102, 241, 0.2);
            color: #a5b4fc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 0.5rem;
        }

        .recommendation-text {
            color: #94a3b8;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .activity-timeline {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding-left: 1rem;
            position: relative;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 10px;
            bottom: 10px;
            width: 2px;
            background: rgba(51, 65, 85, 0.5);
        }

        .timeline-item {
            position: relative;
            padding-left: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6366f1;
            border: 2px solid #1a2332;
        }

        .timeline-time {
            font-size: 0.8rem;
            color: #94a3b8;
            margin-bottom: 0.25rem;
        }

        .timeline-content {
            font-size: 0.9rem;
            color: #e2e8f0;
            line-height: 1.4;
        }

        .timeline-anomaly {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid rgba(239, 68, 68, 0.5);
            padding: 0.5rem;
            margin-top: 0.5rem;
            border-radius: 0 0.25rem 0.25rem 0;
        }

        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        @media (max-width: 992px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                gap: 1.5rem;
            }

            .profile-score {
                align-self: center;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ì°¨íŠ¸ ìŠ¤íƒ€ì¼ */
        .chart-placeholder {
            width: 100%;
            height: 250px;
            background: rgba(15, 23, 42, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        /* ë² ì´ìŠ¤ë¼ì¸ ë©”íŠ¸ë¦­ ë¹„êµ ìŠ¤íƒ€ì¼ */
        .baseline-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1rem;
        }

        .baseline-metric-item {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .baseline-metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .baseline-metric-name {
            font-size: 0.95rem;
            color: #94a3b8;
        }

        .baseline-deviation {
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
        }

        .baseline-deviation.low {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .baseline-deviation.medium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }

        .baseline-deviation.high {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .baseline-comparison-bar {
            height: 30px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 4px;
            position: relative;
            margin-top: 0.5rem;
        }

        .baseline-normal-range {
            position: absolute;
            top: 0;
            height: 100%;
            background: rgba(74, 222, 128, 0.2);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 0.5rem;
        }

        .baseline-min, .baseline-max {
            font-size: 0.75rem;
            color: #4ade80;
        }

        .baseline-current-value {
            position: absolute;
            top: -20px;
            transform: translateX(-50%);
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: #818cf8;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .baseline-current-value::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid rgba(99, 102, 241, 0.3);
        }

        .heatmap-container {
            height: 200px;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @media (max-width: 992px) {
            .baseline-metrics {
                grid-template-columns: 1fr;
            }
        }

        .normal-range-info {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 4px solid #28a745;
            padding: 12px;
            margin: 8px 0;
            border-radius: 6px;
            font-size: 0.9em;
            line-height: 1.5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .normal-range-info strong {
            color: #155724;
            display: block;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .normal-range-info br {
            line-height: 1.8;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <div class="header-title">
                <h1>UBA í”„ë¡œíŒŒì¼ ë¶„ì„ ê²°ê³¼</h1>
                <p>ì‚¬ìš©ì í–‰ë™ ë¶„ì„ ê²°ê³¼ ë° ì´ìƒ ì§•í›„ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            </div>
            <div class="header-actions">
                <a href="uba_individual_users.html" class="btn btn-secondary" style="text-decoration: none;">ğŸ‘¥ ê°œë³„ ì‚¬ìš©ì ë¶„ì„</a>
                <button class="btn btn-secondary" onclick="goBackToList()">
                    â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>

        <div class="profile-header">
            <div class="profile-info">
                <h2 class="profile-name" id="profileName">UBA í”„ë¡œíŒŒì¼ ì´ë¦„</h2>
                <div class="profile-meta">
                    <div class="profile-meta-item">
                        <div class="meta-label">í”„ë¡œíŒŒì¼ ìœ í˜•</div>
                        <div class="meta-value" id="profileType">ì‚¬ìš©ì í”„ë¡œíŒŒì¼</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">ë¡œê·¸ ì†ŒìŠ¤</div>
                        <div class="meta-value" id="logSource">Windows ì´ë²¤íŠ¸ ë¡œê·¸</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">ë¶„ì„ ê¸°ê°„</div>
                        <div class="meta-value" id="analysisPeriod">2025-05-01 ~ 2025-06-01</div>
                    </div>
                    <div class="profile-meta-item">
                        <div class="meta-label">ìƒì„±ì¼</div>
                        <div class="meta-value" id="creationDate">2025-04-15</div>
                    </div>
                </div>
            </div>
            <div class="profile-score">
                <div class="score-circle">
                    <div class="score-value" id="riskScore">70</div>
                </div>
                <div class="score-label">ìœ„í—˜ ì ìˆ˜</div>
                <div class="risk-level" id="riskLevel">ì¤‘ê°„ ìœ„í—˜</div>
            </div>
        </div>

                  <div class="profile-nav">
              <a href="uba_profile_results.html" class="nav-item active">í”„ë¡œíŒŒì¼ ë¶„ì„</a>
              <a href="uba_individual_users.html" class="nav-item">ê°œë³„ ì‚¬ìš©ì ë¶„ì„</a>
              <a href="#" class="nav-item" onclick="goToBaselineManagement()">ë² ì´ìŠ¤ë¼ì¸ ê´€ë¦¬</a>
          </div>

        <div class="dashboard-grid">








            <!-- ë©”íŠ¸ë¦­ ë¶„ì„ ê²°ê³¼ -->
            <div class="dashboard-card full-width">
                <div class="card-header">
                    <h3 class="card-title">ë©”íŠ¸ë¦­ ë¶„ì„</h3>
                    <div class="card-actions">
                        <button class="card-action" title="ë² ì´ìŠ¤ë¼ì¸ ë¹„êµ í‘œì‹œ" onclick="toggleBaselineComparison(true)">B</button>
                        <button class="card-action" title="í˜„ì¬ í–‰ë™ë§Œ í‘œì‹œ" onclick="toggleBaselineComparison(false)">C</button>
                    </div>
                </div>

                <!-- 3ê°€ì§€ ë¶„ì„ ì°¨íŠ¸ ì˜ì—­ -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem; margin-top: 1rem;">

                    <!-- ì‹œê°„ ê¸°ë°˜ ë¶„ì„ -->
                    <div style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 41, 59, 0.4) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span style="font-size: 1.5rem; margin-right: 0.5rem;">â°</span>
                            <h4 style="color: #f1f5f9; font-size: 1.1rem; margin: 0;">ì‹œê°„ ê¸°ë°˜ ë¶„ì„</h4>
                        </div>
                        <div class="chart-container" id="timeBasedChart" style="height: 250px;">
                            <div class="chart-placeholder">ì‹œê°„ íŒ¨í„´ ì°¨íŠ¸ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
                        </div>
                        <div id="timeBasedMetricsList" style="margin-top: 0.5rem; font-size: 0.85rem; color: #94a3b8;">
                            ë¡œê·¸ì¸ ì‹œê°„, ì„¸ì…˜ ì§€ì†ì‹œê°„, ì—…ë¬´ì‹œê°„ ì™¸ í™œë™ ë“±
                        </div>
                    </div>

                    <!-- ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„ -->
                    <div style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 41, 59, 0.4) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span style="font-size: 1.5rem; margin-right: 0.5rem;">ğŸŒ</span>
                            <h4 style="color: #f1f5f9; font-size: 1.1rem; margin: 0;">ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„</h4>
                        </div>
                        <div class="chart-container" id="networkBasedChart" style="height: 250px;">
                            <div class="chart-placeholder">ë„¤íŠ¸ì›Œí¬ íŒ¨í„´ ì°¨íŠ¸ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
                        </div>
                        <div id="networkBasedMetricsList" style="margin-top: 0.5rem; font-size: 0.85rem; color: #94a3b8;">
                            IP ì£¼ì†Œ, ì§€ë¦¬ì  ìœ„ì¹˜, ë°ì´í„° ì „ì†¡ëŸ‰, VPN ì‚¬ìš© ë“±
                        </div>
                    </div>

                    <!-- ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„ -->
                    <div style="background: linear-gradient(135deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 41, 59, 0.4) 100%); border-radius: 1rem; padding: 1.5rem; border: 1px solid rgba(148, 163, 184, 0.2);">
                        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                            <span style="font-size: 1.5rem; margin-right: 0.5rem;">ğŸ”</span>
                            <h4 style="color: #f1f5f9; font-size: 1.1rem; margin: 0;">ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„</h4>
                        </div>
                        <div class="chart-container" id="accessBasedChart" style="height: 250px;">
                            <div class="chart-placeholder">ì ‘ê·¼ íŒ¨í„´ ì°¨íŠ¸ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
                        </div>
                        <div id="accessBasedMetricsList" style="margin-top: 0.5rem; font-size: 0.85rem; color: #94a3b8;">
                            ë¡œê·¸ì¸ ë¹ˆë„, ë™ì‹œ ì„¸ì…˜, ë””ë°”ì´ìŠ¤ ë³€ê²½, ëŒ€ì—­í­ ì‚¬ìš© ë“±
                        </div>
                    </div>
                </div>

                <!-- ë²”ë¡€ -->
                <div class="baseline-legend" style="display: flex; justify-content: center; margin-top: 1.5rem; gap: 20px; font-size: 0.9rem;">
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 12px; height: 12px; background: #22c55e; border-radius: 50%;"></div>
                        <span>í’ˆì§ˆ ì ìˆ˜ 80% ì´ìƒ</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 12px; height: 12px; background: #eab308; border-radius: 50%;"></div>
                        <span>í’ˆì§ˆ ì ìˆ˜ 60-80%</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 5px;">
                        <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%;"></div>
                        <span>í’ˆì§ˆ ì ìˆ˜ 60% ë¯¸ë§Œ</span>
                    </div>
                </div>
            </div>

            <!-- ì¡°ì¹˜ ê¶Œì¥ì‚¬í•­ -->
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">ì¡°ì¹˜ ê¶Œì¥ì‚¬í•­</h3>
                </div>
                <div class="recommendations">
                    <div class="recommendation-item">
                        <div class="recommendation-icon">ğŸ”’</div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">ê³„ì • ë³´ì•ˆ ê°•í™”</div>
                            <div class="recommendation-text">2ë‹¨ê³„ ì¸ì¦(MFA)ì„ í™œì„±í™”í•˜ê³  ì •ê¸°ì ì¸ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ì„ ìš”ì²­í•˜ì„¸ìš”.</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">ğŸŒ</div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">IP ì œí•œ ì„¤ì •</div>
                            <div class="recommendation-text">í—ˆìš©ëœ IP ì£¼ì†Œ ë˜ëŠ” ì§€ì—­ì—ì„œë§Œ ì ‘ì†ì„ í—ˆìš©í•˜ë„ë¡ ì„¤ì •í•˜ì„¸ìš”.</div>
                        </div>
                    </div>
                    <div class="recommendation-item">
                        <div class="recommendation-icon">â°</div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">ì—…ë¬´ì‹œê°„ ì ‘ì† ì œí•œ</div>
                            <div class="recommendation-text">ì—…ë¬´ì‹œê°„ ì™¸ ì ‘ì† ì‹œ ì¶”ê°€ ì¸ì¦ì„ ìš”êµ¬í•˜ëŠ” ì •ì±…ì„ ì ìš©í•˜ì„¸ìš”.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ì¡°ì¹˜ ê¶Œì¥ì‚¬í•­ ì¹´ë“œ ì•ì— ìƒˆë¡œìš´ ë² ì´ìŠ¤ë¼ì¸ ì •ë³´ ì¹´ë“œ ì¶”ê°€ -->
            <div class="dashboard-card full-width">
                <div class="card-header">
                    <h3 class="card-title">í•™ìŠµëœ ë² ì´ìŠ¤ë¼ì¸ ì •ë³´</h3>
                    <div class="card-actions">
                        <button class="card-action" title="ë² ì´ìŠ¤ë¼ì¸ ìƒì„¸ ì •ë³´" onclick="showBaselineDetails()">â„¹ï¸</button>
                    </div>
                </div>

                <div style="padding: 0 0 1rem 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem; background: rgba(15, 23, 42, 0.3); padding: 1rem; border-radius: 0.5rem;">
                        <div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.25rem;">í•™ìŠµ ê¸°ê°„</div>
                            <div style="font-size: 1.1rem; color: #f1f5f9;"><span id="learningDays">30</span>ì¼</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.25rem;">ì²˜ë¦¬ëœ ë°ì´í„°</div>
                            <div style="font-size: 1.1rem; color: #f1f5f9;"><span id="processedEvents">14,589</span>ê°œ ì´ë²¤íŠ¸</div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.25rem;">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</div>
                            <div style="font-size: 1.1rem; color: #f1f5f9;"><span id="lastUpdated">2025-06-01 06:00</span></div>
                        </div>
                        <div>
                            <div style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.25rem;">ë² ì´ìŠ¤ë¼ì¸ í’ˆì§ˆ</div>
                            <div style="font-size: 1.1rem; color: #4ade80;">ì–‘í˜¸</div>
                        </div>
                    </div>



                    <h4 style="margin: 1.5rem 0 1rem 0; font-size: 1.1rem; color: #f1f5f9;">ì‹œê°„ëŒ€ë³„ í™œë™ íŒ¨í„´</h4>
                    <div class="heatmap-container">
                        <div class="chart-placeholder">ì‹œê°„ëŒ€ë³„ í™œë™ íˆíŠ¸ë§µì„ ë¡œë“œí•˜ëŠ” ì¤‘...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" onclick="goBackToList()">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            <button class="btn btn-primary" onclick="exportReport()">ë¶„ì„ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
            <button class="btn btn-info" onclick="showDeviationScoreCalculator()">í¸ì°¨ ì ìˆ˜ ê³„ì‚°</button>
        </div>
    </div>

    <script>
        let profileData = null;

        // URLì—ì„œ í”„ë¡œíŒŒì¼ ID ì¶”ì¶œ í•¨ìˆ˜
        function getProfileIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', () => {
            // URLì—ì„œ í”„ë¡œí•„ ID ê°€ì ¸ì˜¤ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('id');

            if (profileId) {
                loadProfileResults(profileId);

                // ë„¤ë¹„ê²Œì´ì…˜ íƒ­ì˜ href ì†ì„± ì—…ë°ì´íŠ¸
                const navLinks = document.querySelectorAll('.profile-nav a');
                navLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    link.setAttribute('href', `${href}?id=${profileId}`);
                });
            } else {
                alert('í”„ë¡œí•„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                goBackToList();
            }

            // ì°¨íŠ¸ ì´ˆê¸°í™” (ì‹¤ì œë¡œëŠ” Chart.js ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•  ê²ƒ)
            simulateChartLoading();
        });

        // í”„ë¡œí•„ ê²°ê³¼ ë¡œë“œ
        async function loadProfileResults(profileId) {
            try {
                console.log('í”„ë¡œíŒŒì¼ ê²°ê³¼ ë¡œë”© ì‹œì‘:', profileId);

                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                showLoadingState();

                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ í”„ë¡œíŒŒì¼ ì •ë³´ ì¡°íšŒ
                const profileResponse = await fetch(`/api/profiles/${profileId}`);
                if (!profileResponse.ok) {
                    throw new Error(`í”„ë¡œíŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨: ${profileResponse.status}`);
                }

                profileData = await profileResponse.json();
                console.log('í”„ë¡œíŒŒì¼ ë°ì´í„°:', profileData);

                // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ
                let baselineStatus = null;
                try {
                    const statusResponse = await fetch(`/api/profiles/${profileId}/baseline/status`);
                    if (statusResponse.ok) {
                        baselineStatus = await statusResponse.json();
                        console.log('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ:', baselineStatus);
                    }
                } catch (error) {
                    console.warn('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:', error.message);
                }

                // ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ ì¡°íšŒ
                let baselineResults = null;
                try {
                    const resultsResponse = await fetch(`/api/profiles/${profileId}/baseline/results`);
                    if (resultsResponse.ok) {
                        baselineResults = await resultsResponse.json();
                        console.log('ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼:', baselineResults);

                        // ì „ì—­ ë³€ìˆ˜ì— ë² ì´ìŠ¤ë¼ì¸ ê²°ê³¼ ì €ì¥
                        window.currentBaselineResults = baselineResults;
                    }
                } catch (error) {
                    console.warn('ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ ì¡°íšŒ ì‹¤íŒ¨:', error.message);
                }

                // í”„ë¡œíŒŒì¼ ì •ë³´ í‘œì‹œ
                displayProfileInfo(profileData, baselineStatus, baselineResults);

                // ë² ì´ìŠ¤ë¼ì¸ ì •ë³´ ì—…ë°ì´íŠ¸
                updateBaselineInfo(baselineStatus);

                // ì‹¤ì œ ë¶„ì„ ê²°ê³¼ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                await updateAnalysisCharts(baselineResults);

                // ë¡œë”© ìƒíƒœ í•´ì œ
                hideLoadingState();

                console.log('í”„ë¡œíŒŒì¼ ê²°ê³¼ ë¡œë”© ì™„ë£Œ');

            } catch (error) {
                console.error('í”„ë¡œíŒŒì¼ ê²°ê³¼ ë¡œë”© ì‹¤íŒ¨:', error);
                showErrorState(error.message);
            }
        }

        // ë¡œë”© ìƒíƒœ í‘œì‹œ
        function showLoadingState() {
            const container = document.querySelector('.dashboard-container');
            const loadingHtml = `
                <div id="loadingOverlay" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(15, 20, 25, 0.8);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                ">
                    <div style="text-align: center; color: #e2e8f0;">
                        <div style="width: 50px; height: 50px; border: 3px solid #334155; border-top: 3px solid #6366f1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                        <p>í”„ë¡œíŒŒì¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            `;
            document.body.insertAdjacentHTML('beforeend', loadingHtml);
        }

        // ë¡œë”© ìƒíƒœ í•´ì œ
        function hideLoadingState() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            if (loadingOverlay) {
                loadingOverlay.remove();
            }
        }

        // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
        function showErrorState(errorMessage) {
            hideLoadingState();
            const container = document.querySelector('.dashboard-container');
            container.innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    min-height: 60vh;
                    text-align: center;
                    color: #e2e8f0;
                ">
                    <div style="font-size: 4rem; margin-bottom: 1rem;">âš ï¸</div>
                    <h2 style="margin-bottom: 1rem; color: #ef4444;">í”„ë¡œíŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
                    <p style="margin-bottom: 2rem; color: #94a3b8;">${errorMessage}</p>
                    <div style="display: flex; gap: 1rem;">
                        <button class="btn btn-primary" onclick="location.reload()">ë‹¤ì‹œ ì‹œë„</button>
                        <button class="btn btn-secondary" onclick="goBackToList()">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                    </div>
                </div>
            `;
        }

        // í”„ë¡œí•„ ê¸°ë³¸ ì •ë³´ í‘œì‹œ
        function displayProfileInfo(profile, baselineStatus, baselineResults) {
            document.getElementById('profileName').textContent = profile.name;

            // í”„ë¡œíŒŒì¼ ìœ í˜• (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API êµ¬ì¡° ê¸°ì¤€)
            let profileTypeText;
            switch (profile.profile_type) {
                case 'user': profileTypeText = 'ì‚¬ìš©ì'; break;
                case 'hybrid': profileTypeText = 'í•˜ì´ë¸Œë¦¬ë“œ'; break;
                case 'group': profileTypeText = 'ê·¸ë£¹'; break;
                default: profileTypeText = 'ì‚¬ìš©ì ì •ì˜';
            }
            document.getElementById('profileType').textContent = profileTypeText + ' í”„ë¡œíŒŒì¼';

            // ë¡œê·¸ ì†ŒìŠ¤ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API êµ¬ì¡° ê¸°ì¤€)
            const logSourceMap = {
                'vpn': 'VPN',
                'proxy': 'í”„ë¡ì‹œ',
                'database': 'ë°ì´í„°ë² ì´ìŠ¤',
                'application': 'ì• í”Œë¦¬ì¼€ì´ì…˜',
                'system': 'ì‹œìŠ¤í…œ'
            };
            document.getElementById('logSource').textContent = logSourceMap[profile.log_source] || profile.log_source;

            // ë¶„ì„ ê¸°ê°„ (í•™ìŠµ ê¸°ê°„ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°)
            const today = new Date();
            const startDate = new Date();
            startDate.setDate(today.getDate() - (profile.learning_period || 30));

            const formatDate = (date) => {
                return date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                }).replace(/\. /g, '-').replace('.', '');
            };

            document.getElementById('analysisPeriod').textContent =
                `${formatDate(startDate)} ~ ${formatDate(today)}`;

            // ìƒì„±ì¼ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API êµ¬ì¡° ê¸°ì¤€)
            if (profile.created_at) {
                const createdDate = new Date(profile.created_at);
                document.getElementById('creationDate').textContent = formatDate(createdDate);
            } else {
                document.getElementById('creationDate').textContent = '-';
            }

            // ì‹¤ì œ ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ ê¸°ë°˜ ìœ„í—˜ ì ìˆ˜ ê³„ì‚°
            let riskScore = calculateRiskScore(baselineStatus, baselineResults);

            // ì ìˆ˜ê°€ 0ì¸ ê²½ìš° (API ë¯¸êµ¬í˜„ ë“±) í‘œì‹œí•˜ì§€ ì•ŠìŒ
            if (riskScore === 0) {
                document.getElementById('riskScore').textContent = '-';
                document.getElementById('riskLevel').textContent = 'ë°ì´í„° ì—†ìŒ';
                document.getElementById('riskLevel').style.color = '#94a3b8';
                document.querySelector('.score-circle').style.background = 'conic-gradient(#475569 0%, #475569 100%)';
            } else {
                document.getElementById('riskScore').textContent = riskScore;

                // ìœ„í—˜ ìˆ˜ì¤€ ì„¤ì •
                let riskLevel;
                let scoreGradient;
                if (riskScore >= 75) {
                    riskLevel = 'ë†’ì€ ìœ„í—˜';
                    scoreGradient = `conic-gradient(#ef4444 0%, #ef4444 ${riskScore}%, #1f2937 ${riskScore}%, #1f2937 100%)`;
                    document.getElementById('riskLevel').style.color = '#ef4444';
                } else if (riskScore >= 50) {
                    riskLevel = 'ì¤‘ê°„ ìœ„í—˜';
                    scoreGradient = `conic-gradient(#f59e0b 0%, #f59e0b ${riskScore}%, #1f2937 ${riskScore}%, #1f2937 100%)`;
                    document.getElementById('riskLevel').style.color = '#f59e0b';
                } else {
                    riskLevel = 'ë‚®ì€ ìœ„í—˜';
                    scoreGradient = `conic-gradient(#10b981 0%, #10b981 ${riskScore}%, #1f2937 ${riskScore}%, #1f2937 100%)`;
                    document.getElementById('riskLevel').style.color = '#10b981';
                }

                document.getElementById('riskLevel').textContent = riskLevel;
                document.querySelector('.score-circle').style.background = scoreGradient;
            }
        }



        // ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        function goBackToList() {
            window.location.href = 'uba_integrated_management.html';
        }

        // ë² ì´ìŠ¤ë¼ì¸ ê´€ë¦¬ í˜ì´ì§€ë¡œ ì´ë™
        function goToBaselineManagement() {
            const urlParams = new URLSearchParams(window.location.search);
            const profileId = urlParams.get('id');

            if (profileId) {
                window.location.href = `uba_baseline_management.html?id=${profileId}`;
            } else {
                alert('í”„ë¡œíŒŒì¼ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // ë³´ê³ ì„œ ë‚´ë³´ë‚´ê¸°
        function exportReport() {
            alert('ë¶„ì„ ê²°ê³¼ê°€ PDF í˜•ì‹ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤. (êµ¬í˜„ ì˜ˆì •)');
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” PDFë‚˜ Excelë¡œ ë‚´ë³´ë‚´ê¸°
        }

        // í¸ì°¨ ì ìˆ˜ ê³„ì‚°ê¸° í‘œì‹œ
        function showDeviationScoreCalculator() {
            const modal = document.createElement('div');
            modal.id = 'deviationModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;

            modal.innerHTML = `
                <div style="
                    background: #1e293b;
                    border-radius: 0.75rem;
                    padding: 2rem;
                    max-width: 500px;
                    width: 90%;
                    max-height: 80vh;
                    overflow-y: auto;
                    border: 1px solid #334155;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="color: #e2e8f0; margin: 0;">í¸ì°¨ ì ìˆ˜ ê³„ì‚°</h3>
                        <button onclick="closeDeviationModal()" style="
                            background: none;
                            border: none;
                            color: #94a3b8;
                            font-size: 1.5rem;
                            cursor: pointer;
                            padding: 0;
                            width: 30px;
                            height: 30px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                        ">Ã—</button>
                    </div>

                    <form onsubmit="calculateDeviation(event)">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; color: #e2e8f0; margin-bottom: 0.5rem; font-weight: 600;">
                                ëŒ€ìƒ ì—”í„°í‹° (ì‚¬ìš©ì ID) *
                            </label>
                            <input
                                type="text"
                                id="targetEntity"
                                placeholder="ì˜ˆ: user001, john.doe@company.com"
                                required
                                style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: #334155;
                                    border: 1px solid #475569;
                                    border-radius: 0.5rem;
                                    color: #e2e8f0;
                                    font-size: 0.9rem;
                                "
                            />
                            <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 0.25rem;">
                                ë¶„ì„í•  ì‚¬ìš©ìì˜ ì‹ë³„ìë¥¼ ì…ë ¥í•˜ì„¸ìš”
                            </div>
                        </div>

                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; color: #e2e8f0; margin-bottom: 0.5rem; font-weight: 600;">
                                ê³„ì‚° ê¸°ì¤€ì¼
                            </label>
                            <input
                                type="date"
                                id="calculationDate"
                                value="${new Date().toISOString().split('T')[0]}"
                                style="
                                    width: 100%;
                                    padding: 0.75rem;
                                    background: #334155;
                                    border: 1px solid #475569;
                                    border-radius: 0.5rem;
                                    color: #e2e8f0;
                                    font-size: 0.9rem;
                                "
                            />
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; color: #e2e8f0; margin-bottom: 0.5rem; font-weight: 600;">
                                ë¶„ì„í•  ë©”íŠ¸ë¦­ (ì„ íƒì‚¬í•­)
                            </label>
                            <div id="metricCheckboxes" style="
                                max-height: 150px;
                                overflow-y: auto;
                                padding: 0.5rem;
                                background: #334155;
                                border: 1px solid #475569;
                                border-radius: 0.5rem;
                            ">
                                <!-- ë©”íŠ¸ë¦­ ì²´í¬ë°•ìŠ¤ë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
                            </div>
                            <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 0.25rem;">
                                ì„ íƒí•˜ì§€ ì•Šìœ¼ë©´ ëª¨ë“  ë©”íŠ¸ë¦­ì„ ë¶„ì„í•©ë‹ˆë‹¤
                            </div>
                        </div>

                        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                            <button type="button" onclick="closeDeviationModal()" style="
                                padding: 0.75rem 1.5rem;
                                background: #475569;
                                color: #e2e8f0;
                                border: none;
                                border-radius: 0.5rem;
                                cursor: pointer;
                                font-size: 0.9rem;
                            ">ì·¨ì†Œ</button>
                            <button type="submit" style="
                                padding: 0.75rem 1.5rem;
                                background: #6366f1;
                                color: white;
                                border: none;
                                border-radius: 0.5rem;
                                cursor: pointer;
                                font-size: 0.9rem;
                            ">ê³„ì‚°í•˜ê¸°</button>
                        </div>
                    </form>

                    <div id="deviationResults" style="margin-top: 1.5rem; display: none;">
                        <!-- ê³„ì‚° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // ë©”íŠ¸ë¦­ ì²´í¬ë°•ìŠ¤ ìƒì„±
            generateMetricCheckboxes();
        }

        // ë©”íŠ¸ë¦­ ì²´í¬ë°•ìŠ¤ ìƒì„±
        function generateMetricCheckboxes() {
            const container = document.getElementById('metricCheckboxes');
            if (!container || !profileData || !profileData.selected_metrics) return;

            const metricNameMap = {
                'login_time_pattern': 'ë¡œê·¸ì¸ ì‹œê°„ íŒ¨í„´',
                'session_duration': 'ì„¸ì…˜ ì§€ì† ì‹œê°„',
                'after_hours_activity': 'ì—…ë¬´ì‹œê°„ ì™¸ í™œë™',
                'weekend_holiday_access': 'ì£¼ë§/íœ´ì¼ ì ‘ê·¼',
                'login_frequency_change': 'ë¡œê·¸ì¸ ë¹ˆë„ ë³€í™”',
                'concurrent_session_detection': 'ë™ì‹œ ì„¸ì…˜ íƒì§€',
                'timezone_anomaly_access': 'ì‹œê°„ëŒ€ ì´ìƒ ì ‘ê·¼',
                'ip_address_pattern': 'IP ì£¼ì†Œ íŒ¨í„´',
                'geo_location_analysis': 'ì§€ë¦¬ì  ìœ„ì¹˜ ë¶„ì„',
                'data_volume_transfer': 'ë°ì´í„° ì „ì†¡ëŸ‰',
                'impossible_travel_detection': 'ë¶ˆê°€ëŠ¥í•œ ì´ë™ íƒì§€',
                'vpn_usage_pattern': 'VPN ì‚¬ìš© íŒ¨í„´',
                'network_device_change': 'ë„¤íŠ¸ì›Œí¬ ë””ë°”ì´ìŠ¤ ë³€ê²½',
                'bandwidth_usage_anomaly': 'ëŒ€ì—­í­ ì‚¬ìš©ëŸ‰ ì´ìƒ',
                'connection_pattern_analysis': 'ì—°ê²° íŒ¨í„´ ë¶„ì„',
                'proxy_bypass_attempt': 'í”„ë¡ì‹œ ìš°íšŒ ì‹œë„',
                'resource_access_pattern': 'ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ íŒ¨í„´',
                'file_download_pattern': 'íŒŒì¼ ë‹¤ìš´ë¡œë“œ íŒ¨í„´',
                'application_usage_pattern': 'ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚¬ìš© íŒ¨í„´',
                'shared_folder_access': 'ê³µìœ  í´ë” ì ‘ê·¼'
            };

            container.innerHTML = profileData.selected_metrics.map(metric => {
                const displayName = metricNameMap[metric] || metric;
                return `
                    <div style="margin-bottom: 0.5rem;">
                        <label style="display: flex; align-items: center; cursor: pointer; color: #e2e8f0;">
                            <input
                                type="checkbox"
                                name="selectedMetrics"
                                value="${metric}"
                                style="margin-right: 0.5rem;"
                            />
                            ${displayName}
                        </label>
                    </div>
                `;
            }).join('');
        }

        // í¸ì°¨ ì ìˆ˜ ê³„ì‚° ì‹¤í–‰
        async function calculateDeviation(event) {
            event.preventDefault();

            const targetEntity = document.getElementById('targetEntity').value.trim();
            const calculationDate = document.getElementById('calculationDate').value;
            const resultsContainer = document.getElementById('deviationResults');

            if (!targetEntity) {
                alert('ëŒ€ìƒ ì—”í„°í‹°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì„ íƒëœ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
            const selectedMetrics = Array.from(document.querySelectorAll('input[name="selectedMetrics"]:checked'))
                .map(cb => cb.value);

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            resultsContainer.style.display = 'block';
            resultsContainer.innerHTML = `
                <div style="text-align: center; padding: 2rem; color: #e2e8f0;">
                    <div style="width: 40px; height: 40px; border: 3px solid #334155; border-top: 3px solid #6366f1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1rem;"></div>
                    <p>í¸ì°¨ ì ìˆ˜ë¥¼ ê³„ì‚°í•˜ëŠ” ì¤‘...</p>
                </div>
            `;

            try {
                const urlParams = new URLSearchParams(window.location.search);
                const profileId = urlParams.get('id');

                const requestData = {
                    target_entity: targetEntity,
                    calculation_date: calculationDate,
                    metric_names: selectedMetrics.length > 0 ? selectedMetrics : null
                };

                const response = await fetch(`/api/profiles/${profileId}/baseline/deviation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'í¸ì°¨ ì ìˆ˜ ê³„ì‚° ì‹¤íŒ¨');
                }

                const result = await response.json();
                displayDeviationResults(result);

            } catch (error) {
                console.error('í¸ì°¨ ì ìˆ˜ ê³„ì‚° ì˜¤ë¥˜:', error);
                resultsContainer.innerHTML = `
                    <div style="
                        background: rgba(239, 68, 68, 0.1);
                        border: 1px solid rgba(239, 68, 68, 0.3);
                        border-radius: 0.5rem;
                        padding: 1rem;
                        color: #ef4444;
                        text-align: center;
                    ">
                        <h4 style="margin: 0 0 0.5rem 0;">ê³„ì‚° ì‹¤íŒ¨</h4>
                        <p style="margin: 0; font-size: 0.9rem;">${error.message}</p>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: #fca5a5;">
                            ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì´ ì‹¤í–‰ ì¤‘ì¸ì§€, ëŒ€ìƒ ì—”í„°í‹°ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.
                        </p>
                    </div>
                `;
            }
        }

        // í¸ì°¨ ì ìˆ˜ ê²°ê³¼ í‘œì‹œ
        function displayDeviationResults(result) {
            const resultsContainer = document.getElementById('deviationResults');
            const deviationScores = result.deviation_scores;

            if (!deviationScores || (Array.isArray(deviationScores) && deviationScores.length === 0)) {
                resultsContainer.innerHTML = `
                    <div style="
                        background: rgba(245, 158, 11, 0.1);
                        border: 1px solid rgba(245, 158, 11, 0.3);
                        border-radius: 0.5rem;
                        padding: 1rem;
                        color: #f59e0b;
                        text-align: center;
                    ">
                        <h4 style="margin: 0 0 0.5rem 0;">ë°ì´í„° ì—†ìŒ</h4>
                        <p style="margin: 0; font-size: 0.9rem;">
                            í•´ë‹¹ ì—”í„°í‹°ì— ëŒ€í•œ í¸ì°¨ ì ìˆ˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                        </p>
                    </div>
                `;
                return;
            }

            const scores = Array.isArray(deviationScores) ? deviationScores : [deviationScores];
            const avgScore = scores.reduce((sum, score) => sum + (score.deviation_score || 0), 0) / scores.length;

            resultsContainer.innerHTML = `
                <div style="
                    background: rgba(16, 185, 129, 0.1);
                    border: 1px solid rgba(16, 185, 129, 0.3);
                    border-radius: 0.5rem;
                    padding: 1rem;
                ">
                    <h4 style="color: #10b981; margin: 0 0 1rem 0;">ğŸ“Š í¸ì°¨ ì ìˆ˜ ê³„ì‚° ê²°ê³¼</h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.8rem;">ëŒ€ìƒ ì—”í„°í‹°</div>
                            <div style="color: #e2e8f0; font-weight: 600;">${result.target_entity}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="color: #94a3b8; font-size: 0.8rem;">í‰ê·  í¸ì°¨ ì ìˆ˜</div>
                            <div style="color: ${avgScore > 0.7 ? '#ef4444' : avgScore > 0.5 ? '#f59e0b' : '#10b981'}; font-weight: 600; font-size: 1.2rem;">
                                ${(avgScore * 100).toFixed(1)}%
                            </div>
                        </div>
                    </div>

                    <div style="color: #94a3b8; font-size: 0.8rem; margin-bottom: 0.5rem;">ë©”íŠ¸ë¦­ë³„ í¸ì°¨ ì ìˆ˜:</div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${scores.map(score => {
                            const percentage = (score.deviation_score * 100).toFixed(1);
                            const color = score.deviation_score > 0.7 ? '#ef4444' :
                                         score.deviation_score > 0.5 ? '#f59e0b' : '#10b981';
                            return `
                                <div style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 0.5rem;
                                    background: rgba(30, 41, 59, 0.5);
                                    margin-bottom: 0.25rem;
                                    border-radius: 0.25rem;
                                ">
                                    <span style="color: #e2e8f0; font-size: 0.9rem;">
                                        ${score.metric_name || 'ì•Œ ìˆ˜ ì—†ìŒ'}
                                    </span>
                                    <span style="color: ${color}; font-weight: 600;">
                                        ${percentage}%
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(51, 65, 85, 0.5);">
                        <div style="color: #94a3b8; font-size: 0.8rem;">
                            ğŸ“ˆ <strong>í•´ì„:</strong><br/>
                            â€¢ 0-30%: ì •ìƒ ë²”ìœ„<br/>
                            â€¢ 30-70%: ì£¼ì˜ í•„ìš”<br/>
                            â€¢ 70% ì´ìƒ: ì´ìƒ í–‰ë™ ê°€ëŠ¥ì„±
                        </div>
                    </div>
                </div>
            `;
        }

        // í¸ì°¨ ì ìˆ˜ ê³„ì‚°ê¸° ëª¨ë‹¬ ë‹«ê¸°
        function closeDeviationModal() {
            const modal = document.getElementById('deviationModal');
            if (modal) {
                modal.remove();
            }
        }

        // ì°¨íŠ¸ ë¡œë”© ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Chart.js ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©)
        function simulateChartLoading() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì´ ë¶€ë¶„ì— ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.
            const placeholders = document.querySelectorAll('.chart-placeholder');

            placeholders.forEach((placeholder, index) => {
                setTimeout(() => {
                    placeholder.innerHTML = 'ì°¨íŠ¸ ë°ì´í„° í‘œì‹œë¨';
                    placeholder.style.background = 'rgba(51, 65, 85, 0.3)';
                }, 1000 + index * 500);
            });
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒì„¸ ì •ë³´ ë³´ê¸°
        function showBaselineDetails() {
            alert('ë² ì´ìŠ¤ë¼ì¸ í•™ìŠµ ì„¸ë¶€ ì •ë³´\n\n' +
                  '- ë°ì´í„° ì†ŒìŠ¤: ' + profileData.logSourceName + '\n' +
                  '- í•™ìŠµ ì‹œì‘ì¼: 2025-05-01\n' +
                  '- í•™ìŠµ ì¢…ë£Œì¼: 2025-06-01\n' +
                  '- ì´ìƒ í–‰ë™ ì„ê³„ê°’: ' + profileData.anomalyThreshold + '\n' +
                  '- ì²˜ë¦¬ëœ ì´ ì´ë²¤íŠ¸ ìˆ˜: 14,589ê°œ\n' +
                  '- í‰ê·  ì¼ì¼ ì´ë²¤íŠ¸: 486ê°œ\n' +
                  '- ì •ìƒ í–‰ë™ íŒë‹¨ ì‹ ë¢°ë„: 85%');
        }

        // ë² ì´ìŠ¤ë¼ì¸ ë¹„êµ í† ê¸€
        function toggleBaselineComparison(showBaseline) {
            const behaviorChart = document.getElementById('behaviorPatternChart');
            const placeholder = behaviorChart.querySelector('.chart-placeholder');

            if (showBaseline) {
                placeholder.textContent = 'ë² ì´ìŠ¤ë¼ì¸ê³¼ í˜„ì¬ í–‰ë™ì„ ë¹„êµí•˜ëŠ” ë ˆì´ë” ì°¨íŠ¸';
                placeholder.style.background = 'rgba(51, 65, 85, 0.3)';
            } else {
                placeholder.textContent = 'í˜„ì¬ í–‰ë™ íŒ¨í„´ë§Œ í‘œì‹œí•˜ëŠ” ë ˆì´ë” ì°¨íŠ¸';
                placeholder.style.background = 'rgba(30, 41, 59, 0.5)';
            }
        }

        // ë² ì´ìŠ¤ë¼ì¸ ì •ë³´ ë°ì´í„° ì±„ìš°ê¸°
        function updateBaselineInfo(baselineStatus) {
            if (profileData) {
                document.getElementById('learningDays').textContent = profileData.learning_period || '30';

                // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„
                let lastUpdatedText = 'ì—†ìŒ';
                if (baselineStatus && baselineStatus.latest_job) {
                    const lastUpdated = new Date(baselineStatus.latest_job.completed_at || baselineStatus.latest_job.created_at);
                    lastUpdatedText = lastUpdated.toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    }).replace(/\. /g, '-').replace('\.', '');
                } else {
                    lastUpdatedText = new Date().toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    }).replace(/\. /g, '-').replace('\.', '');
                }

                document.getElementById('lastUpdated').textContent = lastUpdatedText;

                // ë² ì´ìŠ¤ë¼ì¸ ë©”íŠ¸ë¦­ í™”ë©´ ì œê±°ë¨
            }
        }

        // generateBaselineMetrics í•¨ìˆ˜ ë° ê´€ë ¨ í•¨ìˆ˜ë“¤ ì œê±°ë¨

        // ì‹¤ì œ ë² ì´ìŠ¤ë¼ì¸ ê²°ê³¼ ê¸°ë°˜ ìœ„í—˜ ì ìˆ˜ ê³„ì‚°
        function calculateRiskScore(baselineStatus, baselineResults) {
            // ë² ì´ìŠ¤ë¼ì¸ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° - ìƒí™©ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ì²˜ë¦¬
            if (!baselineResults || !baselineResults.summary) {
                if (baselineResults && baselineResults.source === 'api_not_implemented') {
                    return 0; // API ë¯¸êµ¬í˜„ì‹œ ì ìˆ˜ í‘œì‹œ ì•ˆí•¨
                } else if (baselineResults && baselineResults.source === 'baseline_engine_error') {
                    return 0; // ì—”ì§„ ì˜¤ë¥˜ì‹œ ì ìˆ˜ í‘œì‹œ ì•ˆí•¨
                } else {
                    return 75; // ë°ì´í„° ì—†ìŒ - ë†’ì€ ìœ„í—˜
                }
            }

            let riskScore = 50; // ê¸°ë³¸ê°’
            const summary = baselineResults.summary;

            // ë² ì´ìŠ¤ë¼ì¸ ìˆ˜ì™€ ì´ìƒì¹˜ ìˆ˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì ìˆ˜ ê³„ì‚°
            if (summary.total_baselines > 0) {
                // ê¸°ë³¸ì ìœ¼ë¡œ ë‚®ì€ ìœ„í—˜ (ë² ì´ìŠ¤ë¼ì¸ ì¡´ì¬)
                riskScore = 30;

                // ì´ìƒì¹˜ê°€ ë§ì€ ê²½ìš° ìœ„í—˜ ì ìˆ˜ ì¦ê°€
                if (summary.anomaly_count > 0) {
                    const anomalyRatio = summary.anomaly_count / summary.total_baselines;
                    if (anomalyRatio > 0.7) {
                        riskScore = 80; // ë§¤ìš° ë†’ì€ ì´ìƒì¹˜ ë¹„ìœ¨
                    } else if (anomalyRatio > 0.5) {
                        riskScore = 65; // ë†’ì€ ì´ìƒì¹˜ ë¹„ìœ¨
                    } else if (anomalyRatio > 0.3) {
                        riskScore = 50; // ì¤‘ê°„ ì´ìƒì¹˜ ë¹„ìœ¨
                    } else {
                        riskScore = 35; // ë‚®ì€ ì´ìƒì¹˜ ë¹„ìœ¨
                    }
                }
            }

            // ìµœì‹  ì‘ì—… ìƒíƒœ ë°˜ì˜
            if (baselineStatus && baselineStatus.latest_job) {
                if (baselineStatus.latest_job.status === 'success') {
                    riskScore = Math.max(15, riskScore - 10); // ì„±ê³µ ì‹œ ìœ„í—˜ ê°ì†Œ
                } else if (baselineStatus.latest_job.status === 'failed') {
                    riskScore = Math.min(90, riskScore + 20); // ì‹¤íŒ¨ ì‹œ ìœ„í—˜ ì¦ê°€
                } else if (baselineStatus.latest_job.status === 'running') {
                    riskScore = Math.max(25, riskScore - 5); // ì§„í–‰ ì¤‘ì¼ ë•Œ ì•½ê°„ ê°ì†Œ
                }
            }

            return Math.round(riskScore);
        }

        // ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„°ë§Œ ë¡œë“œ
        async function loadHourlyPatternsData(profileId) {
            try {
                console.log('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë”© ì‹œì‘:', profileId);

                // ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë“œ
                const patternsResponse = await fetch(`/api/profiles/${profileId}/hourly-patterns`);
                if (patternsResponse.ok) {
                    const patternsData = await patternsResponse.json();
                    console.log('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„°:', patternsData);
                    updateHourlyPatternsChart(patternsData);
                } else {
                    console.warn('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', patternsResponse.status);
                }

            } catch (error) {
                console.error('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
            }
        }

        // ì‹¤ì œ ë¶„ì„ ê²°ê³¼ë¡œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        async function updateAnalysisCharts(baselineResults) {
            console.log('ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹œì‘:', baselineResults);

            // ë² ì´ìŠ¤ë¼ì¸ ê²°ê³¼ë¥¼ ì „ì—­ ë³€ìˆ˜ì— ì €ì¥í•˜ì—¬ ë‹¤ë¥¸ í•¨ìˆ˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•¨
            window.currentBaselineResults = baselineResults;

            // ë² ì´ìŠ¤ë¼ì¸ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
            if (!baselineResults || !baselineResults.baselines || baselineResults.baselines.length === 0) {
                // API êµ¬í˜„ ìƒíƒœì— ë”°ë¥¸ ë©”ì‹œì§€ í‘œì‹œ
                let message = 'ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤';
                let detail = 'ë² ì´ìŠ¤ë¼ì¸ ìƒì„± í›„ ë¶„ì„ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤';

                if (baselineResults && baselineResults.source === 'api_not_implemented') {
                    message = 'ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ APIê°€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤';
                    detail = 'ë‹¤ìŒ API êµ¬í˜„ í›„ ì‹¤ì œ ë¶„ì„ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤';
                } else if (baselineResults && baselineResults.source === 'baseline_engine_error') {
                    message = 'ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                    detail = 'ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”';
                }

                updatePlaceholderCharts(message, detail, baselineResults);
                return;
            }



            // 1. ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë“œ ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            const profileId = getProfileIdFromUrl();
            await loadHourlyPatternsData(profileId);

            // 2. 3ê°€ì§€ ë¶„ì„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateTimeBasedChart(baselineResults);
            updateNetworkBasedChart(baselineResults);
            updateAccessBasedChart(baselineResults);

            // 3. ì´ìƒ íƒì§€ ê²°ê³¼ ì—…ë°ì´íŠ¸
            updateAnomalyDetectionResults(baselineResults);

            // 4. ì‹œê°„ë³„ í™œë™ íŒ¨í„´ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ í•¨ìˆ˜ ìœ ì§€)
            updateActivityTimelineChart(baselineResults);

            // 5. ê¶Œì¥ì‚¬í•­ ì—…ë°ì´íŠ¸
            updateRecommendations(baselineResults);

            // ë² ì´ìŠ¤ë¼ì¸ ë©”íŠ¸ë¦­ í™”ë©´ ì œê±°ë¨
        }

        // í”Œë ˆì´ìŠ¤í™€ë” ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updatePlaceholderCharts(message, detail, baselineResults) {
            const placeholders = document.querySelectorAll('.chart-placeholder');
            placeholders.forEach(placeholder => {
                let icon = 'ğŸ“Š';
                let additionalInfo = '';

                if (baselineResults && baselineResults.source === 'api_not_implemented') {
                    icon = 'âš™ï¸';
                    additionalInfo = `
                        <div style="margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.1); border-radius: 0.5rem; border-left: 3px solid #f59e0b;">
                            <div style="color: #f59e0b; font-weight: 600; margin-bottom: 0.5rem;">í•„ìš”í•œ API:</div>
                            <div style="font-size: 0.8rem; color: #94a3b8;">
                                ${baselineResults.required_apis ? baselineResults.required_apis.map(api => `â€¢ ${api}`).join('<br>') : ''}
                            </div>
                        </div>
                    `;
                } else if (baselineResults && baselineResults.source === 'baseline_engine_error') {
                    icon = 'âš ï¸';
                    additionalInfo = `
                        <div style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 0.5rem; border-left: 3px solid #ef4444;">
                            <div style="color: #ef4444; font-weight: 600; margin-bottom: 0.5rem;">ì˜¤ë¥˜ ë°œìƒ</div>
                            <div style="font-size: 0.8rem; color: #94a3b8;">
                                ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”
                            </div>
                        </div>
                    `;
                }

                placeholder.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #94a3b8; padding: 1rem;">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">${icon}</div>
                        <div style="font-weight: 600; margin-bottom: 0.5rem;">${message}</div>
                        <div style="font-size: 0.8rem; text-align: center;">${detail}</div>
                        ${additionalInfo}
                    </div>
                `;
                placeholder.style.background = 'rgba(51, 65, 85, 0.3)';
                placeholder.style.minHeight = '200px';
                placeholder.style.display = 'flex';
                placeholder.style.alignItems = 'center';
                placeholder.style.justifyContent = 'center';
            });
        }

        // ì‹œê°„ ê¸°ë°˜ ë¶„ì„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateTimeBasedChart(baselineResults) {
            const chartContainer = document.getElementById('timeBasedChart');
            if (!chartContainer || !baselineResults) return;

            // Chart container ì´ˆê¸°í™”
            chartContainer.innerHTML = '';
            chartContainer.style.position = 'relative';

            // Canvas ìƒì„±
            const canvas = document.createElement('canvas');
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            chartContainer.appendChild(canvas);

            const baselines = baselineResults.baselines || [];

            // ì‹œê°„ ê¸°ë°˜ ë©”íŠ¸ë¦­ë“¤
            const timeMetrics = [
                'login_time_pattern',
                'session_duration',
                'after_hours_activity',
                'weekend_holiday_access',
                'login_frequency_change'
            ];

            // ë² ì´ìŠ¤ë¼ì¸ì—ì„œ ì‹œê°„ ê´€ë ¨ ë©”íŠ¸ë¦­ ì¶”ì¶œ
            const availableMetrics = baselines
                .filter(baseline => timeMetrics.includes(baseline.metric_name))
                .slice(0, 5);

            // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
            console.log('ì‹œê°„ ê¸°ë°˜ ë¶„ì„ - ì‚¬ìš© ê°€ëŠ¥í•œ ë©”íŠ¸ë¦­:', availableMetrics.map(m => m.metric_name));

            // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
            const timeBasedTitle = document.querySelector('#timeBasedChart').closest('div').querySelector('h4');
            if (timeBasedTitle) {
                timeBasedTitle.innerHTML = `
                    <span style="font-size: 1.5rem; margin-right: 0.5rem;">â°</span>
                    ì‹œê°„ ê¸°ë°˜ ë¶„ì„
                    <span style="background: rgba(99, 102, 241, 0.3); color: #c7d2fe; padding: 0.2rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; margin-left: 0.5rem;">
                        ${availableMetrics.length}ê°œ ë©”íŠ¸ë¦­
                    </span>
                `;
            }

            if (availableMetrics.length === 0) {
                chartContainer.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 250px; color: #94a3b8; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">â°</div>
                            <div style="font-size: 0.9rem;">ì‹œê°„ ê¸°ë°˜ ë¶„ì„ ë°ì´í„° ì—†ìŒ</div>
                        </div>
                    </div>
                `;
                return;
            }

            // ë°” ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„ (ì‹¤ì œ ë² ì´ìŠ¤ë¼ì¸ ë°ì´í„° ì‚¬ìš©)
            const labels = availableMetrics.map(metric => getMetricDisplayName(metric.metric_name));
            const currentData = availableMetrics.map(metric => (metric.quality_score || 0) * 100);

            // í’ˆì§ˆ ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
            const backgroundColors = currentData.map(score => {
                if (score >= 80) return 'rgba(34, 197, 94, 0.6)';      // ë…¹ìƒ‰
                if (score >= 60) return 'rgba(234, 179, 8, 0.6)';       // ë…¸ë€ìƒ‰
                return 'rgba(239, 68, 68, 0.6)';                        // ë¹¨ê°„ìƒ‰
            });

            const borderColors = currentData.map(score => {
                if (score >= 80) return '#22c55e';     // ë…¹ìƒ‰
                if (score >= 60) return '#eab308';      // ë…¸ë€ìƒ‰
                return '#ef4444';                       // ë¹¨ê°„ìƒ‰
            });

            // ì‹¤ì œ ì‚¬ìš©ëœ ë©”íŠ¸ë¦­ ëª©ë¡ ì—…ë°ì´íŠ¸
            const timeBasedMetricsList = document.getElementById('timeBasedMetricsList');
            if (timeBasedMetricsList) {
                const metricNames = availableMetrics.map(m => getMetricDisplayName(m.metric_name)).join(', ');
                timeBasedMetricsList.innerHTML = `ì‹¤ì œ ë¶„ì„ëœ ë©”íŠ¸ë¦­: ${metricNames}`;
            }

            // Chart.js ë°” ì°¨íŠ¸ ìƒì„±
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'í’ˆì§ˆ ì ìˆ˜',
                            data: currentData,
                            backgroundColor: backgroundColors,
                            borderColor: borderColors,
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateNetworkBasedChart(baselineResults) {
            const chartContainer = document.getElementById('networkBasedChart');
            if (!chartContainer || !baselineResults) return;

            // Chart container ì´ˆê¸°í™”
            chartContainer.innerHTML = '';
            chartContainer.style.position = 'relative';

            // Canvas ìƒì„±
            const canvas = document.createElement('canvas');
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            chartContainer.appendChild(canvas);

            const baselines = baselineResults.baselines || [];

            // ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë©”íŠ¸ë¦­ë“¤
            const networkMetrics = [
                'ip_address_pattern',
                'geo_location_analysis',
                'data_volume_transfer',
                'impossible_travel_detection',
                'vpn_usage_pattern'
            ];

            // ë² ì´ìŠ¤ë¼ì¸ì—ì„œ ë„¤íŠ¸ì›Œí¬ ê´€ë ¨ ë©”íŠ¸ë¦­ ì¶”ì¶œ
            const availableMetrics = baselines
                .filter(baseline => networkMetrics.includes(baseline.metric_name))
                .slice(0, 5);

            // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
            console.log('ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„ - ì‚¬ìš© ê°€ëŠ¥í•œ ë©”íŠ¸ë¦­:', availableMetrics.map(m => m.metric_name));

            // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
            const networkBasedTitle = document.querySelector('#networkBasedChart').closest('div').querySelector('h4');
            if (networkBasedTitle) {
                networkBasedTitle.innerHTML = `
                    <span style="font-size: 1.5rem; margin-right: 0.5rem;">ğŸŒ</span>
                    ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„
                    <span style="background: rgba(6, 182, 212, 0.3); color: #7dd3fc; padding: 0.2rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; margin-left: 0.5rem;">
                        ${availableMetrics.length}ê°œ ë©”íŠ¸ë¦­
                    </span>
                `;
            }

            if (availableMetrics.length === 0) {
                chartContainer.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 250px; color: #94a3b8; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸŒ</div>
                            <div style="font-size: 0.9rem;">ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë¶„ì„ ë°ì´í„° ì—†ìŒ</div>
                        </div>
                    </div>
                `;
                return;
            }

            // ë ˆì´ë” ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„ (ì‹¤ì œ ë² ì´ìŠ¤ë¼ì¸ ë°ì´í„° ì‚¬ìš©)
            const labels = availableMetrics.map(metric => getMetricDisplayName(metric.metric_name));
            const currentData = availableMetrics.map(metric => (metric.quality_score || 0) * 100);

            // ì‹¤ì œ ì‚¬ìš©ëœ ë©”íŠ¸ë¦­ ëª©ë¡ ì—…ë°ì´íŠ¸
            const networkBasedMetricsList = document.getElementById('networkBasedMetricsList');
            if (networkBasedMetricsList) {
                const metricNames = availableMetrics.map(m => getMetricDisplayName(m.metric_name)).join(', ');
                networkBasedMetricsList.innerHTML = `ì‹¤ì œ ë¶„ì„ëœ ë©”íŠ¸ë¦­: ${metricNames}`;
            }

            // Chart.js ë ˆì´ë” ì°¨íŠ¸ ìƒì„±
            new Chart(canvas, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'í’ˆì§ˆ ì ìˆ˜',
                            data: currentData,
                            borderColor: '#06b6d4',
                            backgroundColor: 'rgba(6, 182, 212, 0.2)',
                            borderWidth: 2,
                            pointBackgroundColor: '#06b6d4',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#94a3b8',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(148, 163, 184, 0.1)'
                            },
                            pointLabels: {
                                color: '#94a3b8',
                                font: {
                                    size: 10
                                }
                            }
                        }
                    }
                }
            });
        }

        // ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateAccessBasedChart(baselineResults) {
            const chartContainer = document.getElementById('accessBasedChart');
            if (!chartContainer || !baselineResults) return;

            // Chart container ì´ˆê¸°í™”
            chartContainer.innerHTML = '';
            chartContainer.style.position = 'relative';

            // Canvas ìƒì„±
            const canvas = document.createElement('canvas');
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            chartContainer.appendChild(canvas);

            const baselines = baselineResults.baselines || [];

            // ì ‘ê·¼ ê¸°ë°˜ ë©”íŠ¸ë¦­ë“¤
            const accessMetrics = [
                'concurrent_session_detection',
                'network_device_change',
                'bandwidth_usage_anomaly',
                'connection_pattern_analysis',
                'timezone_anomaly_access'
            ];

            // ë² ì´ìŠ¤ë¼ì¸ì—ì„œ ì ‘ê·¼ ê´€ë ¨ ë©”íŠ¸ë¦­ ì¶”ì¶œ
            const availableMetrics = baselines
                .filter(baseline => accessMetrics.includes(baseline.metric_name))
                .slice(0, 5);

            // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
            console.log('ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„ - ì‚¬ìš© ê°€ëŠ¥í•œ ë©”íŠ¸ë¦­:', availableMetrics.map(m => m.metric_name));

            // ì°¨íŠ¸ ì œëª© ì—…ë°ì´íŠ¸
            const accessBasedTitle = document.querySelector('#accessBasedChart').closest('div').querySelector('h4');
            if (accessBasedTitle) {
                accessBasedTitle.innerHTML = `
                    <span style="font-size: 1.5rem; margin-right: 0.5rem;">ğŸ”</span>
                    ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„
                    <span style="background: rgba(168, 85, 247, 0.3); color: #d8b4fe; padding: 0.2rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; margin-left: 0.5rem;">
                        ${availableMetrics.length}ê°œ ë©”íŠ¸ë¦­
                    </span>
                `;
            }

            if (availableMetrics.length === 0) {
                chartContainer.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 250px; color: #94a3b8; text-align: center;">
                        <div>
                            <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ğŸ”</div>
                            <div style="font-size: 0.9rem;">ì ‘ê·¼ ê¸°ë°˜ ë¶„ì„ ë°ì´í„° ì—†ìŒ</div>
                        </div>
                    </div>
                `;
                return;
            }

            // ë„ë„› ì°¨íŠ¸ ë°ì´í„° ì¤€ë¹„ (ì‹¤ì œ ë² ì´ìŠ¤ë¼ì¸ ë°ì´í„° ì‚¬ìš©)
            const labels = availableMetrics.map(metric => getMetricDisplayName(metric.metric_name));
            const currentData = availableMetrics.map(metric => (metric.quality_score || 0) * 100);

            // í’ˆì§ˆ ì ìˆ˜ì— ë”°ë¥¸ ìƒ‰ìƒ ê²°ì •
            const backgroundColors = currentData.map(score => {
                if (score >= 80) return 'rgba(34, 197, 94, 0.6)';      // ë…¹ìƒ‰
                if (score >= 60) return 'rgba(234, 179, 8, 0.6)';       // ë…¸ë€ìƒ‰
                return 'rgba(239, 68, 68, 0.6)';                        // ë¹¨ê°„ìƒ‰
            });

            const borderColors = currentData.map(score => {
                if (score >= 80) return '#22c55e';     // ë…¹ìƒ‰
                if (score >= 60) return '#eab308';      // ë…¸ë€ìƒ‰
                return '#ef4444';                       // ë¹¨ê°„ìƒ‰
            });

            // ì‹¤ì œ ì‚¬ìš©ëœ ë©”íŠ¸ë¦­ ëª©ë¡ ì—…ë°ì´íŠ¸
            const accessBasedMetricsList = document.getElementById('accessBasedMetricsList');
            if (accessBasedMetricsList) {
                const metricNames = availableMetrics.map(m => getMetricDisplayName(m.metric_name)).join(', ');
                accessBasedMetricsList.innerHTML = `ì‹¤ì œ ë¶„ì„ëœ ë©”íŠ¸ë¦­: ${metricNames}`;
            }

            // Chart.js ë„ë„› ì°¨íŠ¸ ìƒì„±
            new Chart(canvas, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            data: currentData,
                            backgroundColor: backgroundColors,
                            borderColor: borderColors,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#94a3b8',
                                font: {
                                    size: 10
                                },
                                padding: 10,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    }
                }
            });
        }

        // ì´ìƒ íƒì§€ ê²°ê³¼ ì—…ë°ì´íŠ¸
        function updateAnomalyDetectionResults(baselineResults) {
            const anomaliesSection = document.querySelector('.data-table tbody');
            if (!anomaliesSection) return;

            const anomalies = baselineResults.anomalies;

            if (!anomalies || (Array.isArray(anomalies) && anomalies.length === 0) ||
                (anomalies.anomalies && anomalies.anomalies.length === 0)) {
                anomaliesSection.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; color: #10b981; padding: 2rem;">
                            âœ… í˜„ì¬ ì´ìƒ í–‰ë™ì´ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
                        </td>
                    </tr>
                `;
                return;
            }

            const anomalyList = Array.isArray(anomalies) ? anomalies : (anomalies.anomalies || []);

            anomaliesSection.innerHTML = anomalyList.slice(0, 10).map((anomaly, index) => {
                const score = anomaly.deviation_score || anomaly.score || 0;
                const severity = score > 0.8 ? 'high' : score > 0.6 ? 'medium' : 'low';
                const severityText = severity === 'high' ? 'ë†’ìŒ' : severity === 'medium' ? 'ì¤‘ê°„' : 'ë‚®ìŒ';

                return `
                    <tr>
                        <td>${anomaly.target_entity || `Entity-${index + 1}`}</td>
                        <td>${anomaly.metric_name || 'íŒ¨í„´ ì´ìƒ'}</td>
                        <td class="severity-${severity}">
                            <span class="severity-indicator"></span>
                            ${severityText}
                        </td>
                        <td>${anomaly.detection_time || new Date().toLocaleDateString('ko-KR')}</td>
                    </tr>
                `;
            }).join('');
        }

        // ì‹œê³„ì—´ ë°ì´í„° ë¡œë“œ (ìƒˆë¡œìš´ ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API ì‚¬ìš©)
        async function loadTimelineData(profileId) {
            try {
                console.log('ì‹œê³„ì—´ ë°ì´í„° ë¡œë”© ì‹œì‘:', profileId);



                // 2. ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë“œ
                const patternsResponse = await fetch(`/api/profiles/${profileId}/hourly-patterns`);
                let patternsData = null;
                if (patternsResponse.ok) {
                    patternsData = await patternsResponse.json();
                    console.log('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„°:', patternsData);
                    updateHourlyPatternsChart(patternsData);
                } else {
                    console.warn('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', patternsResponse.status);
                }

                // 3. ì´ìƒì¹˜ ì‹œê³„ì—´ ë°ì´í„° ë¡œë“œ
                const anomalyTimelineResponse = await fetch(`/api/profiles/${profileId}/anomalies/timeline?days=30`);
                let anomalyTimelineData = null;
                if (anomalyTimelineResponse.ok) {
                    anomalyTimelineData = await anomalyTimelineResponse.json();
                    console.log('ì´ìƒì¹˜ ì‹œê³„ì—´ ë°ì´í„°:', anomalyTimelineData);
                } else {
                    console.warn('ì´ìƒì¹˜ ì‹œê³„ì—´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', anomalyTimelineResponse.status);
                }

                // 4. í’ˆì§ˆ ì¶”ì´ ë°ì´í„° ë¡œë“œ
                const qualityTrendsResponse = await fetch(`/api/profiles/${profileId}/quality-trends`);
                let qualityTrendsData = null;
                if (qualityTrendsResponse.ok) {
                    qualityTrendsData = await qualityTrendsResponse.json();
                    console.log('í’ˆì§ˆ ì¶”ì´ ë°ì´í„°:', qualityTrendsData);
                } else {
                    console.warn('í’ˆì§ˆ ì¶”ì´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', qualityTrendsResponse.status);
                }

                return {
                    timeline: timelineData,
                    patterns: patternsData,
                    anomalyTimeline: anomalyTimelineData,
                    qualityTrends: qualityTrendsData
                };

            } catch (error) {
                console.error('ì‹œê³„ì—´ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨:', error);
                return null;
            }
        }



        // ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        function updateHourlyPatternsChart(patternsData) {
            console.log('ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„° ìˆ˜ì‹ :', patternsData);

            const heatmapContainer = document.querySelector('.heatmap-container');
            if (!heatmapContainer || !patternsData) {
                return;
            }

            // íˆíŠ¸ë§µ ì»¨í…Œì´ë„ˆë¥¼ ì°¨íŠ¸ ì»¨í…Œì´ë„ˆë¡œ ì„¤ì •
            heatmapContainer.innerHTML = '';
            heatmapContainer.style.height = '300px';
            heatmapContainer.style.position = 'relative';

            // Canvas ìƒì„±
            const canvas = document.createElement('canvas');
            canvas.style.width = '100%';
            canvas.style.height = '100%';
            heatmapContainer.appendChild(canvas);

            // ì‹œê°„ëŒ€ë³„ ë°ì´í„° ì¤€ë¹„ (24ì‹œê°„)
            const hours = Array.from({length: 24}, (_, i) => i.toString().padStart(2, '0') + ':00');

                        // ì£¼ìš” ë©”íŠ¸ë¦­ë“¤ì˜ ì‹œê°„ëŒ€ë³„ í™œë™ëŸ‰ ë°ì´í„° ì¶”ì¶œ (ë°ì´í„°ê°€ ìˆëŠ” ë©”íŠ¸ë¦­ë§Œ)
            const datasets = [];
            const metricColors = {
                'login_time_pattern': '#6366f1',
                'session_duration': '#10b981',
                'vpn_usage_pattern': '#f59e0b',
                'geo_location_analysis': '#ef4444',
                'data_volume_transfer': '#8b5cf6',
                'network_device_change': '#06b6d4',
                'after_hours_activity': '#f97316',
                'concurrent_session_detection': '#84cc16'
            };

            // ì‹¤ì œ ë°ì´í„°ê°€ ìˆëŠ” ë©”íŠ¸ë¦­ë§Œ í•„í„°ë§
            Object.keys(patternsData.hourly_patterns || {}).forEach((metricName, index) => {
                const metricData = patternsData.hourly_patterns[metricName];
                if (metricData) {
                    const hourlyData = hours.map(hour => {
                        const hourNum = parseInt(hour.split(':')[0]);
                        return metricData[hourNum] ? metricData[hourNum].avg : 0;
                    });

                    // ì‹¤ì œ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ (ëª¨ë“  ê°’ì´ 0ì´ ì•„ë‹Œì§€)
                    const hasData = hourlyData.some(value => value > 0);

                    if (hasData) {
                        datasets.push({
                            label: getMetricDisplayName(metricName),
                            data: hourlyData,
                            backgroundColor: metricColors[metricName] || getRandomColor(index),
                            borderColor: metricColors[metricName] || getRandomColor(index),
                            borderWidth: 1,
                            alpha: 0.7
                        });
                    }
                }
            });

            // Chart.jsë¡œ ë°” ì°¨íŠ¸ ìƒì„± (íˆíŠ¸ë§µ ëŒ€ì‹  ì‹œê°„ëŒ€ë³„ ë°” ì°¨íŠ¸)
            new Chart(canvas, {
                type: 'bar',
                data: {
                    labels: hours,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ì‹œê°„ëŒ€ë³„ í™œë™ íŒ¨í„´',
                            color: '#e2e8f0',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#e2e8f0',
                                usePointStyle: true,
                                pointStyle: 'rect'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    return `${tooltipItems[0].label} ì‹œê°„ëŒ€`;
                                },
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#94a3b8'
                            },
                            grid: {
                                color: 'rgba(51, 65, 85, 0.3)'
                            },
                            title: {
                                display: true,
                                text: 'í™œë™ëŸ‰',
                                color: '#94a3b8'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#94a3b8',
                                maxRotation: 45,
                                minRotation: 45
                            },
                            grid: {
                                color: 'rgba(51, 65, 85, 0.3)'
                            },
                            title: {
                                display: true,
                                text: 'ì‹œê°„ëŒ€',
                                color: '#94a3b8'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });

            // íŒ¨í„´ ë¶„ì„ ìš”ì•½ ì •ë³´ ì¶”ê°€
            if (patternsData.patterns) {
                const patterns = patternsData.patterns;
                const summaryHtml = `
                    <div style="position: absolute; top: 10px; right: 10px; background: rgba(30, 41, 59, 0.9); padding: 0.75rem; border-radius: 0.5rem; font-size: 0.8rem; max-width: 200px;">
                        <div style="color: #a5b4fc; margin-bottom: 0.5rem; font-weight: 600;">ğŸ“Š íŒ¨í„´ ë¶„ì„</div>
                        <div style="color: #e2e8f0; margin-bottom: 0.25rem;">í”¼í¬ ì‹œê°„: ${patterns.peak_hours?.slice(0, 3).join(', ') || '-'}ì‹œ</div>
                        <div style="color: #10b981; margin-bottom: 0.25rem;">ì—…ë¬´ì‹œê°„ í™œë™: ${patterns.business_hours_activity ? (patterns.business_hours_activity * 100).toFixed(1) : '-'}%</div>
                        <div style="color: #f59e0b;">ì‹œê°„ì™¸ í™œë™: ${patterns.after_hours_activity ? (patterns.after_hours_activity * 100).toFixed(1) : '-'}%</div>
                    </div>
                `;
                heatmapContainer.insertAdjacentHTML('beforeend', summaryHtml);
            }

            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
            if (datasets.length === 0) {
                heatmapContainer.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 300px; color: #94a3b8; text-align: center;">
                        <div>
                            <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ“Š</div>
                            <div>ì‹œê°„ëŒ€ë³„ íŒ¨í„´ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤</div>
                            <div style="font-size: 0.8rem; margin-top: 0.5rem;">ë” ë§ì€ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ë©´ íŒ¨í„´ì´ í‘œì‹œë©ë‹ˆë‹¤</div>
                        </div>
                    </div>
                `;
                return;
            }
        }



        // ì°¨íŠ¸ ìº”ë²„ìŠ¤ ìƒì„±
        function createChartCanvas(container) {
            // ê¸°ì¡´ ë‚´ìš© ì œê±°
            container.innerHTML = '';

            const canvas = document.createElement('canvas');
            canvas.style.width = '100%';
            canvas.style.height = '400px';
            container.appendChild(canvas);
            return canvas;
        }

        // ë©”íŠ¸ë¦­ í‘œì‹œ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
        function getMetricDisplayName(metricName) {
            const displayNames = {
                'login_time_pattern': 'ë¡œê·¸ì¸ ì‹œê°„ íŒ¨í„´',
                'session_duration': 'ì„¸ì…˜ ì§€ì†ì‹œê°„',
                'vpn_usage_pattern': 'VPN ì‚¬ìš© íŒ¨í„´',
                'geo_location_analysis': 'ì§€ë¦¬ì  ìœ„ì¹˜ ë¶„ì„',
                'data_volume_transfer': 'ë°ì´í„° ì „ì†¡ëŸ‰',
                'network_device_change': 'ë„¤íŠ¸ì›Œí¬ ê¸°ê¸° ë³€ê²½',
                'ip_address_pattern': 'IP ì£¼ì†Œ íŒ¨í„´',
                'impossible_travel_detection': 'ë¶ˆê°€ëŠ¥í•œ ì´ë™ íƒì§€',
                'after_hours_activity': 'ì—…ë¬´ì‹œê°„ ì™¸ í™œë™',
                'weekend_holiday_access': 'ì£¼ë§/íœ´ì¼ ì ‘ì†'
            };
            return displayNames[metricName] || metricName;
        }

        // ëœë¤ ìƒ‰ìƒ ìƒì„±
        function getRandomColor(index) {
            const colors = [
                '#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#06b6d4',
                '#84cc16', '#f97316', '#ec4899', '#14b8a6', '#f472b6', '#a78bfa'
            ];
            return colors[index % colors.length];
        }

        // í™œë™ íƒ€ì„ë¼ì¸ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ê¸°ì¡´ í•¨ìˆ˜ - ìµœê·¼ í™œë™ ë¡œê·¸ìš©ìœ¼ë¡œ ìœ ì§€)
        function updateActivityTimelineChart(baselineResults) {
            const timelineContainer = document.querySelector('.activity-timeline');
            if (!timelineContainer) return;

            // ë² ì´ìŠ¤ë¼ì¸ ìƒì„± ì´ë ¥ì„ ì‹œê³„ì—´ í˜•íƒœë¡œ í‘œì‹œ
            const baselines = baselineResults.baselines;
            const summary = baselineResults.summary;

            timelineContainer.innerHTML = baselines.slice(0, 5).map((baseline, index) => `
                <div class="timeline-item">
                    <div class="timeline-time">${new Date(baseline.created_at || new Date()).toLocaleDateString('ko-KR')}</div>
                    <div class="timeline-content">
                        <strong>${baseline.metric_name || 'ë©”íŠ¸ë¦­'}</strong> ë² ì´ìŠ¤ë¼ì¸ ìƒì„±
                        <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 0.25rem;">
                            í’ˆì§ˆ ì ìˆ˜: ${((baseline.quality_score || 0) * 100).toFixed(1)}% â€¢
                            ë²„ì „: ${baseline.version || '1.0'} â€¢
                            ìƒíƒœ: ${baseline.status || 'active'}
                        </div>
                    </div>
                </div>
            `).join('') + `
                <div class="timeline-item">
                    <div class="timeline-time">${new Date().toLocaleDateString('ko-KR')}</div>
                    <div class="timeline-content">
                        <strong>ë¶„ì„ ìš”ì•½</strong>
                        <div style="color: #94a3b8; font-size: 0.8rem; margin-top: 0.25rem;">
                            ì´ ${summary?.total_baselines || baselines.length}ê°œ ë² ì´ìŠ¤ë¼ì¸ â€¢
                            ì´ìƒì¹˜ ${summary?.anomaly_count || 0}ê°œ íƒì§€ â€¢
                            í‰ê·  í’ˆì§ˆ: ${(baselines.reduce((acc, b) => acc + (b.quality_score || 0), 0) / baselines.length * 100).toFixed(1)}%
                        </div>
                    </div>
                </div>
            `;
        }

        // ê¶Œì¥ì‚¬í•­ ì—…ë°ì´íŠ¸
        function updateRecommendations(baselineResults) {
            const recommendationsContainer = document.querySelector('.recommendations');
            if (!recommendationsContainer) return;

            const summary = baselineResults.summary || {};
            const hasAnomalies = (summary.anomaly_count || 0) > 0;

            recommendationsContainer.innerHTML = `
                <div class="recommendation-item">
                    <div class="recommendation-icon">ğŸ“Š</div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ ì™„ë£Œ</div>
                        <div class="recommendation-text">
                            ì´ ${summary.total_baselines || baselineResults.baselines?.length || 0}ê°œì˜ ë©”íŠ¸ë¦­ì— ëŒ€í•´ ë² ì´ìŠ¤ë¼ì¸ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
                            ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ì„ í†µí•´ ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ì˜ ë³€í™”ë¥¼ ì¶”ì í•˜ì„¸ìš”.
                        </div>
                    </div>
                </div>

                ${hasAnomalies ? `
                    <div class="recommendation-item">
                        <div class="recommendation-icon">âš ï¸</div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">ì´ìƒ í–‰ë™ íƒì§€ë¨</div>
                            <div class="recommendation-text">
                                ${summary.anomaly_count || 0}ê°œì˜ ì´ìƒ í–‰ë™ì´ íƒì§€ë˜ì—ˆìŠµë‹ˆë‹¤.
                                ê° í•­ëª©ì„ ê²€í† í•˜ì—¬ ì‹¤ì œ ë³´ì•ˆ ìœ„í˜‘ì¸ì§€ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ì¶”ê°€ ì¡°ì¹˜ë¥¼ ì·¨í•˜ì„¸ìš”.
                            </div>
                        </div>
                    </div>
                ` : `
                    <div class="recommendation-item">
                        <div class="recommendation-icon">âœ…</div>
                        <div class="recommendation-content">
                            <div class="recommendation-title">ì •ìƒ í–‰ë™ íŒ¨í„´</div>
                            <div class="recommendation-text">
                                í˜„ì¬ ì´ìƒ í–‰ë™ì´ íƒì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
                                ë² ì´ìŠ¤ë¼ì¸ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ê³  ìˆìœ¼ë©°, ì •ê¸°ì ì¸ ê²€í† ë¥¼ ê³„ì†í•˜ì„¸ìš”.
                            </div>
                        </div>
                    </div>
                `}

                <div class="recommendation-item">
                    <div class="recommendation-icon">ğŸ”„</div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">ì •ê¸°ì  ë² ì´ìŠ¤ë¼ì¸ ì—…ë°ì´íŠ¸</div>
                        <div class="recommendation-text">
                            ì‚¬ìš©ì í–‰ë™ íŒ¨í„´ì€ ì‹œê°„ì— ë”°ë¼ ë³€í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            ì›” 1íšŒ ì´ìƒ ë² ì´ìŠ¤ë¼ì¸ì„ ì¬ìƒì„±í•˜ì—¬ ìµœì‹  íŒ¨í„´ì„ ë°˜ì˜í•˜ì„¸ìš”.
                        </div>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
