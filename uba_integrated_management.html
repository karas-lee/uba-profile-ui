<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UBA í”„ë¡œíŒŒì¼ í†µí•© ê´€ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .header .back-button {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-50%) translateX(-2px);
        }

        .header-content {
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .nav-tab.active {
            background: white;
            border-bottom-color: #007bff;
            color: #007bff;
            font-weight: 600;
        }

        .tab-content {
            display: none;
            padding: 30px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        /* í”„ë¡œíŒŒì¼ ê´€ë¦¬ ì„¹ì…˜ */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .section-title {
            font-size: 1.8em;
            color: #2c3e50;
            font-weight: 600;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 193, 7, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        /* í”„ë¡œíŒŒì¼ í…Œì´ë¸” */
        .profile-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .profile-table th {
            background: linear-gradient(135deg, #495057, #6c757d);
            color: white;
            padding: 15px 12px;
            font-weight: 600;
            text-align: left;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .profile-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
            font-size: 14px;
        }

        .profile-table tr:hover {
            background: #f8f9fa;
        }

        .profile-table tr:last-child td {
            border-bottom: none;
        }

        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1b0b7;
        }

        .status-running {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f1b0b7;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 6px 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .action-btn.manual-run {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .action-btn.edit {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .action-btn.delete {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .action-btn.view {
            background: linear-gradient(135deg, #6f42c1, #59359a);
            color: white;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 18px;
            color: #6c757d;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .profile-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast-message.show {
            transform: translateX(0);
        }

        .toast-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }

        .toast-error {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .toast-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .toast-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff, #f8f9fa);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-left: 5px solid #007bff;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 1.1em;
            color: #6c757d;
            font-weight: 500;
        }

        /* ì‹¤í–‰ ì´ë ¥ í…Œì´ë¸” */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        .history-table th {
            background: linear-gradient(135deg, #495057, #6c757d);
            color: white;
            padding: 15px 12px;
            font-weight: 600;
            text-align: left;
            font-size: 14px;
        }

        .history-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .history-table tr:hover {
            background: #f8f9fa;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .tab-content {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-bottom: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .profile-table, .history-table {
                font-size: 12px;
            }

            .profile-table th, .profile-table td,
            .history-table th, .history-table td {
                padding: 8px 6px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 4px;
            }

            .action-btn {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <a href="index.html" class="back-button">
                <span>ğŸ”™</span>
                ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°
            </a>
            <div class="header-content">
                <h1>ğŸ›¡ï¸ UBA í”„ë¡œíŒŒì¼ í†µí•© ê´€ë¦¬</h1>
                <p>ì‚¬ìš©ì í–‰ë™ ë¶„ì„ í”„ë¡œíŒŒì¼ ë° ë² ì´ìŠ¤ë¼ì¸ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            </div>
        </div>

        <!-- ë‚´ë¹„ê²Œì´ì…˜ íƒ­ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('profile-management')">í”„ë¡œíŒŒì¼ ì‹¤í–‰ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('execution-history')">ì‹¤í–‰ ì´ë ¥</button>
            <button class="nav-tab" onclick="showTab('monitoring')">ëª¨ë‹ˆí„°ë§</button>
        </div>

        <!-- í”„ë¡œíŒŒì¼ ì‹¤í–‰ ê´€ë¦¬ íƒ­ -->
        <div id="profile-management" class="tab-content active">
            <div class="section-header">
                <h2 class="section-title">í”„ë¡œíŒŒì¼ ì‹¤í–‰ ê´€ë¦¬</h2>
                <div class="button-group">
                    <button class="btn btn-success" id="manualRunBtn">ìˆ˜ë™ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±</button>
                    <button class="btn btn-warning" id="manualRunSelectedBtn">ì„ íƒ í•­ëª© ìˆ˜ë™ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±</button>
                    <button class="btn btn-primary" onclick="refreshProfiles()">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>

            <!-- í†µê³„ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalProfiles">0</div>
                    <div class="stat-label">ì „ì²´ í”„ë¡œíŒŒì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeProfiles">0</div>
                    <div class="stat-label">í™œì„± í”„ë¡œíŒŒì¼</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="runningBaselines">0</div>
                    <div class="stat-label">ì‹¤í–‰ ì¤‘ì¸ ë² ì´ìŠ¤ë¼ì¸</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedToday">0</div>
                    <div class="stat-label">ì˜¤ëŠ˜ ì™„ë£Œëœ ì‘ì—…</div>
                </div>
            </div>

            <!-- í”„ë¡œíŒŒì¼ ëª©ë¡ -->
            <div id="profileTableContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    í”„ë¡œíŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
        </div>

        <!-- ì‹¤í–‰ ì´ë ¥ íƒ­ -->
        <div id="execution-history" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">ë² ì´ìŠ¤ë¼ì¸ ì‹¤í–‰ ì´ë ¥</h2>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="refreshHistory()" title="ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‹¤í–‰ ì´ë ¥ì„ ì¡°íšŒí•©ë‹ˆë‹¤">ìƒˆë¡œê³ ì¹¨</button>
                    <button class="btn btn-success" onclick="exportHistory()">ì´ë ¥ ë‚´ë³´ë‚´ê¸°</button>
                </div>
            </div>

            <!-- ì‹¤í–‰ ì´ë ¥ ëª©ë¡ -->
            <div id="historyTableContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    ì‹¤í–‰ ì´ë ¥ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
        </div>

        <!-- ëª¨ë‹ˆí„°ë§ íƒ­ -->
        <div id="monitoring" class="tab-content">
            <div class="section-header">
                <h2 class="section-title">ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</h2>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="refreshMonitoring()">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="systemStatus">ì •ìƒ</div>
                    <div class="stat-label">ì‹œìŠ¤í…œ ìƒíƒœ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="baselineEngineStatus">ì—°ê²°ë¨</div>
                    <div class="stat-label">ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lastSync">ë°©ê¸ˆ ì „</div>
                    <div class="stat-label">ë§ˆì§€ë§‰ ë™ê¸°í™”</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="errorCount">0</div>
                    <div class="stat-label">ì˜¤ë¥˜ ìˆ˜</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let profiles = [];
        let executionHistory = [];
        let selectedProfiles = [];

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('UBA í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘');

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();

            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            await refreshProfiles();
            await refreshMonitoring();

            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì „ìš© ëª¨ë“œì—ì„œëŠ” ì‹¤í–‰ ì´ë ¥ì„ ê¸°ë³¸ì ìœ¼ë¡œ ë¡œë“œí•˜ì§€ ì•ŠìŒ
            // ì‚¬ìš©ìê°€ ëª…ì‹œì ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ í´ë¦­í•  ë•Œë§Œ ì‹œë„

            console.log('ì´ˆê¸°í™” ì™„ë£Œ');
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            const manualRunBtn = document.getElementById('manualRunBtn');
            const manualRunSelectedBtn = document.getElementById('manualRunSelectedBtn');

            if (manualRunBtn) {
                manualRunBtn.addEventListener('click', runManualBaselineForAll);
            }

            if (manualRunSelectedBtn) {
                manualRunSelectedBtn.addEventListener('click', runManualBaselineForSelected);
            }
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ìˆ¨ê¸°ê¸°
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));

            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));

            // ì„ íƒëœ íƒ­ í‘œì‹œ
            const selectedTab = document.getElementById(tabName);
            const selectedButton = event.target;

            if (selectedTab) {
                selectedTab.classList.add('active');
            }

            if (selectedButton) {
                selectedButton.classList.add('active');
            }

            // íƒ­ë³„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
            if (tabName === 'profile-management') {
                refreshProfiles();
            } else if (tabName === 'execution-history') {
                // ì‹¤í–‰ ì´ë ¥ íƒ­ í™œì„±í™” ì‹œ ìë™ìœ¼ë¡œ ì´ë ¥ ë¡œë“œ
                console.log('ì‹¤í–‰ ì´ë ¥ íƒ­ í™œì„±í™” - ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì´ë ¥ ì¡°íšŒ ì‹œì‘');
                refreshHistory();
            } else if (tabName === 'monitoring') {
                refreshMonitoring();
            }
        }

        // í”„ë¡œíŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (ë² ì´ìŠ¤ë¼ì¸ APIì—ì„œ ì§ì ‘ ì¡°íšŒ)
        async function refreshProfiles() {
            try {
                console.log('í”„ë¡œíŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');
                showLoading('profileTableContainer', 'í”„ë¡œíŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');

                // í”„ë¡ì‹œë¥¼ í†µí•´ ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API í˜¸ì¶œ (CORS ë¬¸ì œ í•´ê²°)
                const response = await fetch('/api/profiles');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('í”„ë¡œíŒŒì¼ ë°ì´í„°:', data);

                // ì‘ë‹µ ë°ì´í„° êµ¬ì¡° ì²˜ë¦¬
                if (data.profiles && Array.isArray(data.profiles)) {
                    profiles = data.profiles;
                } else if (Array.isArray(data)) {
                    profiles = data;
                } else {
                    throw new Error('í”„ë¡œíŒŒì¼ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }

                // ê° í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ
                await loadProfileBaselineStatuses();

                // í”„ë¡œíŒŒì¼ í…Œì´ë¸” ë Œë”ë§
                renderProfileTable();

                // í†µê³„ ì—…ë°ì´íŠ¸
                updateProfileStats();

                console.log(`${profiles.length}ê°œì˜ í”„ë¡œíŒŒì¼ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);

            } catch (error) {
                console.error('í”„ë¡œíŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                showError('profileTableContainer', 'í”„ë¡œíŒŒì¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
                showToast('í”„ë¡œíŒŒì¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        }

        // í”„ë¡œíŒŒì¼ë³„ ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ
        async function loadProfileBaselineStatuses() {
            for (let profile of profiles) {
                try {
                    const response = await fetch(`/api/profiles/${profile.id}/baseline/status`);
                    if (response.ok) {
                        const statusData = await response.json();
                        profile.baseline_status = statusData;
                    }
                } catch (error) {
                    console.warn(`í”„ë¡œíŒŒì¼ ${profile.id} ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨:`, error.message);
                    profile.baseline_status = null;
                }
            }
        }

        // í”„ë¡œíŒŒì¼ í…Œì´ë¸” ë Œë”ë§
        function renderProfileTable() {
            const container = document.getElementById('profileTableContainer');

            if (!profiles || profiles.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <h3>ë“±ë¡ëœ í”„ë¡œíŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>í”„ë¡œíŒŒì¼ ë§ˆë²•ì‚¬ë¥¼ í†µí•´ ìƒˆ í”„ë¡œíŒŒì¼ì„ ìƒì„±í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <table class="profile-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                            <th>í”„ë¡œíŒŒì¼ëª…</th>
                            <th>íƒ€ì…</th>
                            <th>ë¡œê·¸ ì†ŒìŠ¤</th>
                            <th>í•™ìŠµ ê¸°ê°„</th>
                            <th>ìƒíƒœ</th>
                            <th>ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ</th>
                            <th>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</th>
                            <th>ì•¡ì…˜</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            profiles.forEach(profile => {
                const baselineStatus = getBaselineStatusDisplay(profile.baseline_status);
                const formattedDate = formatDate(profile.updated_at);

                tableHTML += `
                    <tr>
                        <td>
                            <input type="checkbox" class="profile-checkbox"
                                   data-id="${profile.id}"
                                   onchange="updateSelectedProfiles()">
                        </td>
                        <td>
                            <strong>${escapeHtml(profile.name)}</strong>
                            <br><small style="color: #6c757d;">${escapeHtml(profile.description || '')}</small>
                        </td>
                        <td>
                            <span class="status-badge ${getProfileTypeClass(profile.profile_type)}">
                                ${getProfileTypeText(profile.profile_type)}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge ${getLogSourceClass(profile.log_source)}">
                                ${getLogSourceText(profile.log_source)}
                            </span>
                        </td>
                        <td>${profile.learning_period}ì¼</td>
                        <td>
                            <span class="status-badge ${profile.status === 'active' ? 'status-active' : 'status-inactive'}">
                                ${profile.status === 'active' ? 'í™œì„±' : 'ë¹„í™œì„±'}
                            </span>
                        </td>
                        <td>${baselineStatus}</td>
                        <td>${formattedDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn manual-run"
                                        title="ìˆ˜ë™ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±"
                                        onclick="runManualBaseline('${profile.id}')">
                                    <span>ğŸ”§</span>
                                </button>
                                <button class="action-btn view"
                                        title="ìƒì„¸ ë³´ê¸°"
                                        onclick="viewProfile('${profile.id}')">
                                    <span>ğŸ‘ï¸</span>
                                </button>
                                <button class="action-btn edit"
                                        title="í¸ì§‘"
                                        onclick="editProfile('${profile.id}')">
                                    <span>âœï¸</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ í‘œì‹œ ìƒì„±
        function getBaselineStatusDisplay(baselineStatus) {
            if (!baselineStatus) {
                return '<span class="status-badge status-inactive">ì•Œ ìˆ˜ ì—†ìŒ</span>';
            }

            // ìµœì‹  ì‘ì—… ìƒíƒœê°€ ìˆëŠ” ê²½ìš° ìš°ì„ ì ìœ¼ë¡œ ì‚¬ìš©
            if (baselineStatus.latest_job && baselineStatus.latest_job.status) {
                const jobStatus = baselineStatus.latest_job.status;
                const statusClass = getBaselineStatusClass(jobStatus);
                const statusText = getBaselineStatusText(jobStatus);
                return `<span class="status-badge ${statusClass}">${statusText}</span>`;
            }

            // ë² ì´ìŠ¤ë¼ì¸ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            if (baselineStatus.baseline_count && baselineStatus.baseline_count > 0) {
                return '<span class="status-badge status-completed">ì™„ë£Œ</span>';
            }

            // ë² ì´ìŠ¤ë¼ì¸ì´ ì—†ëŠ” ê²½ìš°
            return '<span class="status-badge status-inactive">ì—†ìŒ</span>';
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ í´ë˜ìŠ¤ ë§¤í•‘
        function getBaselineStatusClass(status) {
            const statusMap = {
                'success': 'status-completed',      // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ë°˜í™˜í•˜ëŠ” ì„±ê³µ ìƒíƒœ
                'completed': 'status-completed',
                'in_progress': 'status-running',
                'running': 'status-running',        // ì‹¤í–‰ ì¤‘ ìƒíƒœ
                'failed': 'status-failed',
                'error': 'status-failed',           // ì˜¤ë¥˜ ìƒíƒœ
                'pending': 'status-inactive'
            };
            return statusMap[status] || 'status-inactive';
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ í…ìŠ¤íŠ¸ ë§¤í•‘
        function getBaselineStatusText(status) {
            const statusMap = {
                'success': 'ì™„ë£Œ',                  // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ë°˜í™˜í•˜ëŠ” ì„±ê³µ ìƒíƒœ
                'completed': 'ì™„ë£Œ',
                'in_progress': 'ì§„í–‰ì¤‘',
                'running': 'ì§„í–‰ì¤‘',                // ì‹¤í–‰ ì¤‘ ìƒíƒœ
                'failed': 'ì‹¤íŒ¨',
                'error': 'ì‹¤íŒ¨',                    // ì˜¤ë¥˜ ìƒíƒœ
                'pending': 'ëŒ€ê¸°ì¤‘'
            };
            return statusMap[status] || 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // í”„ë¡œíŒŒì¼ íƒ€ì… í´ë˜ìŠ¤ ë§¤í•‘
        function getProfileTypeClass(type) {
            const typeMap = {
                'user': 'status-active',
                'hybrid': 'status-running',
                'group': 'status-inactive'
            };
            return typeMap[type] || 'status-inactive';
        }

        // í”„ë¡œíŒŒì¼ íƒ€ì… í…ìŠ¤íŠ¸ ë§¤í•‘
        function getProfileTypeText(type) {
            const typeMap = {
                'user': 'ì‚¬ìš©ì',
                'hybrid': 'í•˜ì´ë¸Œë¦¬ë“œ',
                'group': 'ê·¸ë£¹'
            };
            return typeMap[type] || type;
        }

        // ë¡œê·¸ ì†ŒìŠ¤ í´ë˜ìŠ¤ ë§¤í•‘
        function getLogSourceClass(source) {
            return 'status-active';
        }

        // ë¡œê·¸ ì†ŒìŠ¤ í…ìŠ¤íŠ¸ ë§¤í•‘
        function getLogSourceText(source) {
            const sourceMap = {
                'vpn': 'VPN',
                'proxy': 'í”„ë¡ì‹œ',
                'database': 'ë°ì´í„°ë² ì´ìŠ¤',
                'application': 'ì• í”Œë¦¬ì¼€ì´ì…˜',
                'system': 'ì‹œìŠ¤í…œ'
            };
            return sourceMap[source] || source;
        }

        // ì‹¤í–‰ ì´ë ¥ ìƒˆë¡œê³ ì¹¨ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì „ìš©)
        async function refreshHistory() {
            try {
                console.log('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì‹¤í–‰ ì´ë ¥ ì¡°íšŒ ì‹œë„');
                showLoading('historyTableContainer', 'ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‹¤í–‰ ì´ë ¥ì„ ì¡°íšŒí•˜ëŠ” ì¤‘...');

                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API í˜¸ì¶œ
                const response = await fetch('/api/profiles/baseline/history?limit=100');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì‹¤í–‰ ì´ë ¥ ì‘ë‹µ:', data);

                if (data.success === false) {
                    // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‹¤í–‰ ì´ë ¥ì„ ì œê³µí•˜ì§€ ì•ŠëŠ” ê²½ìš°
                    const container = document.getElementById('historyTableContainer');
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6c757d;">
                            <h3>ì‹¤í–‰ ì´ë ¥ ì¡°íšŒ ë¶ˆê°€</h3>
                            <p>${data.message || 'ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‹¤í–‰ ì´ë ¥ì„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'}</p>
                            <p><small>${data.details || ''}</small></p>
                            <p><strong>ì œì•ˆ:</strong> ${data.suggestion || 'í”„ë¡œíŒŒì¼ ëª©ë¡ì—ì„œ ê°œë³„ í”„ë¡œíŒŒì¼ì˜ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.'}</p>
                        </div>
                    `;
                    return;
                }

                // ì‘ë‹µ ë°ì´í„° êµ¬ì¡° ì²˜ë¦¬
                if (data.history && Array.isArray(data.history)) {
                    executionHistory = data.history;
                } else if (Array.isArray(data)) {
                    executionHistory = data;
                } else {
                    executionHistory = [];
                }

                // ì‹¤í–‰ ì´ë ¥ í…Œì´ë¸” ë Œë”ë§
                renderHistoryTable();

                console.log(`${executionHistory.length}ê°œì˜ ì‹¤í–‰ ì´ë ¥ì„ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.`);

            } catch (error) {
                console.error('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì‹¤í–‰ ì´ë ¥ ì¡°íšŒ ì‹¤íŒ¨:', error);
                const container = document.getElementById('historyTableContainer');
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #dc3545;">
                        <h3>ì‹¤í–‰ ì´ë ¥ ì¡°íšŒ ì‹¤íŒ¨</h3>
                        <p>ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‹¤í–‰ ì´ë ¥ì„ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p><small>${error.message}</small></p>
                        <p><strong>ì•ˆë‚´:</strong> ë² ì´ìŠ¤ë¼ì¸ ìƒì„± ì‘ì—…ì€ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì§„í–‰ë˜ë©°, ê°œë³„ í”„ë¡œíŒŒì¼ ìƒíƒœëŠ” í”„ë¡œíŒŒì¼ ëª©ë¡ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }

        // ì‹¤í–‰ ì´ë ¥ í…Œì´ë¸” ë Œë”ë§
        function renderHistoryTable() {
            const container = document.getElementById('historyTableContainer');

            if (!executionHistory || executionHistory.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #6c757d;">
                        <h3>ì‹¤í–‰ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ë² ì´ìŠ¤ë¼ì¸ ìƒì„± ì‘ì—…ì„ ì‹¤í–‰í•˜ë©´ ì´ë ¥ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            let tableHTML = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>ì‘ì—… ID</th>
                            <th>í”„ë¡œíŒŒì¼</th>
                            <th>ìƒíƒœ</th>
                            <th>ì§„í–‰ë¥ </th>
                            <th>ë©”ì‹œì§€</th>
                            <th>ì‹œì‘ ì‹œê°„</th>
                            <th>ì™„ë£Œ ì‹œê°„</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            executionHistory.forEach(history => {
                const startTime = formatDate(history.created_at);
                const completedTime = history.completed_at ? formatDate(history.completed_at) : '-';
                const progress = history.progress_percentage || 0;

                tableHTML += `
                    <tr>
                        <td>
                            <code style="font-size: 12px; background: #f8f9fa; padding: 2px 6px; border-radius: 4px;">
                                ${escapeHtml(history.job_id)}
                            </code>
                        </td>
                        <td>
                            <strong>${escapeHtml(history.profile_name || history.profile_id)}</strong>
                            <br><small style="color: #6c757d;">${escapeHtml(history.profile_id)}</small>
                        </td>
                        <td>
                            <span class="status-badge ${getBaselineStatusClass(history.status)}">
                                ${getBaselineStatusText(history.status)}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; align-items: center;">
                                <div style="background: #e9ecef; height: 8px; width: 60px; border-radius: 4px; margin-right: 8px;">
                                    <div style="background: #007bff; height: 100%; width: ${progress}%; border-radius: 4px;"></div>
                                </div>
                                <span style="font-size: 12px;">${progress}%</span>
                            </div>
                        </td>
                        <td>
                            <small style="color: #6c757d;">
                                ${escapeHtml(history.message || 'ë©”ì‹œì§€ ì—†ìŒ')}
                            </small>
                        </td>
                        <td>${startTime}</td>
                        <td>${completedTime}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            container.innerHTML = tableHTML;
        }

        // ëª¨ë‹ˆí„°ë§ ìƒˆë¡œê³ ì¹¨
        async function refreshMonitoring() {
            try {
                console.log('ëª¨ë‹ˆí„°ë§ ì •ë³´ ìƒˆë¡œê³ ì¹¨');

                // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ìƒíƒœ í™•ì¸
                const healthResponse = await fetch('/api/profiles').catch(() => null);
                const isHealthy = healthResponse && healthResponse.ok;

                document.getElementById('systemStatus').textContent = 'ì •ìƒ';
                document.getElementById('baselineEngineStatus').textContent = isHealthy ? 'ì—°ê²°ë¨' : 'ì—°ê²° ì‹¤íŒ¨';
                document.getElementById('lastSync').textContent = 'ë°©ê¸ˆ ì „';
                document.getElementById('errorCount').textContent = '0';

            } catch (error) {
                console.error('ëª¨ë‹ˆí„°ë§ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
                document.getElementById('systemStatus').textContent = 'ì˜¤ë¥˜';
                document.getElementById('baselineEngineStatus').textContent = 'ì—°ê²° ì‹¤íŒ¨';
            }
        }

        // í”„ë¡œíŒŒì¼ í†µê³„ ì—…ë°ì´íŠ¸ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì „ìš©)
        function updateProfileStats() {
            const total = profiles.length;
            const active = profiles.filter(p => p.status === 'active').length;
            const running = profiles.filter(p =>
                p.baseline_status &&
                p.baseline_status.latest_baseline &&
                p.baseline_status.latest_baseline.status === 'in_progress'
            ).length;

            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‹¤í–‰ ì´ë ¥ì„ ì¡°íšŒí•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ê¸°ë³¸ê°’ ì‚¬ìš©
            const completedToday = 0; // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì‹¤í–‰ ì´ë ¥ API ë¯¸êµ¬í˜„ìœ¼ë¡œ ì¸í•œ ê¸°ë³¸ê°’

            document.getElementById('totalProfiles').textContent = total;
            document.getElementById('activeProfiles').textContent = active;
            document.getElementById('runningBaselines').textContent = running;
            document.getElementById('completedToday').textContent = completedToday;
        }

        // ìˆ˜ë™ ë² ì´ìŠ¤ë¼ì¸ ìƒì„± - ê°œë³„ í”„ë¡œíŒŒì¼
        async function runManualBaseline(profileId) {
            try {
                const profile = profiles.find(p => p.id === profileId);

                if (!profile) {
                    showToast('í”„ë¡œíŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }

                const confirmation = confirm(`"${profile.name}" í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ í˜„ì¬ ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ìƒˆë¡œìš´ ë² ì´ìŠ¤ë¼ì¸ì„ ìƒì„±í•©ë‹ˆë‹¤.`);

                if (!confirmation) {
                    return;
                }

                showToast('ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');

                // í”„ë¡ì‹œë¥¼ í†µí•´ ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API í˜¸ì¶œ (CORS ë¬¸ì œ í•´ê²°)
                const response = await fetch('/api/profiles/baseline/manual', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        profileId: profileId
                    })
                });

                if (response.ok) {
                    const result = await response.json();

                    if (result.success && result.jobs && result.jobs.length > 0) {
                        const job = result.jobs[0];
                        showToast(`ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. (ì‘ì—… ID: ${job.job_id})`, 'success');

                        // ì‘ì—… ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‘ì—… IDê°€ ë°˜í™˜ëœ ê²½ìš°ì—ë§Œ)
                        if (job.job_id) {
                            monitorJobProgress(job.job_id, profile.name);
                        }

                        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
                        setTimeout(() => refreshBaselineStatuses(), 2000);
                    } else {
                        throw new Error('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ìœ íš¨í•œ ì‘ì—…ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    const error = await response.json();
                    throw new Error(error.error || error.message || 'ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Manual baseline creation error:', error);
                showToast(`ë² ì´ìŠ¤ë¼ì¸ ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ì‘ì—… ì§„í–‰ ìƒíƒœ ëª¨ë‹ˆí„°ë§ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ì „ìš©)
        async function monitorJobProgress(jobId, profileName) {
            let attempts = 0;
            const maxAttempts = 10; // ìµœëŒ€ ì•½ 3ë¶„ ëª¨ë‹ˆí„°ë§ (20ì´ˆ * 10 = 200ì´ˆ)

            const statusInterval = setInterval(async () => {
                try {
                    attempts++;

                    const statusResponse = await fetch(`/api/profiles/baseline/jobs/${jobId}`);

                    if (statusResponse.ok) {
                        const status = await statusResponse.json();

                        if (status.error) {
                            // ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‘ì—… ìƒíƒœë¥¼ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°
                            clearInterval(statusInterval);
                            console.warn(`${profileName}: ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‘ì—… ìƒíƒœë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                            showToast(`${profileName}ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`, 'info');
                            return;
                        }

                        const progress = status.progress ? (status.progress * 100).toFixed(1) : 0;
                        console.log(`${profileName} ë² ì´ìŠ¤ë¼ì¸ ì‘ì—… ì§„í–‰ë¥ : ${progress}%`);

                        if (status.status === 'completed' || status.status === 'success') {
                            clearInterval(statusInterval);
                            showToast(`${profileName} ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
                            refreshBaselineStatuses();
                        } else if (status.status === 'failed' || status.status === 'error') {
                            clearInterval(statusInterval);
                            showToast(`${profileName} ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${status.error_message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`, 'error');
                            refreshBaselineStatuses();
                        }
                    } else {
                        console.warn(`${profileName}: ì‘ì—… ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨: ${statusResponse.status}`);
                    }

                    // ìµœëŒ€ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ ì‹œ ëª¨ë‹ˆí„°ë§ ì¤‘ë‹¨
                    if (attempts >= maxAttempts) {
                        clearInterval(statusInterval);
                        console.log(`${profileName}: ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ ëª¨ë‹ˆí„°ë§ ì‹œê°„ ì´ˆê³¼ - ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`);
                        showToast(`${profileName}ì˜ ë² ì´ìŠ¤ë¼ì¸ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.`, 'info');
                    }

                } catch (error) {
                    console.error(`${profileName}: ì‘ì—… ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì˜¤ë¥˜:`, error);
                }
            }, 20000); // 20ì´ˆë§ˆë‹¤ ìƒíƒœ í™•ì¸
        }

        // ìˆ˜ë™ ë² ì´ìŠ¤ë¼ì¸ ìƒì„± - ì„ íƒëœ í”„ë¡œíŒŒì¼ë“¤
        async function runManualBaselineForSelected() {
            const selectedCheckboxes = document.querySelectorAll('.profile-checkbox:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.dataset.id);

            if (selectedIds.length === 0) {
                showToast('ë² ì´ìŠ¤ë¼ì¸ì„ ìƒì„±í•  í”„ë¡œíŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            const confirmation = confirm(`ì„ íƒëœ ${selectedIds.length}ê°œ í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);

            if (!confirmation) {
                return;
            }

            try {
                showToast(`${selectedIds.length}ê°œ í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...`, 'info');

                // í”„ë¡ì‹œë¥¼ í†µí•´ ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API í˜¸ì¶œ (CORS ë¬¸ì œ í•´ê²°)
                const response = await fetch('/api/profiles/baseline/manual', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        profileIds: selectedIds
                    })
                });

                if (response.ok) {
                    const result = await response.json();

                    if (result.success && result.jobs && result.jobs.length > 0) {
                        showToast(`${result.jobs.length}ê°œ í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');

                        // ê° ì‘ì—…ì˜ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‘ì—… IDê°€ ë°˜í™˜ëœ ê²½ìš°ì—ë§Œ)
                        result.jobs.forEach(job => {
                            if (job.job_id) {
                                const profile = profiles.find(p => p.id === job.profile_id);
                                const profileName = profile ? profile.name : `í”„ë¡œíŒŒì¼ ${job.profile_id}`;
                                monitorJobProgress(job.job_id, profileName);
                            }
                        });

                        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
                        setTimeout(() => refreshBaselineStatuses(), 2000);
                    } else {
                        throw new Error('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ìœ íš¨í•œ ì‘ì—…ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    const error = await response.json();
                    throw new Error(error.error || error.message || 'ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Selected baseline creation error:', error);
                showToast(`ë² ì´ìŠ¤ë¼ì¸ ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ìˆ˜ë™ ë² ì´ìŠ¤ë¼ì¸ ìƒì„± - ì „ì²´ í”„ë¡œíŒŒì¼
        async function runManualBaselineForAll() {
            if (profiles.length === 0) {
                showToast('ë² ì´ìŠ¤ë¼ì¸ì„ ìƒì„±í•  í”„ë¡œíŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            const confirmation = confirm(`ì „ì²´ ${profiles.length}ê°œ í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ìƒë‹¹í•œ ì‹œê°„ì´ ì†Œìš”ë©ë‹ˆë‹¤.`);

            if (!confirmation) {
                return;
            }

            try {
                showToast(`ì „ì²´ ${profiles.length}ê°œ í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...`, 'info');

                const profileIds = profiles.map(p => p.id);

                // í”„ë¡ì‹œë¥¼ í†µí•´ ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ API í˜¸ì¶œ (CORS ë¬¸ì œ í•´ê²°)
                const response = await fetch('/api/profiles/baseline/manual', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        profileIds: profileIds
                    })
                });

                if (response.ok) {
                    const result = await response.json();

                    if (result.success && result.jobs && result.jobs.length > 0) {
                        showToast(`ì „ì²´ ${result.jobs.length}ê°œ í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');

                        // ê° ì‘ì—…ì˜ ìƒíƒœ ëª¨ë‹ˆí„°ë§ ì‹œì‘ (ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ì‘ì—… IDê°€ ë°˜í™˜ëœ ê²½ìš°ì—ë§Œ)
                        result.jobs.forEach(job => {
                            if (job.job_id) {
                                const profile = profiles.find(p => p.id === job.profile_id);
                                const profileName = profile ? profile.name : `í”„ë¡œíŒŒì¼ ${job.profile_id}`;
                                monitorJobProgress(job.job_id, profileName);
                            }
                        });

                        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
                        setTimeout(() => refreshBaselineStatuses(), 2000);
                    } else {
                        throw new Error('ë² ì´ìŠ¤ë¼ì¸ ì—”ì§„ì—ì„œ ìœ íš¨í•œ ì‘ì—…ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    const error = await response.json();
                    throw new Error(error.error || error.message || 'ë² ì´ìŠ¤ë¼ì¸ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('All baseline creation error:', error);
                showToast(`ì „ì²´ ë² ì´ìŠ¤ë¼ì¸ ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showLoading(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    ${message}
                </div>
            `;
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #dc3545;">
                    <h3>ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="location.reload()">ìƒˆë¡œê³ ì¹¨</button>
                </div>
            `;
        }

        function showToast(message, type = 'info') {
            // ê¸°ì¡´ í† ìŠ¤íŠ¸ ì œê±°
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                existingToast.remove();
            }

            // í† ìŠ¤íŠ¸ ìš”ì†Œ ìƒì„±
            const toast = document.createElement('div');
            toast.className = `toast-message toast-${type}`;
            toast.textContent = message;

            // ë¬¸ì„œì— ì¶”ê°€
            document.body.appendChild(toast);

            // ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í‘œì‹œ
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            // 3ì´ˆ í›„ ì œê±°
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        function formatDate(dateString) {
            if (!dateString) return '-';

            try {
                const date = new Date(dateString);
                return date.toLocaleString('ko-KR', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                return dateString;
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.profile-checkbox');

            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });

            updateSelectedProfiles();
        }

        function updateSelectedProfiles() {
            const selectedCheckboxes = document.querySelectorAll('.profile-checkbox:checked');
            selectedProfiles = Array.from(selectedCheckboxes).map(cb => cb.dataset.id);

            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
            const selectAllCheckbox = document.getElementById('selectAll');
            const totalCheckboxes = document.querySelectorAll('.profile-checkbox');

            if (selectAllCheckbox && totalCheckboxes.length > 0) {
                selectAllCheckbox.checked = selectedCheckboxes.length === totalCheckboxes.length;
                selectAllCheckbox.indeterminate = selectedCheckboxes.length > 0 && selectedCheckboxes.length < totalCheckboxes.length;
            }
        }

        function viewProfile(profileId) {
            window.open(`uba_profile_results.html?id=${profileId}`, '_blank');
        }

        function editProfile(profileId) {
            window.open(`uba_profile_wizard.html?edit=${profileId}`, '_blank');
        }

        function exportHistory() {
            if (executionHistory.length === 0) {
                showToast('ë‚´ë³´ë‚¼ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤.', 'warning');
                return;
            }

            // CSV í˜•ì‹ìœ¼ë¡œ ë°ì´í„° ë³€í™˜
            const headers = ['ì‘ì—… ID', 'í”„ë¡œíŒŒì¼ ID', 'í”„ë¡œíŒŒì¼ëª…', 'ìƒíƒœ', 'ì§„í–‰ë¥ ', 'ë©”ì‹œì§€', 'ì‹œì‘ ì‹œê°„', 'ì™„ë£Œ ì‹œê°„'];
            const csvContent = [
                headers.join(','),
                ...executionHistory.map(h => [
                    h.job_id,
                    h.profile_id,
                    h.profile_name || '',
                    h.status,
                    h.progress_percentage || 0,
                    (h.message || '').replace(/,/g, ';'),
                    h.created_at,
                    h.completed_at || ''
                ].join(','))
            ].join('\n');

            // íŒŒì¼ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `uba_baseline_history_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showToast('ì‹¤í–‰ ì´ë ¥ì´ CSV íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.', 'success');
        }

        // ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœë§Œ ìƒˆë¡œê³ ì¹¨ (ì„±ëŠ¥ í–¥ìƒ)
        async function refreshBaselineStatuses() {
            try {
                console.log('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœë§Œ ìƒˆë¡œê³ ì¹¨ ì‹œì‘');

                // ê° í”„ë¡œíŒŒì¼ì˜ ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ì¡°íšŒ
                await loadProfileBaselineStatuses();

                // í…Œì´ë¸”ë§Œ ë‹¤ì‹œ ë Œë”ë§
                renderProfileTable();

                // í†µê³„ ì—…ë°ì´íŠ¸
                updateProfileStats();

                // ì‹¤í–‰ ì´ë ¥ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆë‹¤ë©´ ì‹¤í–‰ ì´ë ¥ë„ ìƒˆë¡œê³ ì¹¨
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab && activeTab.id === 'execution-history') {
                    console.log('ì‹¤í–‰ ì´ë ¥ íƒ­ì´ í™œì„±í™”ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ì‹¤í–‰ ì´ë ¥ë„ ìƒˆë¡œê³ ì¹¨');
                    refreshHistory();
                }

                console.log('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
            } catch (error) {
                console.error('ë² ì´ìŠ¤ë¼ì¸ ìƒíƒœ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', error);
            }
        }
    </script>
</body>
</html>
